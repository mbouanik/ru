if (self.CavalryLogger) { CavalryLogger.start_js(["xft8+"]); }

__d("BanzaiAdapter",["Arbiter","BanzaiConsts","CurrentUser","QueryString","Run","SiteData","SnappyCompressUtil","URI","UserAgent","ZeroRewrites","getAsyncParams","BanzaiConfig"],(function(a,b,c,d,e,f){__p&&__p();var g=[],h=new(b("Arbiter"))(),i="/ajax/bz",j="POST",k={config:b("BanzaiConfig"),endpoint:i,getUserID:function(){return b("CurrentUser").getID()},inform:function(a){h.inform(a)},subscribe:function(a,b){return h.subscribe(a,b)},cleanup:function(){var a=g;g=[];a.forEach(function(a){a.readyState<4&&a.abort()})},readyToSend:function(){return b("UserAgent").isBrowser("IE <= 8")||navigator.onLine},send:function(a,c,d,e){__p&&__p();var f=b("ZeroRewrites").rewriteURI(new(b("URI"))(i)),h=b("ZeroRewrites").getTransportBuilderForURI(f)();h.open(j,f.toString(),!0);h.setRequestHeader("Content-Type","application/x-www-form-urlencoded");h.onreadystatechange=function(){if(h.readyState>=4){var a=g.indexOf(h);a>=0&&g.splice(a,1);try{a=h.status}catch(b){a=0}a==200?(c&&c(),e||k.inform(b("BanzaiConsts").OK)):(d&&d(a),e||k.inform(b("BanzaiConsts").ERROR))}};g.push(h);h.send(k.prepForTransit(a))},addRequestAuthData:function(a){return a},prepForTransit:function(a){var c=b("getAsyncParams")(j);c.q=JSON.stringify(a);c.ts=Date.now();c.ph=b("SiteData").push_phase;return b("QueryString").encode(c)},prepWadForTransit:function(a){if(a.snappy==null||a.snappy===!0){var c=Date.now(),d=JSON.stringify(a.posts),e=b("SnappyCompressUtil").compressStringToSnappy(d);e!=null&&e.length<d.length?(a.posts=e,a.snappy_ms=Date.now()-c):delete a.snappy}},setHooks:function(a){},setUnloadHook:function(a){b("BanzaiConfig").gks&&b("BanzaiConfig").gks.beforeunload_hook?b("Run").onBeforeUnload(a._unload):b("Run").onAfterUnload(a._unload)},onUnload:function(a){b("Run").onAfterUnload(a)},isOkToSendViaBeacon:function(){return!0}};e.exports=k}),18);
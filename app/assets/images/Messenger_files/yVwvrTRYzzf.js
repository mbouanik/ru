if (self.CavalryLogger) { CavalryLogger.start_js(["igdqg"]); }

__d("MessengerMQTTConnection",["Arbiter","CurrentUser","MercuryRealTimeEnvironmentDropDown","MercurySingletonProvider","MessageEventStream","MessengerMQTTConnectionEvents","MessengerMQTTPayloadPreprocessor","MessengerMQTTTypingDataPreProcessor","MqttChannel","MqttLogger","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MessengerMQTTConnectionEvents").DELTA_EVENT,h=b("MessengerMQTTConnectionEvents").STREAM_CONNECT,i=b("MessengerMQTTConnectionEvents").STREAM_DISCONNECT,j=b("MessengerMQTTConnectionEvents").STREAM_CONNECTING,k=b("MessengerMQTTConnectionEvents").STATE_CONNECTED,l=b("MessengerMQTTConnectionEvents").STATE_CONNECTING,m=b("MessengerMQTTConnectionEvents").STATE_DISCONNECTED,n=b("MessengerMQTTConnectionEvents").TYP;o.getForFBID=function(a){return p.getForFBID(a)};o.get=function(){return p.get()};function o(a){this.$1=a,this.connectionState=m}o.setUp=function(a){__p&&__p();var c=a.fbid,d=a.irisSeqID,e=a.appID;a=a.endpoint;b("MercuryRealTimeEnvironmentDropDown").init();if(!c||!d)return;var f=b("MqttLogger").getInstance();if(!b("CurrentUser").isLoggedInNow()){f.debugTrace("run","User not logged in");f.bumpCounter("user_not_loggged_in");return}var g=o.getForFBID(c);o.addDeltaStream({fbid:c,irisSeqID:d});var n=function(){b("Arbiter").inform(h)};b("MqttChannel").getConnectionState()===k&&(g.connectionState=k,n());b("MqttChannel").subscribeChannelEvents({onMQTTStateChanged:function(a){switch(a){case k:n();break;case l:b("Arbiter").inform(j);break;case m:b("Arbiter").inform(i);break}g.connectionState=a},onJSError:function(a){b("Arbiter").inform("mqtt-websocket-connection-died")}});f=b("gkx")("AT7KYLPJG-7HMR3OV17P-J93Y-4H-lvVA1U7hnkCV5WMAPoQljZmU4Y0vUCOCIcHzjjDZsHhOFrVW-1H0YcHEUMQ")?["/t_ms"]:["/t_ms","/orca_typing_notifications","/thread_typing"];b("MqttChannel").run({endpoint:a,userFbid:c,appId:e,subscribedTopics:f})};o.addDeltaStream=function(a){var c=a.fbid;a=a.irisSeqID;var d=o.getForFBID(c);b("MessageEventStream").getForFBID(c).init(a).addDeltaStreamListener(d)};o.prototype.onDeltaReceived=function(a){var c=a.type;a=a.payload;c=b("MessengerMQTTPayloadPreprocessor").process(this.$1,c,a);b("Arbiter").inform(g,c)};o.prototype.onStreamDisconnect=function(a){if(a==="IRIS_CURSOR_LIMIT"){b("Arbiter").inform("mqtt-websocket-connection-died");return}b("Arbiter").inform(i,a)};o.prototype.onTypingReceived=function(a){a=b("MessengerMQTTTypingDataPreProcessor").process(this.$1,a);b("Arbiter").inform(n,a)};var p=new(b("MercurySingletonProvider"))(o);e.exports=o}),null);
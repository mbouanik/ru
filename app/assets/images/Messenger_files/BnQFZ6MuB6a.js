if (self.CavalryLogger) { CavalryLogger.start_js(["PBzOn"]); }

__d("FBRTCCapability",[],(function(a,b,c,d,e,f){e.exports={SUPPORT_AUDIO_DEPRECATED:0,SUPPORT_VIDEO_DEPRECATED:1,SUPPORT_EXPERIMENTS_IN_JOIN_RESPONSE:2,SUPPORT_NEW_PARTICIPANT_STATES:3,SUPPORT_SDP_RENEGOTIATION:4}}),null);
__d("FBRTCDeviceStatus",[],(function(a,b,c,d,e,f){e.exports={OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10}}),null);
__d("FBRTCMessageType",[],(function(a,b,c,d,e,f){e.exports={JOIN:0,SERVER_MEDIA_UPDATE:1,HANGUP:2,ICE_CANDIDATE:3,RING:4,DISMISS:5,CONFERENCE_STATE:6,ADD_PARTICIPANTS:7,SUBSCRIPTION:8,CLIENT_MEDIA_UPDATE:9,DATA_MESSAGE:10,REMOVE_PARTICIPANTS:11,EXPERIMENT:12,CONNECT:16,APPROVAL:17}}),null);
__d("FBRTCRingType",[],(function(a,b,c,d,e,f){e.exports={GROUP_AUDIO_CALL:0,PEER_VIDEO_CALL:1,PEER_AUDIO_CALL:2,GROUP_VIDEO_CALL:3,LIVE_STREAM:4,PEER_ESCALATED_VIDEO_CALL:5,PEER_ESCALATED_AUDIO_CALL:6}}),null);
__d("FBRTCVideoQuality",[],(function(a,b,c,d,e,f){e.exports={LOW:0,MEDIUM:1,HIGH:2,HD:3,NUM_QUALITIES:4}}),null);
__d("BonfireLoggingPage",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({BONFIRE_PAGE_LOGIN:"bonfire_page_login",BONFIRE_PAGE_BONFIRE:"bonfire_page_bonfire",BONFIRE_PAGE_GDPR_CONSENT:"bonfire_page_gdpr_consent"})}),null);
__d("BonfireLocalStorage",["BonfireLoggingPage","WebStorage","immutable","uuid"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=1e3*60*5,h="bonfire_session_id",i="bonfire_session_activity_time",j="bonfire_device_id",k="bonfire_page",l=b("immutable").Set(Object.values(b("BonfireLoggingPage")));function a(){this.$1=this.$4()||this.$5(),this.$2=this.$6(),this.$3=this.$7()}a.prototype.$5=function(){var a={sessionID:b("uuid")(),lastSessionActivityTime:Date.now()},c=b("WebStorage").getSessionStorage();c&&(c.setItem(h,a.sessionID),c.setItem(i,String(a.lastSessionActivityTime)));return a};a.prototype.$6=function(){var a=b("WebStorage").getLocalStorage(),c=a&&a.getItem(j);if(typeof c==="string")return c;else{c=b("uuid")();a&&a.setItem(j,c);return c}};a.prototype.$4=function(){var a=b("WebStorage").getSessionStorageForRead(),c=a&&a.getItem(h);a=a&&Number(a.getItem(i));return typeof c==="string"&&a?{sessionID:c,lastSessionActivityTime:a}:null};a.prototype.$8=function(){var a=Date.now(),c=b("WebStorage").getSessionStorage(),d=a-g;if(this.$1.lastSessionActivityTime<d)return this.$5().sessionID;else{this.$1.lastSessionActivityTime=a;c&&c.setItem(i,String(a));return this.$1.sessionID}};a.prototype.getSessionID=function(){return this.$8()};a.prototype.getDeviceID=function(){return this.$2};a.prototype.$7=function(){var a=b("WebStorage").getSessionStorageForRead();a=a&&a.getItem(k);return l.contains(a)?a:null};a.prototype.getPage=function(){return this.$3};a.prototype.setPage=function(a){this.$3=a;var c=b("WebStorage").getSessionStorage();c&&(a?c.setItem(k,a):c.removeItem(k))};e.exports=new a()}),null);
__d("BonfireUserActionsTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("logger:BonfireUserActionsLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("logger:BonfireUserActionsLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:BonfireUserActionsLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setBonfireID=function(a){this.$1.bonfire_id=a;return this};a.prototype.setClientTime=function(a){this.$1.client_time=a;return this};a.prototype.setComponent=function(a){this.$1.component=a;return this};a.prototype.setDeviceID=function(a){this.$1.device_id=a;return this};a.prototype.setDuration=function(a){this.$1.duration=a;return this};a.prototype.setErrorDomain=function(a){this.$1.error_domain=a;return this};a.prototype.setErrorType=function(a){this.$1.error_type=a;return this};a.prototype.setEvent=function(a){this.$1.event=a;return this};a.prototype.setExpectedParticipantCount=function(a){this.$1.expected_participant_count=a;return this};a.prototype.setPage=function(a){this.$1.page=a;return this};a.prototype.setParticipantCount=function(a){this.$1.participant_count=a;return this};a.prototype.setReferralSurface=function(a){this.$1.referral_surface=a;return this};a.prototype.setSessionID=function(a){this.$1.session_id=a;return this};a.prototype.setSurface=function(a){this.$1.surface=a;return this};a.prototype.setVC=function(a){this.$1.vc=a;return this};a.prototype.updateExtraData=function(a){a=b("nullthrows")(b("GeneratedLoggerUtils").serializeMap(a));b("GeneratedLoggerUtils").checkExtraDataFieldNames(a,g);this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.addToExtraData=function(a,b){var c={};c[a]=b;return this.updateExtraData(c)};var g={bonfire_id:!0,client_time:!0,component:!0,device_id:!0,duration:!0,error_domain:!0,error_type:!0,event:!0,expected_participant_count:!0,page:!0,participant_count:!0,referral_surface:!0,session_id:!0,surface:!0,vc:!0};e.exports=a}),null);
__d("BonfireLogger",["BonfireLocalStorage","BonfireUserActionsTypedLogger","Run","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("immutable").Map;function a(){this.$1=g(),b("Run").onBeforeUnload(function(){this.logPageChange(null)}.bind(this))}a.prototype.logPageChange=function(a,c){c===void 0&&(c=null);var d=b("BonfireLocalStorage").getPage();a!==d?(d&&this.logStopTimer("bonfire_timer_page",{eventName:"page_exit"}),b("BonfireLocalStorage").setPage(a),a&&this.logStartTimer("bonfire_timer_page",{eventName:"page_enter",referralSurface:c})):this.$2("bonfire_timer_page")||this.$3("bonfire_timer_page")};a.prototype.logImpression=function(a){this.logEvent({eventName:"impression",surface:a})};a.prototype.logClick=function(a,b){this.logEvent({eventName:"tap",surface:a,component:b})};a.prototype.logEdit=function(a,b){this.logEvent({eventName:"edit",surface:a,component:b})};a.prototype.logError=function(a,b,c){this.logEvent({eventName:"error",surface:a,errorDomain:b,errorType:c})};a.prototype.logStartTimer=function(a,event){this.logEvent(event),this.$3(a)};a.prototype.logStopTimer=function(a,event){event.duration=this.$4(a),this.logEvent(event)};a.prototype.logEvent=function(event){var a={bonfire_id:event.bonfireID,client_time:Date.now(),error_domain:event.errorDomain,error_type:event.errorType,expected_participant_count:event.expectedParticipantCount,component:event.component,device_id:b("BonfireLocalStorage").getDeviceID(),duration:event.duration,event:event.eventName,page:b("BonfireLocalStorage").getPage(),participant_count:event.participantCount,referral_surface:event.referralSurface,session_id:b("BonfireLocalStorage").getSessionID(),surface:event.surface};new(b("BonfireUserActionsTypedLogger"))().updateData(a).log()};a.prototype.$3=function(a){this.$1=this.$1.set(a,Date.now())};a.prototype.$4=function(a){var b=this.$1.get(a);if(b){this.$1=this.$1.remove(a);return Date.now()-b}return null};a.prototype.$2=function(a){return this.$1.has(a)};e.exports=new a()}),null);
__d("BonfireRingResponseMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"LocalArgument",name:"input",type:"BonfireRingResponseData!",defaultValue:null}],b=[{kind:"LinkedField",alias:null,name:"bonfire_ring_response",storageKey:null,args:[{kind:"Variable",name:"data",variableName:"input",type:"BonfireRingResponseData!"}],concreteType:"BonfireRingResponseResponsePayload",plural:!1,selections:[{kind:"ScalarField",alias:null,name:"success",args:null,storageKey:null}]}];return{kind:"Request",operationKind:"mutation",name:"BonfireRingResponseMutation",id:"2392344367457929",text:null,metadata:{},fragment:{kind:"Fragment",name:"BonfireRingResponseMutation",type:"Mutation",metadata:null,argumentDefinitions:a,selections:b},operation:{kind:"Operation",name:"BonfireRingResponseMutation",argumentDefinitions:a,selections:b}}}();e.exports=a}),null);
__d("BonfireRingResponseMutation",["RelayFBEnvironment","RelayModern","RelayRuntime","BonfireRingResponseMutation.graphql"],(function(a,b,c,d,e,f){"use strict";var g=b("RelayModern").commitMutation;b("RelayRuntime").graphql;var h=function(){return b("BonfireRingResponseMutation.graphql")};function a(a){g(b("RelayFBEnvironment"),{mutation:h,variables:{input:{ring_response_type:a.ringResponseType,sender_fbid:a.senderFBID,sender_bonfire_user_id:a.senderBonfireUserID,sender_bonfire_id:a.senderBonfireID,ring_request_id:a.ringRequestID}}})}e.exports=a}),null);
__d("RTISubscriptionGate",["RTISubscriptionGateLoader"],(function(a,b,c,d,e,f){a=b("RTISubscriptionGateLoader").module;b("RTISubscriptionGateLoader").gkUseIcebreaker&&(a=new a(b("RTISubscriptionGateLoader").icebreakerWhitelist));e.exports=a}),null);
__d("intlSummarizeNumber",["FbtNumberType","IntlCompactDecimalNumberFormatConfig","IntlVariations","intlNumUtils"],(function(a,b,c,d,e,f){__p&&__p();var g=3,h=14,i={ROUND:"ROUND",TRUNCATE:"TRUNCATE"},j={SHORT:"SHORT",LONG:"LONG"};function a(a,c,d,e){__p&&__p();d===void 0&&(d=j.SHORT);e===void 0&&(e=i.ROUND);d=b("IntlCompactDecimalNumberFormatConfig")[d==j.SHORT?"short_patterns":"long_patterns"];var f=a===0?0:Math.floor(Math.log10(Math.abs(a)));f>h&&(f=h);var l=k(a,f,c,e,d),m=l[0],n=l[1];l=l[2];if(l){f+=1;l=k(a,f,c,e,d);m=l[0];n=l[1];l[2]}e=b("FbtNumberType").getNumberVariationType(m)||b("IntlVariations").NUMBER_OTHER;l=f.toString();l=(d=d)!=null?(d=d[l])!=null?d[e.toString()]:d:d;if(!l||f<g||l.positive_prefix_pattern===""&&l.positive_suffix_pattern===""){e=c===undefined?0:c;return b("intlNumUtils").formatNumberWithThousandDelimiters(a,e)}return l&&l.min_integer_digits===0&&m===1?l.positive_prefix_pattern+l.positive_suffix_pattern:(l&&l.positive_prefix_pattern||"")+b("intlNumUtils").formatNumberWithThousandDelimiters(m,n)+(l&&l.positive_suffix_pattern||"")}function k(a,c,d,e,f){__p&&__p();var g=c.toString();g=(f=f)!=null?(f=f[g])!=null?f[b("IntlVariations").NUMBER_OTHER.toString()]:f:f;f=g&&g.min_integer_digits||c+1;var j=c-f+1;j=Math.abs(a)/Math.pow(10,j);var k=d!=null;d=k?d:g&&g.min_fraction_digits;d==null&&(d=c>2?1:0);g=e==i.TRUNCATE?b("intlNumUtils").truncateLongNumber(j.toString(),d):j.toFixed(d);e=parseFloat(g)*(a<0?-1:1);return[e,e%1===0&&!k?0:d,g.length>f+(d>0?d+1:0)+(j>=0?0:1)&&c<h]}e.exports=a}),null);
__d("Facepile.react",["cx","fbt","ix","HovercardLink","Image.react","Link.react","List.react","React","intlSummarizeNumber","joinClasses"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();a=b("React").PropTypes;var j={small:24,medium:32,large:50};c=b("React").createClass({displayName:"Facepile",defaultProps:{moreColor:"blue",moreCount:0,showHovercard:!1,tooltipPosition:"above",showToolTip:!0,spacing:"none"},propTypes:{className:a.string,moreColor:a.oneOf(["blue","gray"]),moreCount:a.number,moreDialogLink:a.string,morePageLink:a.string,numFaces:a.number,onFaceClick:a.func,onComponentDidMount:a.func,profiles:a.arrayOf(a.shape({URL:a.any,name:a.node.isRequired,uniqueID:a.any.isRequired,profilePicURI:a.any.isRequired})).isRequired,showHovercard:a.bool,size:a.oneOf([28,"small","medium","large"]).isRequired,spacing:a.oneOf(["none","small","medium","large"]),showToolTip:a.bool,tooltipPosition:a.oneOf(["above","below","left","right"])},_onFaceClick:function(a,b){this.props.onFaceClick&&this.props.onFaceClick(a,b)},componentDidMount:function(){this.props.onComponentDidMount&&this.props.onComponentDidMount()},getPicSize:function(){return j[this.props.size]||this.props.size},renderFace:function(a,c){var d=this.getPicSize(),e=b("HovercardLink").constructEndpoint({id:a.uniqueID}).toString();return b("React").createElement("li",{className:"_43q7",key:a.uniqueID,onClick:this._onFaceClick.bind(this,a,c)},b("React").createElement(b("Link.react"),{"aria-label":a.name,className:"_2rt_ link","data-hover":this.props.showHovercard?null:"tooltip","data-hovercard":this.props.showHovercard?e:null,"data-ignoreclass":"_2rt_","data-tooltip-alignh":"left","data-tooltip-content":a.name,"data-tooltip-position":this.props.tooltipPosition,href:a.URL},b("React").createElement(b("Image.react"),{src:a.profilePicURI,width:d,height:d,className:"img"})))},renderMore:function(){if(!this.props.moreCount)return null;var a=this.props.numFaces!=null&&this.props.numFaces<=this.props.profiles.length?this.props.moreCount+1:this.props.moreCount,c=b("intlSummarizeNumber")(a,0),d=c.length,e;a===0||this.props.size==="small"&&d>2||this.props.size===28&&d>2||this.props.size==="medium"&&d>3||this.props.size==="large"&&d>6?e=b("React").createElement(b("Image.react"),{src:i("97502")}):e="+"+c;var f;(this.props.showToolTip===undefined||this.props.showToolTip===!0)&&(a===1?f=h._("1 other person"):f=h._("{num} other people",[h._param("num",a)]));c=b("joinClasses")("_43q8 _43q7"+(d<2?" _43qa":"")+(d===2?" _43qb":"")+(d===3?" _43qd":"")+(d>3?" _43qe":"")+(this.props.moreColor==="blue"?" _49c8":"")+(this.props.moreColor==="gray"?" _49cb":""));return b("React").createElement("li",{className:c},b("React").createElement("a",{"data-hover":f?"tooltip":null,"data-tooltip-position":f?"right":null,"data-tooltip-content":f,ajaxify:this.props.moreDialogLink||this.props.morePageLink,href:this.props.morePageLink,role:"button",rel:this.props.moreDialogLink?"dialog":null},e))},render:function(){var a=this.props.spacing||this.defaultProps.spacing;a=b("joinClasses")(this.props.className,"_43qm"+(this.props.size==28?" _3cxu":"")+(this.props.size=="small"?" _43q9":"")+(this.props.size=="medium"?" _43qc":"")+(this.props.size=="large"?" _43qf":"")+(a!=this.defaultProps.spacing?" _4nab":""));var c=this.props.numFaces==undefined?this.props.profiles:this.props.profiles.slice(0,this.props.moreCount?this.props.numFaces-1:this.props.numFaces);return b("React").createElement("div",{className:a,style:this.props.style},b("React").createElement(b("List.react"),{className:"_4cg3",direction:"horizontal",spacing:this.props.spacing||"none",border:"none"},c.map(this.renderFace),this.renderMore()))}});e.exports=c}),null);
__d("BonfireUserFetcherQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"LocalArgument",name:"userId",type:"ID!",defaultValue:null}],b=[{kind:"Variable",name:"id",variableName:"userId",type:"ID!"}],c={kind:"ScalarField",alias:null,name:"id",args:null,storageKey:null},d={kind:"ScalarField",alias:null,name:"display_name",args:null,storageKey:null},e={kind:"ScalarField",alias:null,name:"username",args:null,storageKey:null},f={kind:"ScalarField",alias:null,name:"profile_picture_uri",args:null,storageKey:null},g={kind:"ScalarField",alias:null,name:"is_viewer_friend",args:null,storageKey:null};return{kind:"Request",operationKind:"query",name:"BonfireUserFetcherQuery",id:"2128247880523200",text:null,metadata:{},fragment:{kind:"Fragment",name:"BonfireUserFetcherQuery",type:"Query",metadata:null,argumentDefinitions:a,selections:[{kind:"LinkedField",alias:null,name:"node",storageKey:null,args:b,concreteType:null,plural:!1,selections:[{kind:"InlineFragment",type:"User",selections:[c,{kind:"LinkedField",alias:null,name:"bonfire_user",storageKey:null,args:null,concreteType:"BonfireUser",plural:!1,selections:[c,d,e,f,{kind:"FragmentSpread",name:"BonfireParticipantRow_participant",args:null}]}]}]}]},operation:{kind:"Operation",name:"BonfireUserFetcherQuery",argumentDefinitions:a,selections:[{kind:"LinkedField",alias:null,name:"node",storageKey:null,args:b,concreteType:null,plural:!1,selections:[{kind:"ScalarField",alias:null,name:"__typename",args:null,storageKey:null},c,{kind:"InlineFragment",type:"User",selections:[{kind:"LinkedField",alias:null,name:"bonfire_user",storageKey:null,args:null,concreteType:"BonfireUser",plural:!1,selections:[c,d,e,f,{kind:"ScalarField",alias:null,name:"account_id",args:null,storageKey:null},g,{kind:"ScalarField",alias:null,name:"is_blocked_by_viewer",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"last_active_time",args:null,storageKey:null},{kind:"LinkedField",alias:null,name:"facebook_user",storageKey:null,args:null,concreteType:"User",plural:!1,selections:[g,c]},{kind:"LinkedField",alias:null,name:"active_friend_request_with_viewer",storageKey:null,args:null,concreteType:"BonfireFriendRequest",plural:!1,selections:[c]}]}]}]}]}}}();e.exports=a}),null);
__d("BaseGraphQLSubscription",["Banzai","BanzaiLogger","ChannelClientID","CurrentLocale","CurrentUser","GraphQLSubscriptionsConfig","Random","RTISubscriptionGate","URI","gkx"],(function(a,b,c,d,e,f){__p&&__p();var g=1e4,h=1,i=100,j="www_e2e_reliability";a={subscribe:function(a,c,d){__p&&__p();d===void 0&&(d={});d.forceLogContext==null&&b("gkx")("AT7Chz5wgKLZbSd9ly8uFQQBsVBGTLtk8_Yf3E8ifENKY4n9DNZfVEomwBg6vUHF1MWvJVXwrBfYznXqFMX9Hd7EhR2xpmULKwr8D4oho-SBhA")&&b("Random").coinflip(i)&&(d.forceLogContext=j);var e=this._getQueryParameters(a);d.forceLogContext!=null&&(e["%options"]={client_logged_context:d.forceLogContext});var f={};f.transformContext=JSON.stringify(this._getTransformContext(a,e));d.policy!=null&&(f.policy=d.policy);this._logEvent("client_subscribe",e,d);return b("RTISubscriptionGate").subscribe(this._getTopic(a),function(a){this._logEvent("receivepayload",e,d),c(JSON.parse(a.payload))}.bind(this),f,null,function(){this._logEvent("client_unsubscribe",e,d)}.bind(this))},subscribeWithIcebreaker_EXPERIMENTAL:function(a,c,d){__p&&__p();var e=new(b("URI"))("https://streaming-graph.facebook.com/gqls_bore");e.setQueryData({access_token:d});d=this._getTopic(a);var f={topic:d,locale:b("CurrentLocale").get(),queryID:this._getQueryID(),serializedQueryParameters:JSON.stringify(this._getQueryParameters(a))};e.addQueryData(f);var g=new EventSource(e.toString(),{withCredentials:!0});g.addEventListener("message",function(a){c(JSON.parse(JSON.parse(a.data).payload))},!1);return{getContext:function(){return f},unsubscribe:function(){return g.close()}}},_getTransformContext:function(a,c){var d=0;return{viewerID:this._getViewerID(a),appID:d,locale:b("CurrentLocale").get(),queryID:this._getQueryID(),serializedQueryParameters:JSON.stringify(c)}},_getViewerID:function(a){return b("CurrentUser").getID()},_logEvent:function(a,c,d){if(b("Banzai").isEnabled("gqls_web_logging")){var e=b("GraphQLSubscriptionsConfig").shouldAlwaysLog||d.forceLogContext?h:g;b("Random").coinflip(e)&&b("BanzaiLogger").log("GraphQLSubscriptionsLoggerConfig",{clienttime:Date.now()/1e3,client_sample_weight:e,event:a,force_log_context:d.forceLogContext,mechanism:"skywalker",query_id:parseInt(this._getQueryID(),10),query_params:c,session_id:b("ChannelClientID").getID(),subscription_call:this._getSubscriptionCallName()})}}};e.exports=a}),null);
__d("WebGraphQLSubscriptionHelper",[],(function(a,b,c,d,e,f){"use strict";e.exports={getExports:function(a){var b=a.docID,c=a.queryID;return{getDocID:function(){return b},getLegacyQueryID:function(){return c}}}}}),null);
__d("RungParticipantsAddedWebGraphQLSubscription",["WebGraphQLSubscriptionHelper"],(function(a,b,c,d,e,f){"use strict";e.exports=b("WebGraphQLSubscriptionHelper").getExports({docID:"1879396068740293",queryID:"738167736389860"})}),null);
__d("RungParticipantsAddedSubscription",["BaseGraphQLSubscription","RungParticipantsAddedWebGraphQLSubscription","uuid"],(function(a,b,c,d,e,f){a=babelHelpers["extends"]({},b("BaseGraphQLSubscription"),{_getTopic:function(a){return"gqls/rung_participants_added_subscribe/call_id_"+a},_getQueryID:function(){return b("RungParticipantsAddedWebGraphQLSubscription").getDocID()},_getQueryParameters:function(a){return{input:JSON.stringify({client_subscription_id:b("uuid")(),call_id:a})}},_getSubscriptionCallName:function(){return"rung_participants_added_subscribe"}});e.exports=a}),null);
__d("XWorkplaceHomepageMainController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/workplace/{?*path}/",{path:{type:"String",defaultValue:""},ref:{type:"String"},source:{type:"String"}})}),null);
__d("MessengerRTCUnsupportedBrowserDialog.react",["cx","fbt","CurrentUser","FBRTCConfig","Link.react","MessengerDialog.react","MessengerDialogBodyReact.bs","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","React","XWorkplaceHomepageMainController"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j=b("MessengerDialogBodyReact.bs").jsComponent;i=babelHelpers.inherits(a,b("React").Component);i&&i.prototype;a.prototype.render=function(){var a=this.props,c=a.browserName,d=a.hasVideo,e=a.onUnmount;a=a.hideDialog;return b("React").createElement(b("MessengerDialog.react"),{onToggle:e},b("React").createElement(b("MessengerDialogHeader.react"),null,h._("Switch Browsers to Make Calls")),b("React").createElement(j,null,this.$1(c,d)),b("React").createElement(b("MessengerDialogFooter.react"),null,b("React").createElement(b("MessengerDialogButton.react"),{className:"_30vt",label:h._("Learn More"),onClick:a,type:"secondary",href:b("FBRTCConfig").unsupportedBrowserUrl(),target:"_blank"}),b("React").createElement(b("MessengerDialogButton.react"),{label:h._("OK"),onClick:a,type:"primary"})))};a.prototype.$1=function(a,c){if(b("CurrentUser").isWorkUser())return h._({"video calling":"Unfortunately, {browser name, i.e. Internet Explorer or Safari} doesn't support our video calling feature yet. To make a call, open Workplace Chat in {link to install chrome}, {link to install firefox} or the {link to install Workplace chat desktop} app.","calling":"Unfortunately, {browser name, i.e. Internet Explorer or Safari} doesn't support our calling feature yet. To make a call, open Workplace Chat in {link to install chrome}, {link to install firefox} or the {link to install Workplace chat desktop} app."},[h._param("browser name, i.e. Internet Explorer or Safari",a),h._enum(c?"video calling":"calling",{"video calling":"video calling",calling:"calling"}),h._param("link to install chrome",this.$2()),h._param("link to install firefox",this.$3()),h._param("link to install Workplace chat desktop",this.$4())]);else return h._({"video calling":"Unfortunately, {browser name, i.e. Internet Explorer or Safari} doesn't support our video calling feature yet. To make a call, open Messenger in {link to install chrome} or {link to install firefox}.","calling":"Unfortunately, {browser name, i.e. Internet Explorer or Safari} doesn't support our calling feature yet. To make a call, open Messenger in {link to install chrome} or {link to install firefox}."},[h._param("browser name, i.e. Internet Explorer or Safari",a),h._enum(c?"video calling":"calling",{"video calling":"video calling",calling:"calling"}),h._param("link to install chrome",this.$2()),h._param("link to install firefox",this.$3())])};a.prototype.$2=function(){return b("React").createElement(b("Link.react"),{onClick:this.props.hideDialog,href:"https://www.google.com/chrome/index.html",target:"_blank"},"Google Chrome")};a.prototype.$3=function(){return b("React").createElement(b("Link.react"),{onClick:this.props.hideDialog,href:"https://www.mozilla.org/en-US/firefox/new/",target:"_blank"},"Mozilla Firefox")};a.prototype.$4=function(){var a=b("XWorkplaceHomepageMainController").getURIBuilder().setString("path","chat-app").setString("ref","rtc_unsupported_dialog").getURI();return b("React").createElement(b("Link.react"),{onClick:this.props.hideDialog,href:a,target:"_blank"},"Workplace Chat")};function a(){i.apply(this,arguments)}e.exports=a}),null);
__d("MessengerRTCGroupCallUnsupportedBrowserDialog.react",["fbt","CurrentUser","Link.react","MessengerDialog.react","MessengerDialogBodyReact.bs","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","React","XWorkplaceHomepageMainController"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("MessengerDialogBodyReact.bs").jsComponent;a=function(a){var c=a.browserName,d=a.hasVideo,e=a.onUnmount;a=a.hideDialog;return b("React").createElement(b("MessengerDialog.react"),{onToggle:e},b("React").createElement(b("MessengerDialogHeader.react"),null,i(d)),b("React").createElement(h,null,j(c,d,a)),b("React").createElement(b("MessengerDialogFooter.react"),null,b("React").createElement(b("MessengerDialogButton.react"),{label:g._("OK"),onClick:a,type:"primary"})))};function i(a){return a?g._("Switch Browsers to Make Group Video Chats"):g._("Switch Browsers to Make Group Calls")}function j(a,c,d){return b("CurrentUser").isWorkUser()?g._({"video call":"Unfortunately, our Workplace Chat group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group video call, open in {link to install chrome} or the {link to install Workplace chat desktop} app.","call":"Unfortunately, our Workplace Chat group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group call, open in {link to install chrome} or the {link to install Workplace chat desktop} app."},[g._param("browser name, i.e. Internet Explorer or Safari",a),g._enum(c?"video call":"call",{"video call":"video call",call:"call"}),g._param("link to install chrome",k(d)),g._param("link to install Workplace chat desktop",l(d))]):g._({"video call":"Unfortunately, our group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group video call, open in {link to install chrome}.","call":"Unfortunately, our group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group call, open in {link to install chrome}."},[g._param("browser name, i.e. Internet Explorer or Safari",a),g._enum(c?"video call":"call",{"video call":"video call",call:"call"}),g._param("link to install chrome",k(d))])}function k(a){return b("React").createElement(b("Link.react"),{onClick:a,href:"https://www.google.com/chrome/index.html",target:"_blank"},"Google Chrome")}function l(a){var c=b("XWorkplaceHomepageMainController").getURIBuilder().setString("path","chat-app").setString("ref","rtc_unsupported_dialog").getURI();return b("React").createElement(b("Link.react"),{onClick:a,href:c,target:"_blank"},"Workplace Chat")}e.exports=a}),null);
__d("MessengerRTCUnsupportedBrowserDialogController",["fbt","MessengerDialogs.bs","MessengerRTCGroupCallUnsupportedBrowserDialog.react","MessengerRTCUnsupportedBrowserDialog.react","React","UserAgent"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a={_dialog:null,_handleToggle:function(a){a||b("MessengerDialogs.bs").removeAllDialogs()},hideDialog:function(){b("MessengerDialogs.bs").removeAllDialogs()},_browserName:function(){if(b("UserAgent").isBrowser("Firefox"))return g._("Firefox");else if(b("UserAgent").isBrowser("IE"))return g._("Internet Explorer");else if(b("UserAgent").isBrowser("Safari"))return g._("Safari");else return g._("your browser")},render:function(a){var c=a.hasVideo,d=a.isGroupCall;b("MessengerDialogs.bs").showDialog(function(){return d?b("React").createElement(b("MessengerRTCGroupCallUnsupportedBrowserDialog.react"),{browserName:this._browserName(),hasVideo:c,hideDialog:this.hideDialog,onUnmount:this._handleToggle}):b("React").createElement(b("MessengerRTCUnsupportedBrowserDialog.react"),{browserName:this._browserName(),hasVideo:c,hideDialog:this.hideDialog,onUnmount:this._handleToggle})}.bind(this))},dismiss:b("MessengerDialogs.bs").removeAllDialogs};e.exports=a}),null);
__d("BonfireUserFetcher",["regeneratorRuntime","Promise","LogHistory","RelayFBEnvironment","RelayModern","RTCUser","immutable","nullthrows","BonfireUserFetcherQuery.graphql"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("RelayModern").fetchQuery;b("RelayModern").graphql;var i=b("immutable").List,j=b("immutable").Map;b("immutable").Set;function k(a){__p&&__p();return b("regeneratorRuntime").async(function(c){__p&&__p();while(1)switch(c.prev=c.next){case 0:c.prev=0;c.next=3;return b("regeneratorRuntime").awrap(h(b("RelayFBEnvironment"),g||(g=function(){return b("BonfireUserFetcherQuery.graphql")}),{userId:a}));case 3:return c.abrupt("return",c.sent);case 6:c.prev=6;c.t0=c["catch"](0);b("LogHistory").getInstance("bonfire_fetcher").error("fetch_error",JSON.stringify(c.t0));throw c.t0;case 10:case"end":return c.stop()}},null,this,[[0,6]])}function l(a){__p&&__p();var c,d,e;a=a.node;e=(e=a)!=null?(e=e.bonfire_user)!=null?e.id:e:e;d=(d=a)!=null?d.id:d;if(!e||!d)return null;e=b("nullthrows")((e=a)!=null?(e=e.bonfire_user)!=null?e.display_name:e:e);c=b("nullthrows")((c=a)!=null?(c=c.bonfire_user)!=null?c.username:c:c);a=b("nullthrows")((a=a)!=null?(a=a.bonfire_user)!=null?a.profile_picture_uri:a:a);return new(b("RTCUser"))({FBID:d,profileUrl:null,profilePictureUrl:a,isMessengerUser:!1,userName:e,userShortName:c})}function m(a){__p&&__p();var c,d,e;a=a.node;e=(e=a)!=null?(e=e.bonfire_user)!=null?e.id:e:e;d=(d=a)!=null?d.id:d;if(!e||!d)return null;e=b("nullthrows")((e=a)!=null?(e=e.bonfire_user)!=null?e.display_name:e:e);c=b("nullthrows")((c=a)!=null?(c=c.bonfire_user)!=null?c.username:c:c);a=b("nullthrows")((a=a)!=null?(a=a.bonfire_user)!=null?a.profile_picture_uri:a:a);return{accepts_messenger_user_feedback:!1,big_image_src:a,employee:!1,fbid:d,gender:0,href:null,id:"fbid:"+d,image_src:a,is_business_enabled:null,is_employee_away:null,is_friend:null,is_messenger_user:null,is_messenger_platform_bot:null,is_parties_user:!0,is_verified:null,name:e,short_name:e,type:null,vanity:c,timezone:null,personal_id:null,work_id:null}}function n(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(k(a));case 2:c=d.sent;return d.abrupt("return",m(c));case 4:case"end":return d.stop()}},null,this)}function a(a){__p&&__p();var c,d,e,f;return b("regeneratorRuntime").async(function(g){__p&&__p();while(1)switch(g.prev=g.next){case 0:c=i(a);d=c.map(function(a){return n(a)}).toArray();g.next=4;return b("regeneratorRuntime").awrap(b("Promise").all(d));case 4:e=g.sent;f=j(c.zip(e));return g.abrupt("return",f.mapKeys(function(a,b){return b&&b.id||a}));case 7:case"end":return g.stop()}},null,this)}function c(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(n(a));case 2:c=d.sent;return d.abrupt("return",b("nullthrows")(c));case 4:case"end":return d.stop()}},null,this)}function d(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(k(a));case 2:c=d.sent;return d.abrupt("return",l(c));case 4:case"end":return d.stop()}},null,this)}e.exports={fetchAllParticipants:a,fetchParticipant:c,fetchUser:d}}),null);
__d("MessengerRTCBonfireIncomingCall.react",["cx","fbt","BonfireLogger","BonfireUserFetcher","CurrentUser","ImageBlock.react","MessengerContactImage.react","MessengerDialog.react","MessengerDialogBody.react","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","MessengerDialogs.bs","MessengerSpinner.react","React","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j=50;c=babelHelpers.inherits(a,b("React").Component);i=c&&c.prototype;function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=i.constructor).call.apply(a,[this].concat(e)),this.state={callerParticipant:null},this.$4=function(event){event.preventDefault(),b("MessengerDialogs.bs").removeAllDialogs(),this.props.onDecline(),b("BonfireLogger").logClick("messenger_ring_dialog","ignore_ring")}.bind(this),this.$5=function(event){event.preventDefault(),b("MessengerDialogs.bs").removeAllDialogs(),this.props.onAccept(),b("BonfireLogger").logClick("messenger_ring_dialog","accept_ring")}.bind(this),this.$1=function(a){a||(b("MessengerDialogs.bs").removeAllDialogs(),this.props.onDecline())}.bind(this),c}a.prototype.componentDidMount=function(){b("promiseDone")(b("BonfireUserFetcher").fetchParticipant(this.props.callerID),function(a){this.setState({callerParticipant:a})}.bind(this)),b("BonfireLogger").logImpression("messenger_ring_dialog")};a.prototype.render=function(){return b("React").createElement(b("MessengerDialog.react"),{layerHideOnBlur:!1,shown:!0,onToggle:this.$1,width:400},b("React").createElement(b("MessengerDialogHeader.react"),null,this.$2()),b("React").createElement(b("MessengerDialogBody.react"),null,this.$3()),b("React").createElement(b("MessengerDialogFooter.react"),null,b("React").createElement(b("MessengerDialogButton.react"),{use:"default",label:h._("Decline"),onClick:this.$4,type:"secondary"}),b("React").createElement(b("MessengerDialogButton.react"),{use:"default",label:h._("Accept"),onClick:this.$5,type:"primary"})))};a.prototype.$2=function(){return b("CurrentUser").isWorkUser()?h._("Incoming Workplace Meet Group Video Call"):h._("Incoming Bonfire Group Video Call")};a.prototype.$3=function(){var a=this.state.callerParticipant;return!a?b("React").createElement(b("MessengerSpinner.react"),null):b("React").createElement(b("ImageBlock.react"),null,b("React").createElement(b("MessengerContactImage.react"),{isMessengerUser:a.is_messenger_user,size:j,src:a.big_image_src||a.image_src}),b("React").createElement("div",{className:"_2n1r"},b("React").createElement("div",{className:"_2n1s"},h._("{caller name} is calling you.",[h._param("caller name",a.name)])),b("React").createElement("div",{className:"_2n1t"},h._("The call will start as soon as you answer."))))};e.exports=a}),null);
__d("MessengerRTCGroupCallIncomingDialog.react",["cx","fbt","Facepile.react","ImageBlock.react","MercuryIDs","MessengerContactImageReact.bs","MessengerDialog.react","MessengerDialogBodyReact.bs","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","MessengerDialogs.bs","MessengerParticipants.bs","React","RTWebLoggingCallType","RTWebLoggingComponent","RTWebLoggingSurface","RTWebUserActionLogger","RungParticipantsAddedSubscription","VideoCallWebDriverIDs","gkx","immutable"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j=b("MessengerContactImageReact.bs").jsComponent,k=b("MessengerDialogBodyReact.bs").jsComponent,l=400,m=5,n=50,o=function(a,b){a?a=b?h._("Incoming Group Video Chat"):h._("Incoming Group Call"):a=b?h._("Incoming Video Chat"):h._("Incoming Call");return a},p=function(a,b,c){a?a=b?h._("{caller name} started a group video chat in a group you're a member of.",[h._param("caller name",c.name)]):h._("{caller name} started a group call in a group you're a member of.",[h._param("caller name",c.name)]):a=b?h._("{caller name} invited you to a group video chat.",[h._param("caller name",c.name)]):h._("{caller name} invited you to a group call.",[h._param("caller name",c.name)]);return a},q=function(a){var c=a.isGroupCall;a=a.hasVideo;return b("React").createElement(b("MessengerDialogHeader.react"),null,o(c,a))},r=function(a){var c=a.isGroupCall,d=a.hasVideo,e=a.caller;a=a.callees;return b("React").createElement(k,null,b("React").createElement(b("ImageBlock.react"),null,b("React").createElement(j,{isMessengerUser:e.is_messenger_user,size:n,src:e.big_image_src||e.image_src}),b("React").createElement("div",{className:"_2n1r"},b("React").createElement("div",{className:"_2n1s"},p(c,d,e)),b("React").createElement(b("Facepile.react"),{moreCount:Math.max(0,a.length-m),profiles:a.map(function(a){var b=a.name,c=a.fbid;a=a.big_image_src;return{name:b,uniqueID:c,profilePicURI:a}}).slice(0,m),size:"medium"}),b("React").createElement("div",{className:"_2n1t"},b("gkx")("AT4uLl1AB6JLlOysf-A2hpwt4KJLHV_bjB3XyRsO-BgTRrIBrw0NJXG9gSXonEK94SJbVDuoLSgqS0Dkh4vrerSG")&&s(a)?h._("This group includes people you've blocked."):d?h._("Video will start as soon as you answer."):h._("The call will start as soon as you answer.")))))},s=function(a){return a.some(function(a){return a.is_messenger_blocked||a.is_facebook_blocked})},t=function(a,c,d,e){b("MessengerDialogs.bs").removeAllDialogs(),a(),b("RTWebUserActionLogger").logClick({callID:d,callType:b("RTWebLoggingCallType").MW,conferenceName:e,page:b("RTWebUserActionLogger").getPage(),surface:b("RTWebLoggingSurface").INCOMING_DIALOG,component:b("RTWebLoggingComponent").DECLINE,mediaType:b("RTWebUserActionLogger").getMediaType(!c)})},u=function(a,c,d,e){b("MessengerDialogs.bs").removeAllDialogs(),a(),b("RTWebUserActionLogger").logClick({callID:d,callType:b("RTWebLoggingCallType").MW,conferenceName:e,page:b("RTWebUserActionLogger").getPage(),surface:b("RTWebLoggingSurface").INCOMING_DIALOG,component:b("RTWebLoggingComponent").ACCEPT,mediaType:b("RTWebUserActionLogger").getMediaType(!c)})},v=function(a,c){a||(b("MessengerDialogs.bs").removeAllDialogs(),c())};c=babelHelpers.inherits(a,b("React").Component);i=c&&c.prototype;function a(a){i.constructor.call(this,a),this.$2=null,this.$3()}a.prototype.componentDidMount=function(){b("MessengerParticipants.bs").getMulti(this.props.participantIDs.map(b("MercuryIDs").getParticipantIDFromUserID),function(a){var c=b("immutable").Map(a).filter(function(a){return a.id!=this.props.callerID}.bind(this));this.$1=a[this.props.callerID];this.setState({rungParticipants:c})}.bind(this)),b("RTWebUserActionLogger").logImpression({callID:this.props.callID,callType:b("RTWebLoggingCallType").MW,conferenceName:this.props.conferenceName,page:b("RTWebUserActionLogger").getPage(),surface:b("RTWebLoggingSurface").INCOMING_DIALOG,mediaType:b("RTWebUserActionLogger").getMediaType(!this.props.hasVideo)})};a.prototype.$3=function(){__p&&__p();var a=this.props.conferenceName.split(":")[1];this.$2=b("RungParticipantsAddedSubscription").subscribe(a,function(a){__p&&__p();a=a.rung_participants_added_subscribe.call.rung_participants.edges;if(a.length>this.state.rungParticipants.size){a=a.map(function(a){a=a.node.id;return b("MercuryIDs").getParticipantIDFromUserID(a)}).filter(function(a){return!this.state.rungParticipants.has(a)}.bind(this));b("MessengerParticipants.bs").getMulti(a,function(a){a=this.state.rungParticipants.concat(a);this.setState({rungParticipants:a})}.bind(this))}}.bind(this))};a.prototype.componentWillUnmount=function(){if(!this.$2)return;this.$2.unsubscribe();this.$2=null};a.prototype.render=function(){if(!this.$1)return null;var a=this.props,c=a.hasVideo,d=a.isGroupCall,e=a.onIgnore,f=a.onAnswer,g=a.callID,i=a.conferenceName;return b("React").createElement(b("MessengerDialog.react"),{layerHideOnBlur:!1,shown:!0,onToggle:function(a){return v(a,e)},width:l},b("React").createElement(q,{hasVideo:c,isGroupCall:d}),b("React").createElement(r,{isGroupCall:d,hasVideo:c,caller:this.$1,callees:this.state.rungParticipants.valueSeq().toArray()}),b("React").createElement(b("MessengerDialogFooter.react"),null,b("React").createElement(b("MessengerDialogButton.react"),{label:h._("Ignore"),onClick:function(){return t(e,c,g,i)},dataTestID:b("VideoCallWebDriverIDs").IGNORE_CALL_BUTTON,type:"secondary"}),b("React").createElement(b("MessengerDialogButton.react"),{label:h._("Answer Call"),onClick:function(){return u(f,c,g,i)},dataTestID:b("VideoCallWebDriverIDs").ANSWER_CALL_BUTTON,type:"primary"})))};e.exports=a}),null);
__d("RTCGroupCallIncomingDialog.react",["cx","fbt","MercuryIDs","MessengerDialog.react","MessengerDialogBodyReact.bs","MessengerDialogs.bs","MessengerParticipants.bs","MessengerProfileImageWrapperReact.bs","React","RTCAcceptButton.react","RTCDeclineButton.react","RTWebLoggingCallType","RTWebLoggingSurface","RTWebUserActionLogger","RungParticipantsAddedSubscription","SplitImage.react","immutable","intlList"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j=b("MessengerDialogBodyReact.bs").jsComponent,k=b("MessengerProfileImageWrapperReact.bs").jsComponent,l=260,m=80,n=function(a,c){a=h._("{names of users showed on group call incoming dialog}",[h._param("names of users showed on group call incoming dialog",b("intlList")(Array.of(a.short_name).concat(Array.from(c.map(function(a){return a.short_name}).values())),b("intlList").CONJUNCTIONS.AND))]);return a},o=function(a,b,c){a=b?h._("{caller name} wants you to join a group video chat.",[h._param("caller name",c.short_name)]):h._("{caller name} wants you to join a group call.",[h._param("caller name",c.short_name)]);return a},p=function(a){var c=a.isGroupCall,d=a.hasVideo,e=a.caller;a=a.callees;return b("React").createElement(j,null,b("React").createElement("div",{className:"_6jvn"},b("React").createElement(k,{className:"_4j_j",showBadge:!1,size:80},b("React").createElement(b("SplitImage.react"),{border:!0,className:"_4j_j",srcs:Array.of(e.image_src).concat(Array.from(a.map(function(a){return a.image_src}).values())),size:m,halfView:!0}))),b("React").createElement("div",{className:"_6jvz"},n(e,a)),b("React").createElement("div",{className:"_6jw4"},o(c,d,e)))},q=function(a,c){a||(b("MessengerDialogs.bs").removeAllDialogs(),c())};c=babelHelpers.inherits(a,b("React").Component);i=c&&c.prototype;function a(a){i.constructor.call(this,a),this.$2=null,this.$3()}a.prototype.componentDidMount=function(){b("MessengerParticipants.bs").getMulti(this.props.participantIDs.map(b("MercuryIDs").getParticipantIDFromUserID),function(a){var c=b("immutable").Map(a).filter(function(a){return a.id!=this.props.callerID}.bind(this));this.$1=a[this.props.callerID];this.setState({rungParticipants:c})}.bind(this)),b("RTWebUserActionLogger").logImpression({callID:this.props.callID,callType:b("RTWebLoggingCallType").MW,conferenceName:this.props.conferenceName,page:b("RTWebUserActionLogger").getPage(),surface:b("RTWebLoggingSurface").INCOMING_DIALOG,mediaType:b("RTWebUserActionLogger").getMediaType(!this.props.hasVideo)})};a.prototype.$3=function(){__p&&__p();var a=this.props.conferenceName.split(":")[1];this.$2=b("RungParticipantsAddedSubscription").subscribe(a,function(a){__p&&__p();a=a.rung_participants_added_subscribe.call.rung_participants.edges;if(a.length>this.state.rungParticipants.size){a=a.map(function(a){a=a.node.id;return b("MercuryIDs").getParticipantIDFromUserID(a)}).filter(function(a){return!this.state.rungParticipants.has(a)}.bind(this));b("MessengerParticipants.bs").getMulti(a,function(a){a=this.state.rungParticipants.concat(a);this.setState({rungParticipants:a})}.bind(this))}}.bind(this))};a.prototype.componentWillUnmount=function(){if(!this.$2)return;this.$2.unsubscribe();this.$2=null};a.prototype.render=function(){return!this.$1?null:b("React").createElement(b("MessengerDialog.react"),{className:"_6jvl",layerHideOnBlur:!1,shown:!0,onToggle:function(a){return q(a,this.props.onIgnore)}.bind(this),width:l},b("React").createElement(p,{isGroupCall:this.props.isGroupCall,hasVideo:this.props.hasVideo,caller:this.$1,callees:this.state.rungParticipants.valueSeq().toArray()}),b("React").createElement("div",{className:"_6jvm"},b("React").createElement(b("RTCDeclineButton.react"),{isP2P:!1,action:this.props.onIgnore}),b("React").createElement(b("RTCAcceptButton.react"),{onAccept:this.props.onAnswer,isVideoCall:this.props.hasVideo,isP2P:!1})))};e.exports=a}),null);
__d("MessengerRTCGroupCallIncomingDialogController",["EventEmitter","FBRTCSoundController","MercuryIDs","MessengerBrowserAlerts","MessengerDialogs.bs","MessengerParticipants.bs","MessengerRTCBonfireIncomingCall.react","MessengerRTCGroupCallIncomingDialog.react","MessengerRTCIncomingDialog.react","PartiesUtils","React","RTCGroupCallIncomingDialog.react","RTCUtils","RTWebClientFeatureGating","XGroupCallController","clearTimeout","randomInt","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=7e4;c=babelHelpers.inherits(a,b("EventEmitter"));g=c&&c.prototype;function a(a,b,c,d,e,f){g.constructor.call(this),this.$MessengerRTCGroupCallIncomingDialogController1=a,this.$MessengerRTCGroupCallIncomingDialogController2=b,this.$MessengerRTCGroupCallIncomingDialogController3=c,this.$MessengerRTCGroupCallIncomingDialogController4=d,this.$MessengerRTCGroupCallIncomingDialogController5=e,this.$MessengerRTCGroupCallIncomingDialogController6=f,this.$MessengerRTCGroupCallIncomingDialogController7=null,this.$MessengerRTCGroupCallIncomingDialogController8=null,this.$MessengerRTCGroupCallIncomingDialogController9=!1}a.prototype.serverInfoData=function(){return this.$MessengerRTCGroupCallIncomingDialogController6};a.prototype.showIncomingDialog=function(){__p&&__p();this.$MessengerRTCGroupCallIncomingDialogController7=b("setTimeoutAcrossTransitions")(this.$MessengerRTCGroupCallIncomingDialogController10.bind(this),h);var a=this.$MessengerRTCGroupCallIncomingDialogController1+b("randomInt")(0,4294967295).toString();b("FBRTCSoundController").playIncomingRingtone(a,this.$MessengerRTCGroupCallIncomingDialogController1,!0);if(b("RTCUtils").isBonfireCall(this.$MessengerRTCGroupCallIncomingDialogController1))b("MessengerDialogs.bs").showDialog(function(){return b("React").createElement(b("MessengerRTCBonfireIncomingCall.react"),{callerID:this.$MessengerRTCGroupCallIncomingDialogController3,conferenceName:this.$MessengerRTCGroupCallIncomingDialogController1,onAccept:function(){return this.$MessengerRTCGroupCallIncomingDialogController11()}.bind(this),onDecline:function(){return this.$MessengerRTCGroupCallIncomingDialogController12()}.bind(this)})}.bind(this));else if(!b("RTCUtils").isSupportedMWCall(this.$MessengerRTCGroupCallIncomingDialogController1))b("MessengerParticipants.bs").get(b("MercuryIDs").getParticipantIDFromUserID(this.$MessengerRTCGroupCallIncomingDialogController3),function(a){return b("MessengerDialogs.bs").showDialog(function(){return b("React").createElement(b("MessengerRTCIncomingDialog.react"),{callID:this.$MessengerRTCGroupCallIncomingDialogController2.toString(),callerParticipant:a,isVideoCall:this.$MessengerRTCGroupCallIncomingDialogController5,onAccept:function(){return this.$MessengerRTCGroupCallIncomingDialogController11()}.bind(this),onDecline:function(){return this.$MessengerRTCGroupCallIncomingDialogController12()}.bind(this)})}.bind(this))}.bind(this));else{a=[this.$MessengerRTCGroupCallIncomingDialogController3].concat(this.$MessengerRTCGroupCallIncomingDialogController4);var c=b("RTWebClientFeatureGating").useNewIncomingCallDialog()?b("React").createElement(b("RTCGroupCallIncomingDialog.react"),{callID:this.$MessengerRTCGroupCallIncomingDialogController2.toString(),callerID:b("MercuryIDs").getParticipantIDFromUserID(this.$MessengerRTCGroupCallIncomingDialogController3),conferenceName:this.$MessengerRTCGroupCallIncomingDialogController1,isGroupCall:b("RTCUtils").isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1),hasVideo:this.$MessengerRTCGroupCallIncomingDialogController5,onAnswer:function(){return this.$MessengerRTCGroupCallIncomingDialogController11()}.bind(this),onIgnore:function(){return this.$MessengerRTCGroupCallIncomingDialogController12()}.bind(this),participantIDs:a}):b("React").createElement(b("MessengerRTCGroupCallIncomingDialog.react"),{callID:this.$MessengerRTCGroupCallIncomingDialogController2.toString(),callerID:b("MercuryIDs").getParticipantIDFromUserID(this.$MessengerRTCGroupCallIncomingDialogController3),conferenceName:this.$MessengerRTCGroupCallIncomingDialogController1,isGroupCall:b("RTCUtils").isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1),hasVideo:this.$MessengerRTCGroupCallIncomingDialogController5,onAnswer:function(){return this.$MessengerRTCGroupCallIncomingDialogController11()}.bind(this),onIgnore:function(){return this.$MessengerRTCGroupCallIncomingDialogController12()}.bind(this),participantIDs:a});b("MessengerDialogs.bs").showDialog(function(){return c})}this.$MessengerRTCGroupCallIncomingDialogController13(this.$MessengerRTCGroupCallIncomingDialogController5)};a.prototype.$MessengerRTCGroupCallIncomingDialogController13=function(a){a={callID:this.$MessengerRTCGroupCallIncomingDialogController2.toString(),peerID:this.$MessengerRTCGroupCallIncomingDialogController3,onNotificationClicked:this.$MessengerRTCGroupCallIncomingDialogController11.bind(this),isVideoCall:a,isGroupCall:b("RTCUtils").isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1)};b("MessengerBrowserAlerts").showRTCNotification(a,function(a){this.$MessengerRTCGroupCallIncomingDialogController8=a,this.$MessengerRTCGroupCallIncomingDialogController9&&this.$MessengerRTCGroupCallIncomingDialogController14()}.bind(this))};a.prototype.cancel=function(){this.$MessengerRTCGroupCallIncomingDialogController7&&b("clearTimeout")(this.$MessengerRTCGroupCallIncomingDialogController7),b("MessengerDialogs.bs").removeAllDialogs(),b("FBRTCSoundController").stopIncomingRingtone(),this.$MessengerRTCGroupCallIncomingDialogController8&&this.$MessengerRTCGroupCallIncomingDialogController14(),this.$MessengerRTCGroupCallIncomingDialogController9=!0};a.prototype.$MessengerRTCGroupCallIncomingDialogController11=function(){this.cancel();var a=b("RTCUtils").parseBonfireID(this.$MessengerRTCGroupCallIncomingDialogController1);if(a)b("PartiesUtils").joinBonfire(a,"messenger_ring");else{a=b("XGroupCallController").getURIBuilder().setString("call_context",this.$MessengerRTCGroupCallIncomingDialogController1).setInt("call_id",this.$MessengerRTCGroupCallIncomingDialogController2).setBool("has_video",this.$MessengerRTCGroupCallIncomingDialogController5).setString("server_info_data",this.$MessengerRTCGroupCallIncomingDialogController6).getURI();this.emit("answerCall",this.$MessengerRTCGroupCallIncomingDialogController1,a)}};a.prototype.$MessengerRTCGroupCallIncomingDialogController12=function(){this.cancel(),this.emit("ignoreCall")};a.prototype.$MessengerRTCGroupCallIncomingDialogController10=function(){this.cancel(),this.emit("timeout")};a.prototype.$MessengerRTCGroupCallIncomingDialogController14=function(){this.$MessengerRTCGroupCallIncomingDialogController8&&(this.$MessengerRTCGroupCallIncomingDialogController8.close(),this.$MessengerRTCGroupCallIncomingDialogController8=null)};e.exports=a}),null);
__d("MercuryParticipantListRenderer",["fbt","MercuryIDs"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function a(){this.$6=function(a){var c=this.$5;if(c){var d=b("MercuryIDs").getUserIDFromParticipantID(a.id);if(d&&c[d])return c[d]}return this.$2?a.short_name:a.name}.bind(this),this.$1=!1,this.$2=!1,this.$3=!1,this.$4=0,this.$5=null}a.prototype.renderParticipantList=function(a){a=a.map(this.$6);switch(a.length){case 0:return h(this.$1);case 1:return i(a);case 2:return this.$3?k(a):j(a);case 3:return this.$3?m(a):l(a);default:return this.$3?o(a,this.$4):n(a,this.$4)}};a.prototype.setIsNewThread=function(a){this.$1=a;return this};a.prototype.setNameRenderer=function(a){this.$6=a;return this};a.prototype.setUseShortName=function(a){this.$2=a;return this};a.prototype.setNickname=function(a){this.$5=a;return this};a.prototype.setUseAndSeparator=function(a){this.$3=a;return this};a.prototype.setTotalParticipantCount=function(a){this.$4=a;return this};function h(a){if(a)return g._("New Message");else return g._("No Participants")}function i(a){return a[0]}function j(a){return g._("{participant1}, {participant2}",[g._param("participant1",a[0]),g._param("participant2",a[1])])}function k(a){return g._("{participant1} and {participant2}",[g._param("participant1",a[0]),g._param("participant2",a[1])])}function l(a){return g._("{participant1}, {participant2}, {participant3}",[g._param("participant1",a[0]),g._param("participant2",a[1]),g._param("participant3",a[2])])}function m(a){return g._("{participant1}, {participant2} and {participant3}",[g._param("participant1",a[0]),g._param("participant2",a[1]),g._param("participant3",a[2])])}function n(a,b){return g._("{participant1}, {participant2}, {participant3}, {others_link}",[g._param("participant1",a[0]),g._param("participant2",a[1]),g._param("participant3",a[2]),g._param("others_link",p((b||a.length)-3))])}function o(a,b){return g._("{participant1}, {participant2} and {others_link}",[g._param("participant1",a[0]),g._param("participant2",a[1]),g._param("others_link",p((b||a.length)-2))])}function p(a){if(a>1)return g._({"*":"{others_count} others"},[g._param("others_count",a,[0])]);else return g._("1 other")}e.exports=a}),null);
__d("MercuryThreadTitle.react",["fbt","MercuryIDs","MercuryParticipantListRenderer","MessengerParticipants.bs","MessengerTextWithEmoticons.react","React"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=b("React").PropTypes;c=b("React").createClass({displayName:"MercuryThreadTitle",propTypes:{className:a.string,isNewThread:a.bool,maxTitle:a.number,showUnreadCount:a.bool,thread:a.object.isRequired,useAndSeparator:a.bool,useShortName:a.bool,viewer:a.string.isRequired},getDefaultProps:function(){return{isNewThread:!1,showUnreadCount:!1,useShortName:!1,useAndSeparator:!1}},getInitialState:function(){return{participantNames:""}},componentDidMount:function(){this._renderParticipantsList(this.props)},UNSAFE_componentWillReceiveProps:function(a){this._renderParticipantsList(a)},render:function(){return b("React").createElement("span",{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children)},getTitle:function(){return this.state.participantNames},_renderThreadTitle:function(){var a=this.props.thread,c=this.props.maxTitle?this.props.maxTitle<a.name.length?a.name.slice(0,this.props.maxTitle)+"...":a.name:a.name;c=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:c});return!a.unread_count||!this.props.showUnreadCount?c:this._renderTitleWithUnreadCount(c,a.unread_count)},_renderParticipantsList:function(a){__p&&__p();if(a.thread.name)return;this.setState({participantNames:""});var c=b("MercuryIDs").getParticipantIDFromUserID(a.viewer),d=a.thread.participants||[];d.length>1&&(d=d.filter(function(a){return a!=c}));b("MessengerParticipants.bs").getMulti(d,function(c){__p&&__p();if(!this.isMounted())return;var e=d.map(function(a){return c[a]}),f=a.thread.custom_nickname?{}:null,g=b("MessengerTextWithEmoticons.react");if(f)for(var h in a.thread.custom_nickname)f[h]=b("React").createElement(g,{renderEmoticons:!0,renderEmoji:!0,text:a.thread.custom_nickname[h]});g=new(b("MercuryParticipantListRenderer"))().setUseShortName(a.useShortName).setUseAndSeparator(a.useAndSeparator).setIsNewThread(a.isNewThread).setNickname(f).renderParticipantList(e);f=a.showUnreadCount&&a.thread.unread_count?this._renderTitleWithUnreadCount(g,a.thread.unread_count):g;this.setState({participantNames:f})}.bind(this))},_renderTitleWithUnreadCount:function(a,b){return g._("{conversation-title} ({unread-count})",[g._param("conversation-title",a),g._param("unread-count",b)])}});e.exports=c}),null);
__d("RTCCallTitle.react",["MercuryIDs","MercuryParticipantListRenderer","React","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){__p&&__p();var c=a.viewer,d=a.participants;a=a.className;var e=b("MercuryIDs").getParticipantIDFromUserID(c);c=Object.keys(d.toJS());c.length>1&&(c=c.filter(function(a){return a!=e}));c=c.map(function(a){return d.get(a)});c=new(b("MercuryParticipantListRenderer"))().setUseShortName(!1).setUseAndSeparator(!1).renderParticipantList(c);return b("React").createElement("span",{className:a},c)};e.exports=a}),null);
__d("MessengerRTCGroupCallThreadRow.react",["cx","fbt","MercuryParticipantsImage.react","MercuryThreadTitle.react","MessengerProfileImageWrapperReact.bs","MessengerThreadImageReact.bs","React","RTCCallTitle.react"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=b("MessengerProfileImageWrapperReact.bs").jsComponent,j=b("MessengerThreadImageReact.bs").jsComponent,k=function(a){var c=a.displayAddMemberWarning,d=a.displayBlockedMemberWarning,e=a.participants,f=a.thread;a=a.viewerID;return b("React").createElement("div",{className:"_5y31"},b("React").createElement(j,{className:"_5y32",participants:e,thread:f,viewer:a}),b("React").createElement("div",{className:"_5y34"},b("React").createElement(b("MercuryThreadTitle.react"),{className:"_5y37",thread:f,viewer:a}),c?b("React").createElement(m,null):null,d?b("React").createElement(n,null):null))},l=function(a){var c=a.displayAddMemberWarning,d=a.displayBlockedMemberWarning,e=a.participants;a.thread;a=a.viewerID;return b("React").createElement("div",{className:"_5y31"},b("React").createElement(i,{className:"_5y32",showBadge:!1},b("React").createElement(b("MercuryParticipantsImage.react"),{participants:Object.keys(e.toJS()),size:50})),b("React").createElement("div",{className:"_5y34"},b("React").createElement(b("RTCCallTitle.react"),{className:"_5y37",participants:e,viewer:a}),c?b("React").createElement(m,null):null,d?b("React").createElement(n,null):null))},m=function(){return b("React").createElement("div",{className:"_1apf"},h._("People you add to this group video will see previous messages in this conversation."))},n=function(){return b("React").createElement("div",{className:"_1ydy"},h._("You are about to ring people you've blocked."))};a=function(a){var c=a.thread;a=babelHelpers.objectWithoutProperties(a,["thread"]);return c?b("React").createElement(k,babelHelpers["extends"]({thread:c},a)):b("React").createElement(l,babelHelpers["extends"]({thread:c},a))};e.exports=a}),null);
__d("XVideoCallAdminMessageController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/admin_msg/",{})}),null);
__d("FBRTCAdminMessage",["FBRTCCallConstants","FBRTCConstants","FBRTCLogger","FBRTCUtils","XVideoCallAdminMessageController","emptyFunction","performanceNow"],(function(a,b,c,d,e,f){__p&&__p();function a(a,b){"use strict";this.$1=a,this.$2=b,this.$3=Date.now(),this.$4=null,this.$5=null}a.prototype.onCallConnected=function(){"use strict";this.$4||(this.$4=b("performanceNow")())};a.prototype.onCallEnded=function(){"use strict";this.$5||(this.$5=b("performanceNow")())};a.prototype.submit=function(a,c){"use strict";this.$5||this.onCallEnded();var d=0,e=b("FBRTCCallConstants").FBRTCCallConnectionType.MISSED_CALL;this.$4&&this.$5&&(d=Math.ceil(this.$5-this.$4),e=b("FBRTCCallConstants").FBRTCCallConnectionType.CONNECTED_CALL);c=e===b("FBRTCCallConstants").FBRTCCallConnectionType.CONNECTED_CALL||c===b("FBRTCConstants").CallEndReason.IGNORE_CALL;this.$6({peer_id:this.$1,call_id:this.$2,start_time:this.$3,call_duration:d,message_type:e,call_category:a,call_acknowledged:c})};a.prototype.$6=function(a){"use strict";var c=b("XVideoCallAdminMessageController").getURIBuilder().getURI();b("FBRTCUtils").sendServerRequest(c,b("emptyFunction"),this.$7.bind(this,a.peer_id,a.call_id),!1,undefined,a)};a.prototype.$7=function(a,c,d){"use strict";d?d="Fail to log admin message, error "+d.error:d="Server timed out on logging admin message";b("FBRTCLogger").getInstance().logError(a,c,d)};e.exports=a}),null);
__d("FBRTCIceCache",[],(function(a,b,c,d,e,f){__p&&__p();function a(){"use strict";this.$1={}}a.prototype.reset=function(a,b){"use strict";this.$1[a]||(this.$1[a]={}),this.$1[a][b]=[]};a.prototype.cacheCandidate=function(a,b,c){"use strict";this.$1[a]||(this.$1[a]={}),this.$1[a][b]||(this.$1[a][b]=[]),this.$1[a][b].unshift(c)};a.prototype.drainCandidates=function(a,b,c){"use strict";if(this.$1[a]&&this.$1[a][b]){var d;while(this.$1[a][b].length>0)d=this.$1[a][b].pop(),c(d)}};e.exports=a}),null);
__d("FBRTCPCConfig",["FBRTCConfig","FBRTCVersionDetection"],(function(a,b,c,d,e,f){__p&&__p();var g="stun:stun.fbsbx.com:3478";function h(a,c,d){if(b("FBRTCVersionDetection").isChrome()&&b("FBRTCVersionDetection").webrtcVersion()>=34){var e={urls:a};c!==undefined&&d!==undefined&&(e.username=c,e.credential=d);return[e]}e=[];for(var f=0;f<a.length;f++)c!==undefined&&d!==undefined?e.push({url:a[f],username:c,credential:d}):e.push({url:a[f]});return e}function a(){"use strict";this.sslPort="",this.tcpPort="",this.turnIP="",this.turnPassword="",this.turnUsername="",this.udpPort=""}a.prototype.setTurnCredentials=function(a){"use strict";this.turnIP=a.ip,this.udpPort=a.udp_port,this.tcpPort=a.tcp_port,this.sslPort=a.ssl_tcp_port,this.turnUsername=a.username,this.turnPassword=a.password};a.prototype.getConfig=function(){"use strict";if(b("FBRTCConfig").isVCEndpointCall())return{iceServers:[]};var a=h([g]).concat(h(this.$1(),this.turnUsername,this.turnPassword));return{iceServers:a}};a.prototype.getConstraints=function(a){a===void 0&&(a=!1);var c=!0;b("FBRTCVersionDetection").isChromium()&&b("FBRTCVersionDetection").webrtcVersion()<57&&a&&(c=!1);return{mandatory:{},optional:[{DtlsSrtpKeyAgreement:c},{googHighBitrate:!0},{googVeryHighBitrate:!0}]}};a.prototype.$1=function(){"use strict";if(b("FBRTCVersionDetection").isFirefox()&&b("FBRTCVersionDetection").webrtcVersion()<27)return["turn:"+this.turnIP+":"+this.udpPort];else return["turn:"+this.turnIP+":"+this.udpPort+"?transport=udp","turn:"+this.turnIP+":"+this.tcpPort+"?transport=tcp","turn:"+this.turnIP+":"+this.sslPort+"?transport=tcp"]};e.exports=new a()}),null);
__d("FBRTCRetriableMessage",["FBRTCConstants","mixInEventEmitter"],(function(a,b,c,d,e,f){__p&&__p();var g=1e4,h=7e3,i=1;function a(a){"use strict";this.$1=a,this.$2=g,this.$3=i,this.$4=null,this.$5=null,this.$6=null}a.prototype.sendMessage=function(a,c,d,e,f,g,i,j){"use strict";__p&&__p();this.$4=c;switch(a){case b("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.$5=this.$1.sendPCRestartOffer(c,d,e,f,g);break;case b("FBRTCConstants").PayloadType.OFFER:this.$5=this.$1.sendOffer(c,d,e,f,g,j);break;case b("FBRTCConstants").PayloadType.ANSWER:this.$2=h;this.$5=this.$1.sendAnswer(c,d,e,f,g,i);break}this.$7()};a.prototype.isAckMsg=function(a){"use strict";return this.$5&&this.$5.msg_id===a.ack_id};a.prototype.stopRetrying=function(){"use strict";this.$6&&(clearTimeout(this.$6),this.$4=null,this.$5=null,this.$6=null)};a.prototype.$7=function(){"use strict";this.$6=setTimeout(this.$8.bind(this),this.$2)};a.prototype.$8=function(){"use strict";this.$3<1?this.emit("timeoutFailure"):(this.emit("sendingRetry"),this.$1.resendSdpMessage(this.$4,this.$5),this.$7(),this.$3-=1)};b("mixInEventEmitter")(a,{sendingRetry:!0,timeoutFailure:!0});e.exports=a}),null);
__d("XVideoCallTurnDiscoveryController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/turndiscovery/",{version:{type:"Int",required:!0}})}),null);
__d("FBRTCTurnDiscovery",["Promise","FBRTCLogger","FBRTCUtils","XVideoCallTurnDiscoveryController"],(function(a,b,c,d,e,f){__p&&__p();var g=3,h=null;a={requestTurnCreds:function(a,c,d){__p&&__p();d===void 0&&(d=g);if(h)return h;var e=1,f=b("XVideoCallTurnDiscoveryController").getURIBuilder().setInt("version",e).getURI();h=new(b("Promise"))(function(e,g){h(d);function h(d){b("FBRTCUtils").sendServerRequest(f,function(a){a=a.payload;return e(a)},function(){d>0?(b("FBRTCLogger").getInstance().logError(c,a,"Failed turn; going to retry"),h(d-1)):g(new Error("failed"))})}});return h}};e.exports=a}),null);
__d("FBRTCUserSettings",["Promise","RTCMediaDevices","mixInEventEmitter"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={audioInput:"",audioOutput:"default",videoInput:"",remoteStream:null,_audioInputLabel:null,_videoInputLabel:null,isEnabled:function(){return Boolean(b("RTCMediaDevices").isSupported("enumerateDevices"))},selectAudioInputByLabel:function(a){this.audioInput||(this.audioInput=this._selectByLabel(a,this._audioInputLabel));return this.audioInput},selectVideoInputByLabel:function(a){this.videoInput||(this.videoInput=this._selectByLabel(a,this._videoInputLabel));return this.videoInput},_selectByLabel:function(a,b){__p&&__p();for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;if(b&&b===e.label)return e.deviceId}return null},previewStart:function(){this.emit("previewStarted")},previewEnd:function(){this.emit("previewEnded")},save:function(a){var c=a.audioInput,d=a.audioOutput,e=a.videoInput;return new(b("Promise"))(function(a){var b=!!(c&&this.audioInput!==c||e&&this.videoInput!==e);this.audioInput=c;this.audioOutput=d;this.videoInput=e;this.emit("saved",b);a(b)}.bind(this))},updateForLocalStream:function(a){__p&&__p();if(a.videoMediaSourceId)this.videoInput=a.videoMediaSourceId;else{var b=a.getVideoTracks();b=b[0];b&&(this._videoInputLabel=b.label)}if(a.audioMediaSourceId)this.audioInput=a.audioMediaSourceId;else{b=a.getAudioTracks();a=b[0];a&&(this._audioInputLabel=a.label)}},updateForRemoteStream:function(a){this.remoteStream=a,this.emit("remoteStreamChanged")},addListener:function(){},emit:function(){}};b("mixInEventEmitter")(a,{previewStarted:!0,previewEnded:!0,remoteStreamChanged:!0,saved:!0});e.exports=a}),null);
__d("PartiesRingResponseType",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({IGNORED_CALL:"ignored_call",ACCEPTED_CALL:"accepted_call",NO_ANSWER_TIMEOUT:"no_answer_timeout",RING_ACK:"ring_ack",CANCEL_ACK:"cancel_ack",ACCEPTED_ON_ANOTHER_DEVICE_ACK:"accepted_on_another_device_ack",IGNORED_ON_ANOTHER_DEVICE_ACK:"ignored_on_another_device_ack",RECEIVER_CONNECTED:"receiver_connected"})}),null);
__d("PartiesRingStopReason",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({ACCEPTED_ON_ANOTHER_DEVICE:"accepted_on_another_device",IGNORED_ON_ANOTHER_DEVICE:"ignored_on_another_device",CANCELLED_BY_CALLER:"cancelled_by_caller"})}),null);
__d("BonfireNotificationUtils",["BonfireRingResponseMutation","FBRTCDismissReason","FBRTCMessageType","FBRTCRingType","PartiesRingResponseType","PartiesRingStopReason","RTCUtils"],(function(a,b,c,d,e,f){__p&&__p();a={sendRingAck:function(a){l("ring_start",a)&&b("BonfireRingResponseMutation")({ringResponseType:b("PartiesRingResponseType").RING_ACK,senderFBID:h(a.data),senderBonfireUserID:i(a.data),senderBonfireID:j(a.data),ringRequestID:k(a.data)})},toFBRTCMessage:function(a){if(l("ring_start",a))return{endpoint:{appId:"",deviceId:"",userId:h(a.data)},jsonPayload:{body:{ringRequest:{caller:h(a.data),otherParticipants:[],capabilities_DEPRECATED:[],ringType:b("FBRTCRingType").GROUP_VIDEO_CALL}},header:{type:b("FBRTCMessageType").RING,conferenceName:g(a.data),transactionId:b("RTCUtils").generateRandomInt().toString(),retryCount:0,serverInfoData:""}}};else if(l("ring_stop",a))return{endpoint:{appId:"",deviceId:"",userId:h(a.data)},jsonPayload:{body:{dismissRequest:{reason:m(a.data),detailedReasonString:""}},header:{type:b("FBRTCMessageType").DISMISS,conferenceName:g(a.data),transactionId:b("RTCUtils").generateRandomInt().toString(),retryCount:0,serverInfoData:""}}};return null}};function g(a){return a.ppi?"BONFIRE:"+a.ppi:"BONFIRE:"}function h(a){return a.o.toString()}function i(a){return a.pui}function j(a){return a.ppi}function k(a){return a.ppnid}function l(a,b){return b.action===a}function m(a){switch(a.prsr){case b("PartiesRingStopReason").ACCEPTED_ON_ANOTHER_DEVICE:return b("FBRTCDismissReason").ANSWERED_ON_ANOTHER_DEVICE;case b("PartiesRingStopReason").IGNORED_ON_ANOTHER_DEVICE:return b("FBRTCDismissReason").REJECTED_ON_ANOTHER_DEVICE;case b("PartiesRingStopReason").CANCELLED_BY_CALLER:return b("FBRTCDismissReason").CALL_ENDED;default:return b("FBRTCDismissReason").INTERNAL_ERROR}}e.exports=a}),null);
__d("FBRTCMultiwayMessage",["ChannelManager","CurrentUser","FBRTCMessageType","RTCAppData","RTCUtils"],(function(a,b,c,d,e,f){__p&&__p();b("ChannelManager").startChannelManager();function g(a){"use strict";this.$1=a}g.prototype.isRequest=function(){"use strict";return this.$1.jsonPayload.header.responseStatusCode==null};g.prototype.isType=function(a){"use strict";return this.type()==a};g.prototype.transactionId=function(){"use strict";return this.$1.jsonPayload.header.transactionId};g.prototype.conferenceName=function(){"use strict";return this.$1.jsonPayload.header.conferenceName};g.prototype.serverInfoData=function(){"use strict";return this.$1.jsonPayload.header.serverInfoData};g.prototype.message=function(){"use strict";return this.$1};g.prototype.type=function(){"use strict";return this.header().type};g.prototype.endpoint=function(){"use strict";return this.$1.endpoint};g.prototype.header=function(){"use strict";return this.$1.jsonPayload.header};g.prototype.body=function(){"use strict";return this.$1.jsonPayload.body};g.prototype.incrementRetryCount=function(){"use strict";this.$1.jsonPayload.header.retryCount++};g.prototype.ringRequest=function(){"use strict";return this.isRequest()&&this.isType(b("FBRTCMessageType").RING)?this.body().ringRequest:null};g.prototype.dismissRequest=function(){"use strict";return this.isRequest()&&this.isType(b("FBRTCMessageType").DISMISS)?this.body().dismissRequest:null};g.prototype.serverMediaUpdateRequest=function(){"use strict";return this.isRequest()&&this.isType(b("FBRTCMessageType").SERVER_MEDIA_UPDATE)?this.body().serverMediaUpdateRequest:null};g.prototype.conferenceStateRequest=function(){"use strict";return this.isRequest()&&this.isType(b("FBRTCMessageType").CONFERENCE_STATE)?this.body().conferenceStateRequest:null};g.prototype.createResponse=function(a,c){"use strict";var d=c.body;c=c.callID;a={endpoint:{appId:b("RTCAppData").getMWAppID(),deviceId:b("ChannelManager").getCompleteConfig().sessionID,userId:b("CurrentUser").getID()},jsonPayload:{header:b("RTCUtils").createResponseHeader(this.header(),a,c?c:""),body:d||{}}};return new g(a)};e.exports=g}),null);
__d("XGroupCallSendMessageController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groupcall/sendmessage/",{webrtc_fbtrace:{type:"Int"}})}),null);
__d("RTCMessageSender",["Promise","AsyncRequest","CurrentUser","Fbtrace","RTCAppData","SiteData","XGroupCallSendMessageController"],(function(a,b,c,d,e,f){__p&&__p();var g=6e3;a.prototype.send=function(a){"use strict";__p&&__p();return new(b("Promise"))(function(c,d){__p&&__p();var e=a.jsonPayload.header.conferenceName;e={conference_name:e,user_id:b("CurrentUser").getID(),message:a,app_id:b("RTCAppData").getAppID(),app_version:String(b("SiteData").client_revision||"dev"),op:"RTCMessageSender.send",policy:"WebRTC"};e=b("Fbtrace").requestReceive("browser",String(b("SiteData").client_revision||"dev"),e);var f=b("XGroupCallSendMessageController").getURIBuilder().setInt("webrtc_fbtrace",e.isOn()?1:0).getURI();b("Fbtrace").withDefaultNode(e,function(){var e=new(b("AsyncRequest"))(f).setMethod("POST").setData({message:JSON.stringify(a)}).setAllowCrossPageTransition(!0).setHandler(function(a){c(a)}).setErrorHandler(function(a){a=a.getErrorDescription();a=Error(a!=null?a.toString():"AsyncRequest error");d(a)}).setTimeoutHandler(g,function(){d("Timeout")});e.send()})})};function a(){"use strict"}e.exports=a}),null);
__d("FBRTCTransactions",["Promise","FBRTCConsoleLogger","RTCMessageSender"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=6e4,h=Object.freeze({INIT:0,PROCESSING:1,COMPLETED:2,TERMINATED:3});function a(){this.$1=new Map()}a.prototype.findTransaction=function(a){return this.$1.get(a)};a.prototype.addTransaction=function(a){this.$1.set(a.id,a)};a.prototype.removeTransaction=function(a){this.$1["delete"](a.id)};a.prototype.getTransaction=function(a){return this.findTransaction(a.transactionId())||new i(this,a)};function i(a,c){this.id=c.transactionId(),this.$1=h.INIT,this.$2=c,this.$3=null,this.$4=a,this.$5=new Error("Unknown"),this.$6=null,this.$7=new(b("RTCMessageSender"))(),this.$8(),this.$4.addTransaction(this)}i.prototype.start=function(){__p&&__p();if(this.$1==h.INIT){this.$9(h.PROCESSING);return b("Promise").resolve(this.$2)}else if(this.$1==h.PROCESSING)return b("Promise").resolve(null);else if(this.$1==h.COMPLETED){this.$10();return b("Promise").resolve(null)}return b("Promise").reject(this.$5)};i.prototype.sendResponse=function(a){this.$3=a;this.$9(h.COMPLETED);return this.$7.send(a.message()).then(function(a){},function(a){this.$5=a,this.$9(h.TERMINATED)}.bind(this))};i.prototype.$10=function(){if(this.$3!=null){var a=this.$3;a.incrementRetryCount();this.sendResponse(a)}};i.prototype.$9=function(a){a!=this.$1&&(this.$1=a,this.$1!=h.TERMINATED&&this.$8(),this.$1==h.TERMINATED&&(this.$5=new Error("Terminated"),this.$4.removeTransaction(this)))};i.prototype.$8=function(){this.$6&&(clearTimeout(this.$6),this.$6=null),this.$6=setTimeout(function(){this.$9(h.TERMINATED)}.bind(this),g)};e.exports={FBRTCTransactionOwner:a,FBRTCServerTransaction:i}}),null);
__d("RTCGroupCallAddUserWarningDialog.react",["fbt","MessengerDialog.react","MessengerDialogBody.react","MessengerDialogButton.react","MessengerDialogCancelButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","MessengerDialogTitle.react","React"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var c=a.handleRing,d=a.onToggle,e=a.unMountParent;return b("React").createElement(b("MessengerDialog.react"),{onToggle:d},b("React").createElement(b("MessengerDialogHeader.react"),null,b("React").createElement(b("MessengerDialogTitle.react"),null,g._("Ring Members Warning"))),b("React").createElement(b("MessengerDialogBody.react"),null,g._("You are trying to ring blocked users.")),b("React").createElement(b("MessengerDialogFooter.react"),null,b("React").createElement(b("MessengerDialogCancelButton.react"),null),b("React").createElement(b("MessengerDialogButton.react"),{label:g._("Ring"),onClick:function(){d(),e(),c()},type:"primary",use:"default"})))};e.exports=a}),null);
__d("RTCGroupCallIncomingBlockedUserWarningDialog.react",["fbt","MessengerDialog.react","MessengerDialogBody.react","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","MessengerDialogTitle.react","React"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var c=a.leaveCall,d=a.onAddStream,e=a.onToggle;return b("React").createElement(b("MessengerDialog.react"),{onToggle:e},b("React").createElement(b("MessengerDialogHeader.react"),null,b("React").createElement(b("MessengerDialogTitle.react"),null,g._("Incoming Blocked User Warning"))),b("React").createElement(b("MessengerDialogBody.react"),null,g._("Blocked member is entering the call. Do you want to leave?")),b("React").createElement(b("MessengerDialogFooter.react"),null,b("React").createElement(b("MessengerDialogButton.react"),{label:g._("Leave Call"),onClick:function(){e(),c()},type:"primary",use:"default"}),b("React").createElement(b("MessengerDialogButton.react"),{label:g._("Stay"),onClick:function(){e(),d()},type:"primary",use:"default"})))};e.exports=a}),null);
__d("RTCGroupCallDialogController",["DOM","FBRTCGroupCallVideoEscalationDialog.react","React","ReactDOM","RTCGroupCallAddMembersDialog.react","RTCGroupCallAddUserWarningDialog.react","RTCGroupCallIncomingBlockedUserWarningDialog.react"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={_container:b("DOM").create("div"),_blockedContainer:b("DOM").create("div"),showAddGroupMembersDialog:function(a,c,d,e,f){b("ReactDOM").render(b("React").createElement(b("RTCGroupCallAddMembersDialog.react"),{isEscalatedCall:f,onUnmount:function(){return this._onUnmount()}.bind(this),participantStates:c,participants:a,thread:d,viewerID:e}),this._container)},showVideoEscalationDialog:function(a,c){b("ReactDOM").render(b("React").createElement(b("FBRTCGroupCallVideoEscalationDialog.react"),{onToggle:function(){this._onUnmount(),c()}.bind(this),userName:a}),this._container)},showBlockedUserWarningDialog:function(a,c){b("ReactDOM").render(b("React").createElement(b("RTCGroupCallAddUserWarningDialog.react"),{handleRing:a,onToggle:function(){this._onBlockedDialogUnmount()}.bind(this),unMountParent:c}),this._blockedContainer)},showIncomingBlockedUserWarningDialog:function(a,c,d,e){b("ReactDOM").render(b("React").createElement(b("RTCGroupCallIncomingBlockedUserWarningDialog.react"),{leaveCall:a,onAddStream:function(){c(d,e)},onToggle:function(){this._onUnmount()}.bind(this)}),this._container)},_onUnmount:function(){b("ReactDOM").unmountComponentAtNode(this._container)},_onBlockedDialogUnmount:function(){b("ReactDOM").unmountComponentAtNode(this._blockedContainer)}};e.exports=a}),null);
__d("RTCGroupCallActions",["RTCAppDispatcher","RTCCallActionTypes","RTCUtils"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={setLayout:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").SET_LAYOUT,layout:a})},setDominantSpeaker:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").SET_DOMINANT_SPEAKER,dominantSpeakerFBID:a})},setPinnedSpeaker:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").SET_PINNED_SPEAKER,pinnedSpeakerFBID:a})},initThread:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").INIT_THREAD,thread:a,participants:c})},onParticipantLeft:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_PARTICIPANT_LEFT,participantFBID:a})},onParticipantsAdded:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_PARTICIPANTS_ADDED,participants:a,images:c})},addParticipantsToRing:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ADD_PARTICIPANTS_TO_RING,participantFBIDs:a})},toggleRemoteStream:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").TOGGLE_REMOTE_STREAM,mediaStatus:a})},handleDismissRequest:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").DISMISS,transaction:a,request:c,endCallReason:b("RTCUtils").endCallReasonFromDismissRequest(c.dismissRequest())})},handleConferenceStateRequest:function(a,c,d,e){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_CONFERENCE_STATE,transaction:a,request:c,conferenceStateVersion:d,resolve:e})},onJoinRequestSent:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_JOIN_REQUEST_SENT})},onReceivedJoinResponse:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_RECEIVED_JOIN_RESPONSE})},onJoinResponse:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_JOIN_RESPONSE,serverInfoData:a})},onProcessedJoinResponse:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_PROCESSED_JOIN_RESPONSE})},onServerMediaUpdateSuccess:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_SERVER_MEDIA_UPDATE_SUCCESS})},onClientMediaUpdateResponse:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ON_CLIENT_MEDIA_UPDATE_RESPONSE,responseStatusCode:a,currentVersion:c})}};e.exports=a}),null);
__d("RTCMWSessionDescription",["Promise","FBRTCConsoleLogger","FBRTCConstants","FBRTCMediaType","RTCCallStore","RTCGroupCallActions","RTCGroupCallDialogController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBRTCConstants").SignalingProtocol;a={_videoEnabled:{},serverMediaUpdate:function(a,c){__p&&__p();var d=a.fromVersion,e=a.toVersion,f=a.mediaUpdates,h=b("RTCCallStore").getConnection(g.MULTIWAY);if(!h)return;var i=h.getLocalDescription(),j=h.getRemoteDescription(),k=j.sessionDescription.getVersion();if(k!==d){c(k);return}a=function(){__p&&__p();f.forEach(function(a){j.processServerMediaUpdate(a),a.media.forEach(function(c){var d=c.type;c=c.enabled;d===b("FBRTCMediaType").VIDEO&&(this._videoEnabled[a.sourceKey]=c)}.bind(this))}.bind(this)),j.sessionDescription.setVersion(e),b("Promise").all([h.setLocalDescription(i),h.setRemoteDescription(j)]).then(function(){var a;b("RTCGroupCallActions").toggleRemoteStream((a=[]).concat.apply(a,f.map(function(a){a=a.media;return a})).reduce(function(a,b){var c=b.id;b=b.enabled;a[c]=b;return a},{}));c(e)},function(){return c(k)})["catch"](function(a){})}.bind(this);d=f.find(function(a){var c=a.sourceKey;a=a.media;return!this._videoEnabled[c]&&a.some(function(a){var c=a.type;a=a.enabled;return c===b("FBRTCMediaType").VIDEO&&a})}.bind(this));if(!b("RTCCallStore").getState().localUser.hasVideo()&&d){d=d.sourceKey.split(":");var l=d[0];d=b("RTCCallStore").getState().remoteUsers.find(function(a){return a.FBID===l});b("RTCGroupCallDialogController").showVideoEscalationDialog(d.userName,a)}else a()}};e.exports=a}),null);
__d("MultiwayParticipantFetcher",["Promise","regeneratorRuntime","BonfireUserFetcher","ImmutableObject","MercuryIDs","MercuryParticipantsConstants","MessengerParticipants.bs","RTCUtils","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();b("immutable").Map;b("immutable").Set;function g(a,c){var d=a.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a)});return new(b("Promise"))(function(a,e){try{b("MessengerParticipants.bs").getBigImageMultiWithSize(d.toArray(),function(c){a(b("immutable").fromJS(c))},c)}catch(a){e(a)}})}function h(a){var c=a.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a)});return new(b("Promise"))(function(a,d){try{b("MessengerParticipants.bs").getMulti(c.toArray(),function(c){a(b("immutable").fromJS(c))})}catch(a){d(a)}})}function i(a,c){__p&&__p();var d,e;return b("regeneratorRuntime").async(function(f){__p&&__p();while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(h(a));case 2:d=f.sent;if(!c.profileImageSize){f.next=8;break}f.next=6;return b("regeneratorRuntime").awrap(g(a,c.profileImageSize));case 6:e=f.sent;return f.abrupt("return",d.withMutations(function(a){e.forEach(function(c,d){var e=a.get(d);if(e){e=b("ImmutableObject").setProperty(e,"big_image_src",c);a.set(d,e)}})}));case 8:return f.abrupt("return",d);case 9:case"end":return f.stop()}},null,this)}function j(a){__p&&__p();var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=b("immutable").Set([a]);d=b("MercuryIDs").getParticipantIDFromUserID(a);f.next=4;return b("regeneratorRuntime").awrap(i(c,{profileImageSize:b("MercuryParticipantsConstants").WWW_INCALL_THUMBNAIL_SIZE}));case 4:e=f.sent;return f.abrupt("return",e.get(d));case 6:case"end":return f.stop()}},null,this)}a={fetchParticipant:function(a,c){__p&&__p();return b("regeneratorRuntime").async(function(d){__p&&__p();while(1)switch(d.prev=d.next){case 0:if(!b("RTCUtils").isBonfireCall(a)){d.next=6;break}d.next=3;return b("regeneratorRuntime").awrap(b("BonfireUserFetcher").fetchParticipant(c));case 3:return d.abrupt("return",d.sent);case 6:d.next=8;return b("regeneratorRuntime").awrap(j(c));case 8:return d.abrupt("return",d.sent);case 9:case"end":return d.stop()}},null,this)},fetchAllParticipants:function(a,c,d){__p&&__p();return b("regeneratorRuntime").async(function(e){__p&&__p();while(1)switch(e.prev=e.next){case 0:d===void 0&&(d={});if(!b("RTCUtils").isBonfireCall(a)){e.next=7;break}e.next=4;return b("regeneratorRuntime").awrap(b("BonfireUserFetcher").fetchAllParticipants(c));case 4:return e.abrupt("return",e.sent);case 7:e.next=9;return b("regeneratorRuntime").awrap(i(c,d));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},null,this)}};e.exports=a}),null);
__d("RTCCallActions",["RTCAppDispatcher","RTCCallActionTypes","RTCGroupCallEscalationActionTypes","RTCUtils","emptyFunction","mixInEventEmitter"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={addListener:b("emptyFunction"),emit:b("emptyFunction"),initialize:function(a,c,d,e,f){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").INIT,conferenceName:c,callID:e,serverInfoData:d,protocol:a,callTrigger:f})},reset:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").RESET,conferenceName:a})},setCallSummary:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").SET_CALL_SUMMARY,callSummary:a})},call:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").CALL,usersToRing:a,peerConnection:c})},callSuccess:function(a){a===void 0&&(a=!1),b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").CALL_SUCCESS,connected:a})},incomingCallSuccess:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").INCOMING_CALL_SUCCESS})},callError:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").CALL_ERROR,endCallReason:b("RTCUtils").endCallReasonFromResponseStatusCode(a),endCallSubreason:"Call error: "+(a||0)})},completeTransitionToMultiway:function(){b("RTCAppDispatcher").dispatch({type:b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_CLEAR_P2P_CONNECTION})},hangupSuccess:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").HANGUP_SUCCESS})},hangupError:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").HANGUP_ERROR})},join:function(a){g.call([],a)},hangup:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").HANGUP,hangupReason:a,detailedReasonString:c,endCallReason:b("RTCUtils").endCallReasonFromHangupReason(a)})},initLocalUser:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").INIT_LOCAL_USER,localUser:a})},initRemoteUsers:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").INIT_REMOTE_USERS,remoteUsers:a})},updateRemoteUsers:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").UPDATE_REMOTE_USERS,remoteUsers:a})},addLocalStream:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ADD_LOCAL_STREAM,stream:a})},removeLocalStream:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOVE_LOCAL_STREAM,stream:a})},replaceLocalStream:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REPLACE_LOCAL_STREAM,oldStream:a,newStream:c})},removeAllLocalStreams:function(a){a===void 0&&(a=!1),b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOVE_ALL_LOCAL_STREAMS,stopStreams:a})},removeAllLocalScreenStreams:function(a){a===void 0&&(a=!1),b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOVE_ALL_LOCAL_SCREEN_STREAMS,stopStreams:a})},addRemoteStream:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ADD_REMOTE_STREAM,stream:a,userID:c})},removeRemoteStream:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOVE_REMOTE_STREAM,stream:a,userID:c})},removeAllRemoteStreams:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOVE_ALL_REMOTE_STREAMS,userID:a})},addRemoteTrack:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ADD_REMOTE_TRACK,stream:a,track:c})},removeRemoteTrack:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOVE_REMOTE_TRACK,stream:a,track:c})},addLocalScreenStream:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ADD_LOCAL_SCREEN_STREAM,stream:a})},removeLocalScreenStream:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOVE_LOCAL_SCREEN_STREAM,stream:a})},replaceLocalScreenStream:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REPLACE_LOCAL_SCREEN_STREAM,oldStream:a,newStream:c})},addRemoteScreenStream:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").ADD_REMOTE_SCREEN_STREAM,stream:a,userID:c})},removeRemoteScreenStream:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOVE_REMOTE_SCREEN_STREAM,stream:a,userID:c})},endCall:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").END_CALL,endCallReason:a,endCallSubreason:c})},waitForUserInput:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").WAIT_FOR_USER_INPUT})},toggleMuteAudio:function(a){b("RTCAppDispatcher").dispatch({type:a?b("RTCCallActionTypes").AUDIO_UNMUTED:b("RTCCallActionTypes").AUDIO_MUTED})},toggleMuteVideo:function(a){b("RTCAppDispatcher").dispatch({type:a?b("RTCCallActionTypes").VIDEO_UNMUTED:b("RTCCallActionTypes").VIDEO_MUTED})},toggleMuteRemoteVideo:function(a,c){b("RTCAppDispatcher").dispatch({type:a?b("RTCCallActionTypes").REMOTE_VIDEO_MUTED:b("RTCCallActionTypes").REMOTE_VIDEO_UNMUTED,userID:c})},toggleSelfView:function(a){b("RTCAppDispatcher").dispatch({type:a?b("RTCCallActionTypes").SELF_VIEW_COLLAPSED:b("RTCCallActionTypes").SELF_VIEW_UNCOLLAPSED})},submitRating:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").SUBMIT_RATING,rating:a})},submitFeedback:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").SUBMIT_FEEDBACK,feedback:a})},ratingShown:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").RATING_SHOWN})},feedbackShown:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").FEEDBACK_SHOWN})},setEndCallReason:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").SET_END_CALL_REASON,endCallReason:a})},setConferenceState:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").SET_CONFERENCE_STATE,conferenceState:a})},setFloorStatus:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").FLOOR_STATUS,status:a})}};b("mixInEventEmitter")(g,{onIceConnectionStateChange:!0});e.exports=g}),null);
__d("RTCMultiwayMessageHandler",["Arbiter","ChannelConstants","CurrentUser","FBRTCCapability","FBRTCDeviceStatus","FBRTCHangupReason","FBRTCMultiwayMessage","FBRTCRtcResponseStatusCode","FBRTCTransactions","MultiwayParticipantFetcher","RTCCallActions","RTCCallStore","RTCGroupCallActions","RTCMWProtocolHandler","RTCMWSessionDescription","RTCUtils","immutable","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBRTCTransactions").FBRTCServerTransaction,h=b("FBRTCTransactions").FBRTCTransactionOwner;function i(){this.$3=-1,this.$6()}i.prototype.initialize=function(a,b,c){this.$1=a,this.$2=b,this.$4=c};i.initHandler=function(a,b,c){c===void 0&&(c=!1),new i().initialize(a,b,c)};i.close=function(){i.$5&&(b("Arbiter").unsubscribe(i.$5),i.$5=null)};i.prototype.$6=function(){i.$5=b("Arbiter").subscribe([b("ChannelConstants").getArbiterType("rtc_live_json"),b("ChannelConstants").getArbiterType("rtc_multi_json")],function(a,b){this.$7(b.obj)}.bind(this))};i.prototype.$7=function(a){__p&&__p();var c=new(b("FBRTCMultiwayMessage"))(a);if(!c.isRequest())return;if(this.$1===c.conferenceName())this.$8(c);else if(c.ringRequest()&&!this.$4){var d=new g(new h(),c);b("promiseDone")(d.start(),function(a){var e=b("RTCUtils").generateRandomInt();b("promiseDone")(d.sendResponse(this.$9(a,e)),function(){return b("RTCMWProtocolHandler").otherUserInAnotherCall(c.conferenceName(),c.serverInfoData(),b("FBRTCHangupReason").IN_ANOTHER_CALL,"InAnotherCall")})}.bind(this))}};i.prototype.$9=function(a,c){var d=a.ringRequest(),e=a.serverInfoData();if(d==null||e==null)return a.createResponse(b("FBRTCRtcResponseStatusCode").BAD_REQUEST,{});d={deviceCapabilities:[b("FBRTCCapability").SUPPORT_AUDIO_DEPRECATED,b("FBRTCCapability").SUPPORT_VIDEO_DEPRECATED],deviceStatus:b("FBRTCDeviceStatus").OK};return a.createResponse(b("FBRTCRtcResponseStatusCode").OK,{body:{ringResponse:d},callID:c.toString()})};i.prototype.$8=function(a){__p&&__p();var c=new g(new h(),a);b("promiseDone")(c.start().then(function(a){__p&&__p();if(a!=null){var d=b("RTCCallStore").getState(),e=d.callInfo;if(a.dismissRequest()!=null)a.serverInfoData()===e.serverInfoData&&(b("RTCGroupCallActions").handleDismissRequest(c,a),i.close(),d.connections.forEach(function(a){return a.close()}),b("RTCCallActions").removeAllLocalStreams(!0));else if(a.serverMediaUpdateRequest()!=null)b("RTCMWSessionDescription").serverMediaUpdate(a.serverMediaUpdateRequest(),function(d){b("RTCGroupCallActions").onServerMediaUpdateSuccess(),c.sendResponse(a.createResponse(b("FBRTCRtcResponseStatusCode").OK,{body:{serverMediaUpdateResponse:{currentVersion:d}},callID:e.callID}))});else if(a.conferenceStateRequest()!=null){d=b("RTCCallStore").getState();d=d.remoteUsers;var f=d.map(function(a){return a.FBID});d=Object.keys(a.conferenceStateRequest().participantStates);d=d.filter(function(a){return a!==b("CurrentUser").getID()&&!f.has(a)});d.length>0?b("promiseDone")(b("MultiwayParticipantFetcher").fetchAllParticipants(this.$1,b("immutable").Set(d),{profileImageSize:100}),function(d){b("RTCGroupCallActions").onParticipantsAdded(d.toJS()),b("RTCGroupCallActions").handleConferenceStateRequest(c,a,this.$3,function(a){this.$3=a}.bind(this))}.bind(this)):b("RTCGroupCallActions").handleConferenceStateRequest(c,a,this.$3,function(a){this.$3=a}.bind(this))}}}.bind(this)))};e.exports=i}),null);
__d("RTCP2PConnectionStatus",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({CONNECTED:"CONNECTED",CONNECTING:"CONNECTING",CONTACTING:"CONTACTING",DISCONNECTED:"DISCONNECTED",INIT:"INIT",RECONNECTING:"RECONNECTING",RINGING:"RINGING"})}),null);
__d("RTCP2PCallWindowHandler",["RTCCallStore","RTCP2PCallStore","RTCP2PConnectionStatus"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;a={init:function(a){this._isWindowOpened()&&this.close(),g=a,this.updateCallInProgressIndicator(),this._monitorOpenerForChanges()},updateCallInProgressIndicator:function(a){if(!this._isWindowOpened())return;var c=b("RTCCallStore").getState();c=c.remoteUsers;a=a?a:b("RTCP2PCallStore").getState().connectionStatus;!c.count()||a===b("RTCP2PConnectionStatus").DISCONNECTED?g.rtcCallInProgessWith=null:g.rtcCallInProgessWith=c.first().FBID.toString()},reload:function(){this._isWindowOpened()&&g.location.reload()},close:function(){this._isWindowOpened()&&g.close()},_monitorOpenerForChanges:function(){if(g.opener)try{g.opener.addEventListener("unload",function(event){this._passWindowToOpener()}.bind(this))}catch(a){}},_passWindowToOpener:function(a){a===void 0&&(a=10),setTimeout(function(){if(!this._isWindowOpened()||a<=1)return;g.opener&&!g.opener.closed?g.opener.rtcCallChildWindow=g:this._passWindowToOpener(a-1)}.bind(this),1e3)},_isWindowOpened:function(){return!!(g&&!g.closed)}};e.exports=a}),null);
__d("XScreenSharingController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/screen_sharing/",{peer_id:{type:"FBID",required:!0},version:{type:"Int"}})}),null);
__d("RTCScreenSharingWindowHandler",["RTCP2PCallActions","RTCUtils","XScreenSharingController","promiseDone"],(function(a,b,c,d,e,f){__p&&__p();var g=540,h=960,i;a={open:function(a,c){i=window.open("about:blank","Screen Sharing",this._getWindowFeatures()),b("promiseDone")(b("RTCUtils").getStreamVideoResolution(c)["catch"](function(b){this._setupScreenSharingWindow(a,c,null)}.bind(this)),function(b){this._setupScreenSharingWindow(a,c,b)}.bind(this))},_setupScreenSharingWindow:function(a,b,c){__p&&__p();window.getRemoteMediaStream=function(){return b};window.closeScreenSharingWindow=this._onUnload;if(c){c=this._getConstrainedSize(c.width,c.height);var d=c.width,e=c.height;i.resizeTo(d,e);setTimeout(function(){this._adjustScreenSize({width:d,height:e})}.bind(this),200)}i.location=this._getUnsignedUri(a);window.focus&&this.isWindowOpened()&&i.focus()},_adjustScreenSize:function(a){if(!i)return;i.resizeTo(a.width,a.height+(a.height-i.innerHeight))},close:function(){if(i){var a=null;i.opener&&!i.opener.closed&&(a=i.opener);i.close();i=null;a&&a.postMessage({recipient:"SC_CONTENT_SCRIPT",type:"SC_RESET_PORT",text:"reset comm port"},"*")}},isWindowOpened:function(){return!!(i&&!i.closed)},_onUnload:function(){b("RTCP2PCallActions").togglePopOutScreenContent()},_getWindowFeatures:function(){var a=screen.availLeft,b=screen.availTop,c=this._getConstrainedSize(Math.min(h,screen.width-a),Math.min(g,screen.height-b)),d=c.width;c=c.height;c={height:"height="+c.toString(),width:"width="+d.toString(),top:"top="+b.toString(),left:"left="+a.toString()};return["menubar=no","location=no","scrollbars=no","status=no","personalbar=no",c.height,c.width,c.top,c.left].join(",")},_getConstrainedSize:function(a,b){var c;a>h&&(c=h/a,b*=c,a*=c);b>g&&(c=g/b,a*=c,b*=c);return{width:a,height:b}},_getUnsignedUri:function(a){return b("XScreenSharingController").getURIBuilder().setFBID("peer_id",a).setInt("version",2).getURI()}};e.exports=a}),null);
__d("RTCP2PCallActions",["RTCAppDispatcher","RTCP2PCallActionTypes","RTCP2PCallWindowHandler"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={reload:function(){b("RTCP2PCallWindowHandler").reload()},setCallType:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").SET_CALL_TYPE,callType:a})},setConnectionStatus:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").SET_CONNECTION_STATUS,connectionStatus:a})},setMultiwayEscalationSupport:function(a,c){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").SET_MULTIWAY_ESCALATION_SUPPORT,offerEscalationSupport:a,escalationConferenceName:c})},setRemoteSignalingExperiments:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").SET_REMOTE_SIGNALING_EXPERIMENTS,remoteSignalingExperiments:a})},togglePopOutScreenContent:function(a){b("RTCAppDispatcher").dispatch({type:a?b("RTCP2PCallActionTypes").POP_OUT_SCREEN_CONTENT:b("RTCP2PCallActionTypes").POP_IN_SCREEN_CONTENT,stream:a})},processMessage:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").P2P_PROCESS_MESSAGE,message:a})},setIsCaller:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").P2P_SET_IS_CALLER,isCaller:a})},starRatingDone:function(a){a===void 0&&(a=!0),b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").P2P_STAR_RATING_DONE,done:a})},setVideoQuality:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").SET_VIDEO_QUALITY,videoQuality:a})},toggleChatWindow:function(){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").TOGGLE_CHAT_WINDOW})}};e.exports=a}),null);
__d("FBRTCClientMediaUpdateReducer",["FBRTCConstants","FBRTCRtcResponseStatusCode","RTCCallActionTypes","RTCCallStore","RTCMWProtocolHandler"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={configureAudio:function(a,c){switch(c.type){case b("RTCCallActionTypes").AUDIO_MUTED:return g(a,"audio",!1);case b("RTCCallActionTypes").AUDIO_UNMUTED:return g(a,"audio",!0)}return a},configureVideo:function(a,c){switch(c.type){case b("RTCCallActionTypes").VIDEO_MUTED:return g(a,"video",!1);case b("RTCCallActionTypes").VIDEO_UNMUTED:return g(a,"video",!0)}return a},onClientMediaUpdateResponse:function(a,c){__p&&__p();switch(c.type){case b("RTCCallActionTypes").ON_CLIENT_MEDIA_UPDATE_RESPONSE:if(c.responseStatusCode!==b("FBRTCRtcResponseStatusCode").OK)return a;a=a.setIn(["clientMediaUpdateInfo","lastSyncedClientVersion"],c.currentVersion);if(a.clientMediaUpdateInfo.pendingResponse){a=a.setIn(["clientMediaUpdateInfo","pendingResponse"],!1);if(a.clientMediaUpdateInfo.pendingUpdate)return h(a.setIn(["clientMediaUpdateInfo","pendingUpdate"],!1))}return a}return a}};function g(a,c,d){var e=b("RTCCallStore").getConnection(b("FBRTCConstants").SignalingProtocol.MULTIWAY);if(!e)return a;e=e.getLocalStreams()[0].getTracks().reduce(function(a,b){a[b.id]=b.kind===c?d:b.enabled;return a},{});return h(a.setIn(["clientMediaUpdateInfo","localMediaUpdates"],a.clientMediaUpdateInfo.localMediaUpdates.push({mediaStatus:e})))}function h(a){if(a.clientMediaUpdateInfo.pendingResponse)return a.setIn(["clientMediaUpdateInfo","pendingUpdate"],!0);var c=a.clientMediaUpdateInfo.localMediaUpdates.reduce(function(b,c,d){d>=a.clientMediaUpdateInfo.lastSyncedClientVersion&&b.push(c);return b},[]);if(c.length===0)return a;b("RTCMWProtocolHandler").clientMediaUpdate(b("RTCCallStore").getState().callInfo.conferenceName,b("RTCCallStore").getState().callInfo.serverInfoData,a.clientMediaUpdateInfo.lastSyncedClientVersion,a.clientMediaUpdateInfo.localMediaUpdates.size,c);return a.setIn(["clientMediaUpdateInfo","pendingResponse"],!0)}e.exports=a}),null);
__d("FBRTCGroupCallParticipantsReducer",["MercuryIDs","RTCCallActionTypes","RTCCallStore","RTCMWProtocolHandler","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={_participantsToRing:new Set(),initThread:function(a,c){switch(c.type){case b("RTCCallActionTypes").INIT_THREAD:return a.merge({participants:c.participants,thread:c.thread})}return a},onParticipantsChanged:function(a,c){switch(c.type){case b("RTCCallActionTypes").ON_PARTICIPANT_LEFT:return a.set("participants",a.participants["delete"](b("MercuryIDs").getParticipantIDFromUserID(c.participantFBID)));case b("RTCCallActionTypes").ON_PARTICIPANTS_ADDED:var d=Object.keys(c.participants).map(function(a){return c.participants[a].fbid}).filter(function(a){return g._participantsToRing.has(a)});d.length!==0&&(d.forEach(function(a){return g._participantsToRing["delete"](a)}),b("RTCMWProtocolHandler").addParticipants(b("RTCCallStore").getState().callInfo.conferenceName,b("RTCCallStore").getState().callInfo.serverInfoData,d));return a.set("participants",a.participants.merge(b("immutable").Map(c.participants)))}return a},addParticipantsToRing:function(a,c){switch(c.type){case b("RTCCallActionTypes").ADD_PARTICIPANTS_TO_RING:c.participantFBIDs.forEach(function(a){return g._participantsToRing.add(a)});return a}return a}};e.exports=g}),null);
__d("FBRTCGroupCallReducer",["FBRTCConstants","FBRTCParticipantCallState","RTCCallActionTypes","RTCCallStore","RTCEndCallReason","RTCMWProtocolHandler"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBRTCConstants").SignalingProtocol;a={setDominantSpeaker:function(a,c){__p&&__p();switch(c.type){case b("RTCCallActionTypes").SET_DOMINANT_SPEAKER:return a.set("dominantSpeakerFBID",c.dominantSpeakerFBID);case b("RTCCallActionTypes").SET_PINNED_SPEAKER:var d=b("RTCCallStore").getState();d=d.callInfo;var e=b("RTCCallStore").getConnection(g.MULTIWAY);if(!e)return a;b("RTCMWProtocolHandler").subscription(d.conferenceName,d.serverInfoData,e.getRemoteStreams(),a.layout,c.pinnedSpeakerFBID);return a.set("pinnedSpeakerFBID",c.pinnedSpeakerFBID);case b("RTCCallActionTypes").ON_CONFERENCE_STATE:d=c.request.conferenceStateRequest();e=d.participantStates;c=e[a.pinnedSpeakerFBID];return c&&c.state!==b("FBRTCParticipantCallState").CONNECTED?a.set("pinnedSpeakerFBID",null):a}return a},setLayout:function(a,c){switch(c.type){case b("RTCCallActionTypes").SET_LAYOUT:var d=b("RTCCallStore").getState();d=d.callInfo;var e=b("RTCCallStore").getConnection(g.MULTIWAY);e&&b("RTCMWProtocolHandler").subscription(d.conferenceName,d.serverInfoData,e.getRemoteStreams(),c.layout,a.pinnedSpeakerFBID);return a.set("layout",c.layout)}return a},processEndCallReason:function(a,c){switch(c.type){case b("RTCCallActionTypes").CALL_ERROR:case b("RTCCallActionTypes").HANGUP:case b("RTCCallActionTypes").END_CALL:case b("RTCCallActionTypes").DISMISS:return a.set("endCallReason",a.endCallReason||new(b("RTCEndCallReason"))(c.endCallReason))}return a}};e.exports=a}),null);
__d("RTCGroupCallEscalationStoreReducer",["FBRTCParticipantCallState","FunnelLogger","immutable","RTCCallActionTypes","RTCCallStore","RTCGroupCallEscalationActionTypes","RTCGroupCallEscalationStore","RTCMWProtocolHandler","RTCP2PCallStore"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=new Set([b("FBRTCParticipantCallState").UNKNOWN,b("FBRTCParticipantCallState").DISCONNECTED,b("FBRTCParticipantCallState").NO_ANSWER,b("FBRTCParticipantCallState").REJECTED,b("FBRTCParticipantCallState").UNREACHABLE,b("FBRTCParticipantCallState").CONNECTION_DROPPED,b("FBRTCParticipantCallState").PARTICIPANT_LIMIT_REACHED,b("FBRTCParticipantCallState").IN_ANOTHER_CALL,b("FBRTCParticipantCallState").RING_TYPE_UNSUPPORTED]);function a(a,c){switch(c.type){case b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_CANCEL:b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","aborted_escalation");return a.withMutations(function(a){a.set("aborted",!0).set("inProgress",!1).set("toRing",!1).set("readyToTransition",!1).set("usersToRing",null)})}return a}function c(a,c){switch(c.type){case b("RTCCallActionTypes").HANGUP:case b("RTCCallActionTypes").END_CALL:case b("RTCCallActionTypes").HANGUP_ERROR:case b("RTCCallActionTypes").HANGUP_SUCCESS:a.inProgress&&!a.readyToTransition&&b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","call_ended_during_escalation");return a.withMutations(function(a){a.set("aborted",!1).set("inProgress",!1).set("toRing",!1).set("usersToRing",null)})}return a}function d(a,c){switch(c.type){case b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_SET_P2P_CALLSUMMARY:var d=c.p2pCallSummary;if(d)return a.withMutations(function(a){a.set("p2pCallSummary",d)})}return a}function f(a,c){switch(c.type){case b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_START:return a.set("inProgress",!0)}return a}function h(a,c){if(!a.readyToTransition&&a.inProgress)switch(c.type){case b("RTCCallActionTypes").ON_JOIN_REQUEST_SENT:b("RTCGroupCallEscalationStore").logToP2PCallSummary(function(a){return a.setEscalationConnectingToMultiway()});break;case b("RTCCallActionTypes").ON_JOIN_RESPONSE:b("RTCGroupCallEscalationStore").logToP2PCallSummary(function(a){a.setEscalationConnectedToMultiway(),c.serverInfoData&&a.setServerInfoData(c.serverInfoData)});break}return a}function i(a,c){__p&&__p();if(!a.readyToTransition&&a.inProgress)switch(c.type){case b("RTCCallActionTypes").ON_CONFERENCE_STATE:c=c.request.conferenceStateRequest();if(c){var d=c.participantStates;c=a.toRing;var e=!1,f=Object.keys(d).every(function(a){return d[a].state===b("FBRTCParticipantCallState").CONNECTED});if(f){b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","transition_to_group_call");b("RTCGroupCallEscalationStore").logToP2PCallSummary(function(a){a.setEscalationPeerConnectedToMultiway(),a.setEscalationConnectedToMultiway(),a.setReadyToEscalate()});var h=b("RTCP2PCallStore").getState();h=h.protocolHandler;h.shutDownP2PListenersForMultiwayEscalation();if(a.usersToRing&&c){h=a.usersToRing.valueSeq().map(function(a){return a.fbid}).filter(Boolean).toArray();b("RTCMWProtocolHandler").addParticipants(b("RTCCallStore").getState().callInfo.conferenceName,b("RTCCallStore").getState().callInfo.serverInfoData,h);c=!1}}else e=Object.keys(d).some(function(a){return g.has(d[a].state)}),e&&(b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","entered_bad_escalation_state_and_aborted"),b("RTCGroupCallEscalationStore").logToP2PCallSummary(function(a){return a.setInvalidP2PEscalationState()}));return a.set("aborted",e).set("readyToTransition",f).set("toRing",c)}}return a}function j(a,c){switch(c.type){case b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_SET_USERS_TO_RING:if(c.usersToRing)return a.set("usersToRing",c.usersToRing).set("toRing",!0)}return a}e.exports={abortEscalation:a,callStart:f,clearStore:c,onMultiwayConnectionSignaling:h,onParticipantsConnected:i,setP2PCallSummary:d,setUsersToRing:j}}),null);
__d("RTCCallType",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({AUDIO_ONLY:"AUDIO_ONLY",VIDEO_ONLY:"VIDEO_ONLY",AUDIO_VIDEO:"AUDIO_VIDEO",NO_AUDIO_VIDEO:"NO_AUDIO_VIDEO"});e.exports=a}),null);
__d("RTCP2PCallEscalationStoreReducers",["FBRTCVideoEscalationStore","RTCCallType","RTCP2PCallActionTypes","RTCP2PCallEscalationActionTypes","RTCP2PCallEscalator","RTCP2PCallStore"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBRTCVideoEscalationStore").CallType;a=function(a,c){__p&&__p();switch(c.type){case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_START:if(a.inProgress)return a;return a.escalated||!b("RTCP2PCallStore").isAudioOnly()?a:a.withMutations(function(a){a.set("awaitingACK",!0).set("initiatedEscalation",!0).set("failureReason",null).set("inProgress",!0).set("token",b("RTCP2PCallStore").getState().protocolHandler.generateEscalationRequestToken(!0))});case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS:if(!a.inProgress)return a;else if("token"in c&&c.token!==a.token)return a;b("RTCP2PCallEscalator").onEscalationSucceeded();return a.withMutations(function(a){a.set("awaitingACK",!1).set("callType",g.escalated).set("escalated",!0).set("inProgress",!1).set("request",null).set("response",!0).set("token",null)});case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE:if(!a.inProgress)return a;else if("token"in c&&c.token!==a.token)return a;b("RTCP2PCallEscalator").onEscalationFailed();if(c.reason==="denied")return a.withMutations(function(a){a.set("awaitingACK",!1).set("initiatedEscalation",!1).set("callType",g.escalation_declined).set("escalated",!1).set("failureReason",c.reason||null).set("inProgress",!1).set("request",null).set("response",c.response||null).set("token",null).set("escalateMediaStream",null)});b("RTCP2PCallStore").getState().protocolHandler.generateEscalationRequestToken(!1);return a.withMutations(function(a){a.set("awaitingACK",!1).set("inProgress",!1).set("initiatedEscalation",!1).set("callType",g.escalation_declined).set("escalated",!1).set("failureReason",c.reason).set("token",null).set("escalateMediaStream",null)});case b("RTCP2PCallEscalationActionTypes").SET_P2P_CALL_ESCALATION_MEDIA:return a.set("escalateMediaStream",c.stream);default:return a}};c=function(a,c){__p&&__p();switch(c.type){case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_REQUEST:var d=c.request;if(d==null)return a;return!b("RTCP2PCallEscalator").requestVideoOn(d.msg)?a.withMutations(function(a){a.set("awaitingACK",!1).set("inProgress",!1).set("request",null).set("response",null).set("token",null)}):a.withMutations(function(a){a.set("inProgress",!0).set("request",c.request).set("response",null).set("token",null)});case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE:if(c.response==null)return a;else if(a.request==null)return a;return a.withMutations(function(a){a.set("awaitingACK",!0).set("callType",c.response?g.escalated:g.escalation_declined).set("response",c.response).set("token",b("RTCP2PCallStore").getState().protocolHandler.generateEscalationResponseToken(a.request,c.response))});case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK:if(c.token==null)return a;return a.response==null||a.request==null||c.token!==a.token||!a.awaitingACK?a:a.withMutations(function(a){a.set("awaitingACK",!1).set("callType",a.response?g.escalated:g.escalation_declined).set("escalated",a.response).set("inProgress",!1).set("request",null).set("response",null).set("token",null)});default:return a}};d=function(a,c){__p&&__p();switch(c.type){case b("RTCP2PCallActionTypes").SET_CALL_TYPE:switch(c.callType){case b("RTCCallType").AUDIO_VIDEO:case b("RTCCallType").VIDEO_ONLY:return a.set("callType",g.direct_video)}return a;case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK:if(c.token==null)return a;if(!a.awaitingACK)return a;else if(c.token!==a.token)return a;return a.set("awaitingACK",!1);default:return a}};e.exports={Alice:a,Bob:c,common:d}}),null);
__d("RTCP2PCallReducer",["FBRTCConsoleLogger","RTCAppDispatcher","RTCCallActionTypes","RTCCallStore","RTCCallType","RTCP2PCallActionTypes","RTCP2PCallEscalationActionTypes","RTCP2PCallEscalationStore","RTCP2PCallWindowHandler","RTCP2PConnectionStatus","RTCP2PProtocolHandler","RTCScreenSharingWindowHandler","RTCSignalingExperiments"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c){__p&&__p();switch(c.type){case b("RTCCallActionTypes").RESET:b("RTCAppDispatcher").waitFor([b("RTCCallStore").getDispatchToken()]);var d=b("RTCCallStore").getState().remoteUsers.first();if(d==null)return a;a.protocolHandler.destroy();var e=new(b("RTCP2PProtocolHandler"))();e.init(d.FBID,Number(c.conferenceName));return a.set("connectionStatus",b("RTCP2PConnectionStatus").INIT).set("endCallReason",null).set("protocolHandler",e).set("signalingExperiments",new(b("RTCSignalingExperiments"))());default:return a}}function c(a,c){switch(c.type){case b("RTCCallActionTypes").HANGUP:case b("RTCCallActionTypes").DISMISS:case b("RTCCallActionTypes").HANGUP_ERROR:case b("RTCCallActionTypes").HANGUP_SUCCESS:case b("RTCCallActionTypes").END_CALL:case b("RTCCallActionTypes").REMOVE_REMOTE_SCREEN_STREAM:case b("RTCCallActionTypes").RESET:b("RTCScreenSharingWindowHandler").close();return a.set("isScreenContentPoppedOut",b("RTCScreenSharingWindowHandler").isWindowOpened());default:return a}}function d(a,c){switch(c.type){case b("RTCP2PCallActionTypes").SET_CALL_TYPE:return a.set("callType",c.callType);case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE:b("RTCAppDispatcher").waitFor([b("RTCP2PCallEscalationStore").getDispatchToken()]);return a.set("callType",c.response?b("RTCCallType").AUDIO_VIDEO:b("RTCCallType").AUDIO_ONLY);case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE:return a.set("callType",b("RTCCallType").AUDIO_ONLY);case b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS:b("RTCAppDispatcher").waitFor([b("RTCP2PCallEscalationStore").getDispatchToken()]);return b("RTCP2PCallEscalationStore").isEscalated()?a.set("callType",b("RTCCallType").AUDIO_VIDEO):a;default:return a}}function f(a,c){switch(c.type){case b("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:if(a.connectionStatus!==c.connectionStatus){b("RTCP2PCallWindowHandler").updateCallInProgressIndicator(c.connectionStatus);return a.set("connectionStatus",c.connectionStatus)}default:return a}}function g(a,c){switch(c.type){case b("RTCCallActionTypes").SET_END_CALL_REASON:return a.set("endCallReason",c.endCallReason);default:return a}}function h(a,c){switch(c.type){case b("RTCP2PCallActionTypes").SET_MULTIWAY_ESCALATION_SUPPORT:a=a.set("offerEscalationSupport",c.offerEscalationSupport);c.escalationConferenceName&&(a=a.set("escalationConferenceName",c.escalationConferenceName));return a;default:return a}}function i(a,c){switch(c.type){case b("RTCP2PCallActionTypes").POP_IN_SCREEN_CONTENT:b("RTCScreenSharingWindowHandler").close();return a.set("isScreenContentPoppedOut",b("RTCScreenSharingWindowHandler").isWindowOpened());case b("RTCP2PCallActionTypes").POP_OUT_SCREEN_CONTENT:var d=b("RTCCallStore").getState().remoteUsers.first().FBID;b("RTCScreenSharingWindowHandler").open(d,c.stream);return a.set("isScreenContentPoppedOut",b("RTCScreenSharingWindowHandler").isWindowOpened());default:return a}}function j(a,c){switch(c.type){case b("RTCP2PCallActionTypes").SET_REMOTE_SIGNALING_EXPERIMENTS:return a.set("signalingExperiments",a.signalingExperiments.setRemote(c.remoteSignalingExperiments));default:return a}}function k(a,c){switch(c.type){case b("RTCP2PCallActionTypes").P2P_PROCESS_MESSAGE:return a.set("isRemoteVideoSupported",c.message.isRemoteVideoSupported()).set("isPeerOnMobile",c.message.isFromMobile());default:return a}}function l(a,c){switch(c.type){case b("RTCP2PCallActionTypes").P2P_SET_IS_CALLER:return a.set("isCaller",c.isCaller);default:return a}}function m(a,c){switch(c.type){case b("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:return c.connectionStatus===b("RTCP2PConnectionStatus").CONNECTED?a.set("wasConnected",!0):a;case b("RTCCallActionTypes").RESET:return a.set("wasConnected",!1);default:return a}}function n(a,c){switch(c.type){case b("RTCP2PCallActionTypes").P2P_STAR_RATING_DONE:return a.set("wasStarRatingDone",c.done);case b("RTCCallActionTypes").RESET:return a.set("wasStarRatingDone",!1);default:return a}}function o(a,c){switch(c.type){case b("RTCP2PCallActionTypes").SET_VIDEO_QUALITY:return a.set("videoQuality",c.videoQuality);default:return a}}e.exports={callInit:a,callEnd:c,processCallType:d,processConnectionStatus:f,processEndCallReason:g,processIsCaller:l,processMessage:k,processMultiwayEscalationSupport:h,processPoppedOutScreenContent:i,processSignalingExperiments:j,processVideoQuality:o,processWasConnected:m,processWasStarRatingDone:n}}),null);
__d("RTCStreamDurationTracker",["performanceNow"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){a===void 0&&(a="mixed"),this.$3=0,this.$4=0,this.$5=!1,this.update=function(){if(!this.$5)return;this.$6()?this.$4===0&&(this.$4=b("performanceNow")()):this.pause(this.$2)}.bind(this),this.$1=a}a.prototype.isStarted=function(){return this.$5};a.prototype.track=function(a){__p&&__p();if(a===this.$2){this.update();return}if(this.$2&&this.$5){var b=this.$2;b.removeEventListener("addtrack",this.update);b.removeEventListener("removetrack",this.update)}a?(this.$5&&this.$6()&&(this.$3=this.getDuration()),this.$2=a,this.$5&&this.start()):this.stop()};a.prototype.$6=function(){return!this.$2?!1:this.$7().some(function(a){return a.enabled})};a.prototype.$7=function(){if(!this.$2)return[];switch(this.$1){case"audio":return this.$2.getAudioTracks();case"video":return this.$2.getVideoTracks();case"screen":return this.$2.getVideoTracks();default:return this.$2.getTracks()}};a.prototype.pause=function(a){if(!this.$5)return;if(this.$2!==a)return;this.$3=this.getDuration();this.$4=0};a.prototype.getDuration=function(){return this.$4===0?this.$3:this.$3+b("performanceNow")()-this.$4};a.prototype.start=function(){this.$5=!0;this.$6()&&(this.$4=b("performanceNow")());if(this.$2){var a=this.$2;a.addEventListener("addtrack",this.update);a.addEventListener("removetrack",this.update)}};a.prototype.stop=function(){__p&&__p();if(!this.$5)return;this.$3=this.getDuration();this.$5=!1;this.$4=0;if(this.$2){var a=this.$2;a.removeEventListener("addtrack",this.update);a.removeEventListener("removetrack",this.update)}};e.exports=a}),null);
__d("FBRTCGroupCallStoreState",["RTCStreamDurationTracker","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h;d={localVideoDurationTracker:new(b("RTCStreamDurationTracker"))("video"),remoteVideoDurationTracker:new(b("RTCStreamDurationTracker"))("video"),localScreenDurationTracker:new(b("RTCStreamDurationTracker"))("screen")};g=babelHelpers.inherits(a,b("immutable").Record(d));g&&g.prototype;function a(){g.apply(this,arguments)}f={dominantSpeakerFBID:null,endCallReason:null,layout:null,participants:null,pinnedSpeakerFBID:null,thread:null,videoDurationTrackerInfo:new a()};h=babelHelpers.inherits(c,b("immutable").Record(f));h&&h.prototype;function c(){h.apply(this,arguments)}e.exports=c}),null);
__d("FBRTCVideoDurationTrackerReducer",["FBRTCCallSummaryStore","RTCCallActionTypes","RTCCallStore"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={track:function(a,c){__p&&__p();var d=a.videoDurationTrackerInfo,e=d.localVideoDurationTracker,f=d.remoteVideoDurationTracker;d=d.localScreenDurationTracker;switch(c.type){case b("RTCCallActionTypes").ADD_LOCAL_SCREEN_STREAM:d.track(c.stream),d.isStarted()||d.start();case b("RTCCallActionTypes").ADD_LOCAL_STREAM:e.track(c.stream);e.isStarted()||e.start();return a;case b("RTCCallActionTypes").REMOVE_LOCAL_SCREEN_STREAM:d.pause(c.stream);return a;case b("RTCCallActionTypes").REPLACE_LOCAL_SCREEN_STREAM:d.track(c.newStream);e.track(c.newStream);return a;case b("RTCCallActionTypes").ADD_REMOTE_STREAM:case b("RTCCallActionTypes").TOGGLE_REMOTE_STREAM:d=b("RTCCallStore").getState();e=d.remoteUsers;c=e.find(function(a){return!a.isVideoMuted()});f.stop();f.start();f.track(c&&c.streams.first());return a}return a},update:function(a,c){switch(c.type){case b("RTCCallActionTypes").VIDEO_MUTED:case b("RTCCallActionTypes").VIDEO_UNMUTED:a.videoDurationTrackerInfo.localVideoDurationTracker.update()}return a},stop:function(a,c){__p&&__p();switch(c.type){case b("RTCCallActionTypes").DISMISS:case b("RTCCallActionTypes").END_CALL:case b("RTCCallActionTypes").HANGUP:c=a.videoDurationTrackerInfo;var d=b("RTCCallStore").getState();d=d.callSummary;c.localVideoDurationTracker.stop();c.remoteVideoDurationTracker.stop();c.localScreenDurationTracker.stop();d.setVideoDurations(c.localVideoDurationTracker.getDuration(),c.remoteVideoDurationTracker.getDuration());d.setScreenDuration(c.localScreenDurationTracker.getDuration());d.save(b("FBRTCCallSummaryStore").getInstance());return a}return a}};e.exports=a}),null);
__d("FBRTCGroupCallStore",["FBRTCGroupCallParticipantsReducer","FBRTCGroupCallReducer","FBRTCGroupCallStoreState","FBRTCVideoDurationTrackerReducer","FluxReduceStore","RTCAppDispatcher"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=[b("FBRTCGroupCallParticipantsReducer").addParticipantsToRing,b("FBRTCGroupCallParticipantsReducer").initThread,b("FBRTCGroupCallParticipantsReducer").onParticipantsChanged,b("FBRTCGroupCallReducer").processEndCallReason,b("FBRTCGroupCallReducer").setDominantSpeaker,b("FBRTCGroupCallReducer").setLayout,b("FBRTCVideoDurationTrackerReducer").track,b("FBRTCVideoDurationTrackerReducer").update,b("FBRTCVideoDurationTrackerReducer").stop];g=babelHelpers.inherits(a,b("FluxReduceStore"));g&&g.prototype;a.prototype.getInitialState=function(){return new(b("FBRTCGroupCallStoreState"))()};a.prototype.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)};function a(){g.apply(this,arguments)}a.__moduleID=e.id;e.exports=new a(b("RTCAppDispatcher"))}),null);
__d("FBRTCMWProtocolStoreState",["immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h;d={pendingResponse:!1,pendingUpdate:!1,lastSyncedClientVersion:2,localMediaUpdates:b("immutable").List([{mediaStatus:{}},{mediaStatus:{}}])};g=babelHelpers.inherits(a,b("immutable").Record(d));g&&g.prototype;function a(){g.apply(this,arguments)}f={clientMediaUpdateInfo:new a()};h=babelHelpers.inherits(c,b("immutable").Record(f));h&&h.prototype;function c(){h.apply(this,arguments)}e.exports=c}),null);
__d("FBRTCMWProtocolStore",["FBRTCClientMediaUpdateReducer","FBRTCMWProtocolStoreState","FluxReduceStore","RTCAppDispatcher"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=[b("FBRTCClientMediaUpdateReducer").configureAudio,b("FBRTCClientMediaUpdateReducer").configureVideo,b("FBRTCClientMediaUpdateReducer").onClientMediaUpdateResponse];g=babelHelpers.inherits(a,b("FluxReduceStore"));g&&g.prototype;a.prototype.getInitialState=function(){return new(b("FBRTCMWProtocolStoreState"))()};a.prototype.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)};function a(){g.apply(this,arguments)}a.__moduleID=e.id;e.exports=new a(b("RTCAppDispatcher"))}),null);
__d("RTCGroupCallEscalationStoreState",["FBRTCCallSummary","immutable"],(function(a,b,c,d,e,f){var g;g=babelHelpers.inherits(a,b("immutable").Record({aborted:!1,inProgress:!1,toRing:!1,p2pCallSummary:null,readyToTransition:!1,usersToRing:null}));g&&g.prototype;function a(){"use strict";g.apply(this,arguments)}e.exports=a}),null);
__d("RTCGroupCallEscalationStore",["FBRTCCallSummaryStore","FluxReduceStore","FunnelLogger","RTCAppDispatcher","RTCGroupCallEscalationStoreReducer","RTCGroupCallEscalationStoreState"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=[b("RTCGroupCallEscalationStoreReducer").abortEscalation,b("RTCGroupCallEscalationStoreReducer").callStart,b("RTCGroupCallEscalationStoreReducer").clearStore,b("RTCGroupCallEscalationStoreReducer").onMultiwayConnectionSignaling,b("RTCGroupCallEscalationStoreReducer").onParticipantsConnected,b("RTCGroupCallEscalationStoreReducer").setP2PCallSummary,b("RTCGroupCallEscalationStoreReducer").setUsersToRing];g=babelHelpers.inherits(a,b("FluxReduceStore"));g&&g.prototype;a.prototype.getInitialState=function(){return new(b("RTCGroupCallEscalationStoreState"))()};a.prototype.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)};a.prototype.isInProgress=function(){return this.getState().inProgress};a.prototype.isEscalated=function(){return this.getState().readyToTransition};a.prototype.logToP2PCallSummary=function(a){var c=this.getState();c=c.p2pCallSummary;c?(a(c),c.save(b("FBRTCCallSummaryStore").getInstance())):b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","p2pCallSummary_not_found")};function a(){g.apply(this,arguments)}a.__moduleID=e.id;e.exports=new a(b("RTCAppDispatcher"))}),null);
__d("RTCP2PCallEscalationStore",["FluxReduceStore","MessengerRTCFunnelLogger","RTCAppDispatcher","RTCP2PCallEscalationStoreReducers","RTCP2PCallEscalationStoreState","RTCP2PCallStore"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=[b("RTCP2PCallEscalationStoreReducers").Alice,b("RTCP2PCallEscalationStoreReducers").Bob,b("RTCP2PCallEscalationStoreReducers").common,b("MessengerRTCFunnelLogger").logRTCCallEscalationAction];g=babelHelpers.inherits(a,b("FluxReduceStore"));g&&g.prototype;a.prototype.getInitialState=function(){return new(b("RTCP2PCallEscalationStoreState"))()};a.prototype.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)};a.prototype.didCurrentUserInitiate=function(){return this.getState().initiatedEscalation};a.prototype.isInProgress=function(){return this.getState().inProgress};a.prototype.isEscalated=function(){return this.getState().escalated};a.prototype.getEscalateMediaStream=function(){return this.getState().escalateMediaStream};a.prototype.remoteWillNotInitSDPUpdate=function(){return b("RTCP2PCallStore").getState().isPeerOnMobile||b("RTCP2PCallStore").getState().signalingExperiments.remoteSupport("video_escalation_by_unmute")};a.prototype.isNegotiationAllowed=function(){var a=this.getState();return this.remoteWillNotInitSDPUpdate()||!a.request};a.prototype.isStarted=function(){var a=this.getState();return a.inProgress&&a.token!==null};a.prototype.getToken=function(){return this.getState().token};function a(){g.apply(this,arguments)}a.__moduleID=e.id;e.exports=new a(b("RTCAppDispatcher"))}),null);
__d("RTCP2PCallAdminMessageReducers",["FBRTCAdminMessage","FBRTCCallConstants","RTCAppDispatcher","RTCCallActionTypes","RTCCallStore","RTCCallType","RTCP2PCallActionTypes","RTCP2PConnectionStatus"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBRTCCallConstants").FBRTCCallType;function a(a,c){switch(c.type){case b("RTCCallActionTypes").SET_CALL_SUMMARY:b("RTCAppDispatcher").waitFor([b("RTCCallStore").getDispatchToken()]);c=b("RTCCallStore").getState();c=c.callSummary;return a.set("adminMessage",new(b("FBRTCAdminMessage"))(c.peerID,c.callID));default:return a}}function c(a,c){switch(c.type){case b("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:var d=a.adminMessage;d&&c.connectionStatus===b("RTCP2PConnectionStatus").CONNECTED&&d.onCallConnected();return a;default:return a}}function d(a,c){switch(c.type){case b("RTCCallActionTypes").SET_END_CALL_REASON:var d=a.adminMessage;d&&(d.onCallEnded(),a.isCaller&&d.submit(a.callType===b("RTCCallType").AUDIO_ONLY?g.VOICE_CALL:g.VIDEO_CALL,c.endCallReason.getReasonID()));return a;default:return a}}e.exports={processCallInit:a,processCallStart:c,processCallEnd:d}}),null);
__d("RTCP2PCallStore",["FluxReduceStore","RTCAppDispatcher","RTCCallType","RTCP2PCallAdminMessageReducers","RTCP2PCallReducer","RTCP2PCallStoreState"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=[b("RTCP2PCallReducer").callEnd,b("RTCP2PCallReducer").callInit,b("RTCP2PCallReducer").processCallType,b("RTCP2PCallReducer").processConnectionStatus,b("RTCP2PCallReducer").processEndCallReason,b("RTCP2PCallReducer").processPoppedOutScreenContent,b("RTCP2PCallReducer").processMultiwayEscalationSupport,b("RTCP2PCallReducer").processSignalingExperiments,b("RTCP2PCallReducer").processMessage,b("RTCP2PCallReducer").processIsCaller,b("RTCP2PCallReducer").processVideoQuality,b("RTCP2PCallReducer").processWasConnected,b("RTCP2PCallReducer").processWasStarRatingDone,b("RTCP2PCallAdminMessageReducers").processCallInit,b("RTCP2PCallAdminMessageReducers").processCallStart,b("RTCP2PCallAdminMessageReducers").processCallEnd];g=babelHelpers.inherits(a,b("FluxReduceStore"));g&&g.prototype;a.prototype.getInitialState=function(){return new(b("RTCP2PCallStoreState"))()};a.prototype.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)};a.prototype.isAudioOnly=function(){return this.getState().callType===b("RTCCallType").AUDIO_ONLY};a.prototype.isCaller=function(){return this.getState().isCaller};function a(){g.apply(this,arguments)}a.__moduleID=e.id;e.exports=new a(b("RTCAppDispatcher"))}),null);
__d("RTCP2PCallStoreState",["RTCCallType","RTCP2PConnectionStatus","RTCP2PProtocolHandler","RTCSignalingExperiments","immutable"],(function(a,b,c,d,e,f){"use strict";var g;c={adminMessage:null,callType:b("RTCCallType").AUDIO_ONLY,connectionStatus:b("RTCP2PConnectionStatus").INIT,endCallReason:null,escalationConferenceName:null,isCaller:!1,isPeerOnMobile:!1,isRemoteVideoSupported:!0,isScreenContentPoppedOut:!1,offerEscalationSupport:!1,protocolHandler:new(b("RTCP2PProtocolHandler"))(),signalingExperiments:new(b("RTCSignalingExperiments"))(),videoQuality:b("RTCP2PProtocolHandler").getDefaultVideoQuality(),wasConnected:!1,wasStarRatingDone:!1};g=babelHelpers.inherits(a,b("immutable").Record(c));g&&g.prototype;function a(){g.apply(this,arguments)}e.exports=a}),null);
__d("RTCGroupCallEscalationActions",["RTCAppDispatcher","RTCGroupCallEscalationActionTypes","immutable"],(function(a,b,c,d,e,f){"use strict";a={start:function(){b("RTCAppDispatcher").dispatch({type:b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_START})},cancel:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_CANCEL,p2pCallSummary:a})},approve:function(){b("RTCAppDispatcher").dispatch({type:b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_SUCCESS})},setUsersToRing:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_SET_USERS_TO_RING,usersToRing:a})},setP2PCallSummary:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_SET_P2P_CALLSUMMARY,p2pCallSummary:a})}};e.exports=a}),null);
__d("RTCGroupCallEscalator",["CurrentUser","FBRTCConsoleLogger","FBRTCConstants","FBRTCGroupCallStore","FBRTCMWProtocolStore","FBRTCScreenSharingUtils","FunnelLogger","MercuryIDs","MessengerParticipants.bs","RTCAppDispatcher","RTCCallStore","RTCGroupCallActions","RTCGroupCallEscalationActions","RTCGroupCallEscalationStore","RTCMWProtocolHandler","RTCUtils","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBRTCConstants").GroupVideoViewLayout,h=45e3;function a(a,c,d,e){this.$11=null,this.$4=a,this.$5=c,this.$9=d,this.$1=String(e),b("RTCGroupCallEscalationActions").setP2PCallSummary(b("RTCCallStore").getState().callSummary),this.$10=[d],this.$13=null,b("FunnelLogger").addFunnelTag("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL",c?"video":"audio")}a.prototype.getParticipants=function(){return this.$13};a.prototype.$14=function(){return setTimeout(function(){b("RTCGroupCallEscalationStore").getState().readyToTransition||(i("Group Escalation timed out"),b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","escalation_timed_out"),b("RTCGroupCallEscalationStore").logToP2PCallSummary(function(a){a.setEscalationTimedOut(),b("RTCGroupCallEscalationActions").cancel(a)}))},h)};a.prototype.startEscalationToMultiway=function(){__p&&__p();i("Escalating P2P call to Multiway call %o",this.$4);b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","starting_escalation_process");var a=b("RTCGroupCallEscalationStore").getState().inProgress;if(a)return;b("RTCGroupCallEscalationActions").start();this.$3=this.$14();this.$12=new(b("RTCMWProtocolHandler"))();b("RTCAppDispatcher").explicitlyRegisterStores([b("FBRTCGroupCallStore"),b("FBRTCMWProtocolStore")]);b("RTCGroupCallActions").setLayout(g.GRID);var c=b("MercuryIDs").getParticipantIDFromUserID(b("CurrentUser").getID());b("MessengerParticipants.bs").get(c,function(a){var d={};d[c]=a;a=b("immutable").Map(d);this.$13=a;b("RTCGroupCallActions").initThread(null,a);this.$15()}.bind(this))};a.prototype.$15=function(){var a=b("RTCCallStore").getState().localUser.getStream(),c=b("RTCCallStore").getState().localUser.getScreenStream(),d=a;c&&b("FBRTCScreenSharingUtils").isGroupCallScreenSharingSupported()&&(a&&b("RTCUtils").transferAudioTracks(c,a),d=c);d&&this.$12.onStreamReady(d,this.$10,this.$4,!0,{callTrigger:"multiway_escalation",p2pCallID:this.$1})};a.ESCALATION_TIMEOUT=h;function i(){}e.exports=a}),null);
__d("RTCP2PCallEscalationActions",["RTCAppDispatcher","RTCCallActionTypes","RTCP2PCallEscalationActionTypes"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={start:function(){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_START})},setRequest:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_REQUEST,request:a})},cancel:function(){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"cancelled"})},timeout:function(){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"timeout"})},handleACK:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK,token:a})},approve:function(){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS})},decline:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"denied",token:a,response:!1})},setResponse:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE,response:a})},parseResponse:function(a,c){a?b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS,token:c}):b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"denied",token:c,response:!1})},muteRemoteVideo:function(){b("RTCAppDispatcher").dispatch({type:b("RTCCallActionTypes").REMOTE_VIDEO_MUTED})},setEscalateToMediaStream:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallEscalationActionTypes").SET_P2P_CALL_ESCALATION_MEDIA,stream:a})}};e.exports=a}),null);
__d("RTCP2PCallEscalator",["Promise","FBRTCCallSummaryStore","FBRTCConsoleLogger","FBRTCConstants","FBRTCPeerConnection","RTCCallStore","RTCP2PCallEscalationActions","RTCP2PCallEscalationStore","RTCP2PCallStore","RTCP2PProtocolHandler","RTCUtils","RTWebClientFeatureGating","dangerouslyBypassDispatchError"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBRTCConstants").PayloadType,h=25e3;i.initVideoInAudioCall=function(){return b("RTWebClientFeatureGating").initVideoInAudioCall()};i.isEscalated=function(){return b("RTCP2PCallEscalationStore").isEscalated()};i.isNegotiationAllowed=function(){return b("RTCP2PCallEscalationStore").isNegotiationAllowed()};function i(a,b,c){this.$3=a,this.$1=b,this.$2=c,this.$6()}i.prototype.$6=function(){__p&&__p();var a=b("RTCP2PCallEscalationStore").getState();this.$4=b("RTCP2PCallEscalationStore").addListener(function(){__p&&__p();var c=b("RTCP2PCallEscalationStore").getState();if(c===a)return;!c.awaitingACK&&c.awaitingACK!==a.awaitingACK&&!c.inProgress&&clearTimeout(this.$5);if(c.callType!==a.callType){var d=b("RTCCallStore").getState();d=d.callSummary;d.setCallType(c.callType);d.save(b("FBRTCCallSummaryStore").getInstance())}a=c}.bind(this))};i.prototype.destroy=function(){j("P2P Escalator %o","destroy"),this.$4.remove(),clearTimeout(this.$5)};i.prototype.generateRequestToken=function(a){__p&&__p();var c=b("RTCP2PCallEscalationStore").getState();c=c.token;if(c!=null&&a){j("P2P Escalator %o","request token","reuse");return c}j("P2P Escalator %o","request token");c=this.$2.sendVideoEscalationRequest(this.$3,this.$1,a);clearTimeout(this.$5);this.$5=this.$7();return c.msg_id.toString()};i.prototype.generateResponseToken=function(a,c){__p&&__p();var d=b("RTCP2PCallEscalationStore").getState();d=d.token;if(d!=null){j("P2P Escalator %o","response token","reuse");return d}j("P2P Escalator %o %o %o","response token",c,a);d=a.peerID;var e=a.callID;a=a.msgID;d=this.$2.sendVideoRequestResponse(d,e,a,c);clearTimeout(this.$5);var f=d.msg_id.toString();!c?b("dangerouslyBypassDispatchError")(function(){return b("RTCP2PCallEscalationActions").decline(f)}):this.$5=this.$7();return f};i.prototype.$7=function(){return setTimeout(b("RTCP2PCallEscalationActions").timeout,h)};i.prototype.parseMessage=function(a){j("P2P Escalator %o","parse message",this.$3,a.msgType);switch(a.msgType){case g.VIDEO_REQUEST:a.ackID?this.$8(a):this.$9(a);break;case g.ACK:a.msg.ack_type===g.VIDEO_REQUEST&&b("RTCP2PCallEscalationActions").handleACK(a.ackID.toString());break}};i.prototype.$8=function(a){j("P2P Escalator %o","parse response",a);var c=a.ackID.toString();b("RTCP2PCallEscalationStore").getToken()===c&&this.$10(a);b("RTCP2PCallEscalationActions").parseResponse(i.requestVideoOn(a.msg),c);clearTimeout(this.$5)};i.prototype.$9=function(a){__p&&__p();j("P2P Escalator %o","parse request",a);if(b("RTCP2PCallEscalationStore").isInProgress()&&!i.requestVideoOn(a.msg)){b("RTCP2PCallEscalationStore").didCurrentUserInitiate()?b("RTCP2PCallEscalationActions").cancel():(this.$10(a),b("RTCP2PCallEscalationActions").setRequest(a));return}if(b("RTCP2PCallEscalationStore").isInProgress()&&b("RTCP2PCallEscalationStore").didCurrentUserInitiate()){j("P2P Escalator %o","auto-approve","mutual consent");b("RTCP2PCallEscalationActions").approve();this.$10(a);this.generateResponseToken(a,!0);return}if(b("RTCP2PCallEscalationStore").isEscalated()){i.requestVideoOn(a.msg)?(j("P2P Escalator %o","auto-approve"),this.$10(a),this.generateResponseToken(a,!0),clearTimeout(this.$5)):(j("P2P Escalator %o","mute remote video"),b("RTCP2PCallEscalationActions").muteRemoteVideo());return}j("P2P Escalator %o %o","request",a);this.$10(a);b("RTCP2PCallEscalationActions").setRequest(a)};i.prototype.$10=function(a){var b=a.peerID,c=a.callID;a=a.msg;j("P2P Escalator %o","ACK","sent");this.$2.sendAck(b,c,a)};i.requestVideoOn=function(a){var b=a.reqVideoOn;a=a.videoon;return Boolean(b||a)};i.initEscalation=function(){__p&&__p();var a=b("RTCP2PCallStore").getState(),c=a.protocolHandler;a=b("RTCCallStore").getState();a=a.localUser;var d=a.getStream();a=a.hasVideo();return(d&&a?b("Promise").resolve(d).then(function(a){c.updateLocalVideoTracker();return a}):b("RTCP2PProtocolHandler").initStream(!0).then(function(a){c.startLocalVideoTracker(a);return a})).then(function(a){b("RTCP2PCallEscalationActions").setEscalateToMediaStream(a);b("RTCP2PCallEscalationActions").start();return a})};i.onEscalationSucceeded=function(){__p&&__p();var a=b("RTCP2PCallEscalationStore").getEscalateMediaStream(),c=b("RTCCallStore").getState();c=c.localUser;if(c.getStream()===a){var d=b("RTCCallStore").getState();d=d.remoteUsers;c.toggleMuteVideo(!1);d.first()&&d.first().toggleMuteVideo(!1)}else a&&b("dangerouslyBypassDispatchError")(function(){i.updateEscalationStream(a)})};i.onEscalationFailed=function(){__p&&__p();var a=b("RTCP2PCallEscalationStore").getEscalateMediaStream(),c=b("RTCCallStore").getState();c=c.localUser;if(c.getStream()===a){var d=b("RTCCallStore").getState();d=d.remoteUsers;c.toggleMuteVideo(!0);d.first()&&d.first().toggleMuteVideo(!0)}else if(a){b("RTCUtils").stopMediaStream(a);c=b("RTCP2PCallStore").getState();d=c.protocolHandler;d.updateLocalVideoTracker()}};i.acceptEscalation=function(){__p&&__p();var a=b("RTCCallStore").getState(),c=a.localUser;a=a.remoteUsers;if(c.hasVideo()){c.toggleMuteVideo(!1);a.first()&&a.first().toggleMuteVideo(!1);a=b("RTCP2PCallStore").getState();a=a.protocolHandler;a.updateLocalVideoTracker();b("RTCP2PCallEscalationActions").setResponse(!0);return b("Promise").resolve(c.streams.first())}else return b("RTCP2PProtocolHandler").initStream(!0).then(function(a){b("RTCP2PCallEscalationActions").setResponse(!0);i.updateEscalationStream(a);return a})};i.declineEscalation=function(){b("RTCP2PCallEscalationActions").setResponse(!1)};i.updateEscalationStream=function(a){__p&&__p();var c=b("RTCCallStore").getState().localUser.getStream();if(b("FBRTCPeerConnection").isFirefoxSupportAddTrack()&&c){for(var d=a.getVideoTracks(),e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;c.addTrack(g)}g=b("RTCP2PCallStore").getState();f=g.protocolHandler;f.updateAddedTracksForFirefoxVideoEscalation(c)}else b("RTCP2PProtocolHandler").replaceLocalStream(a)};i.ACK_TIMEOUT=h;function j(){}e.exports=i}),null);
__d("FBRTCGroupCallVideoEscalationDialog.react",["fbt","MessengerDialog.react","MessengerDialogBody.react","MessengerDialogButton.react","MessengerDialogCancelButton.react","MessengerDialogFooter.react","React","RTCMWProtocolHandler"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var c=a.userName,d=a.onToggle;return b("React").createElement(b("MessengerDialog.react"),{onToggle:d},b("React").createElement(b("MessengerDialogBody.react"),null,g._("{name} added video chat. Would you like to share your video?",[g._param("name",c)])),b("React").createElement(b("MessengerDialogFooter.react"),null,b("React").createElement(b("MessengerDialogCancelButton.react"),null),b("React").createElement(b("MessengerDialogButton.react"),{label:g._("Share Video"),onClick:function(){b("RTCMWProtocolHandler").videoEscalation(),d()},type:"primary",use:"default"})))};e.exports=a}),null);
__d("RTCGroupCallAdminModelErrorDialogController",["cx","fbt","DOM","MessengerDialog.react","MessengerDialogBody.react","MessengerDialogButton.react","MessengerDialogFooter.react","React","ReactDOM"],(function(a,b,c,d,e,f,g,h){"use strict";var i=300;a={_container:b("DOM").create("div"),showAdminModelErrorDialog:function(){b("ReactDOM").render(b("React").createElement(b("MessengerDialog.react"),{onToggle:function(){return this._onUnmount()}.bind(this),type:"default",width:i},b("React").createElement(b("MessengerDialogBody.react"),{className:"_233q"},h._("Only the admin can add people to the call who are not in this group")),b("React").createElement(b("MessengerDialogFooter.react"),null,b("React").createElement(b("MessengerDialogButton.react"),{className:"_30vt _233r",label:h._("Ok"),onClick:function(){return this._onUnmount()}.bind(this),type:"primary",use:"default"}))),this._container)},_onUnmount:function(){b("ReactDOM").unmountComponentAtNode(this._container)}};e.exports=a}),null);
__d("RTCGroupCallAddMembersDialog.react",["cx","fbt","FluxContainer","FunnelLogger","MercuryIDs","MercuryLogMessageType","MercuryMessageActions","MercuryMessageObject","MercuryTriodeSourceUtil","MessengerAdminGroupUtils","MessengerApprovalModeTypes","MessengerDialog.react","MessengerDialogButton.react","MessengerDialogCancelButton.react","MessengerDialogHeader.react","MessengerDialogTitle.react","MessengerGraphQLTokenizer.react","MessengerParticipants.bs","MessengerRTCGroupCallContactList.react","MessengerRTCGroupCallThreadRow.react","React","RTCAppDispatcher","RTCCallStore","RTCConferenceState","RTCGroupCallActions","RTCGroupCallAdminModelErrorDialogController","RTCGroupCallDialogController","RTCGroupCallEscalationActions","RTCMWProtocolHandler","RTCP2PCallStore","RTWebLoggingCallType","RTWebLoggingComponent","RTWebLoggingSurface","RTWebUserActionLogger","VideoCallWebDriverIDs","immutable","gkx"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i;c=b("React").PureComponent;var j=460;d=babelHelpers.inherits(a,c);i=d&&d.prototype;a.getStores=function(){return[b("RTCCallStore")]};a.calculateState=function(){return{conferenceState:b("RTCCallStore").getState().callInfo.conferenceState,remoteUsers:b("RTCCallStore").getState().remoteUsers}};function a(a){__p&&__p();i.constructor.call(this,a),this.state={conferenceState:b("RTCConferenceState").NEW,isParticipantSelected:this.props.participants.mapEntries(function(a){var b=a[0];a[1];return[this.$1(b),!1]}.bind(this)),newParticipants:b("immutable").List(),remoteUsers:b("immutable").Set()},this.$2=function(a){var c=!this.state.isParticipantSelected.get(a);this.setState({isParticipantSelected:this.state.isParticipantSelected.set(a,c)});a=b("RTWebUserActionLogger").getWebLoggerInfoFromStore(b("RTCCallStore").getState());b("RTWebUserActionLogger").logClick(babelHelpers["extends"]({},a,{callType:this.props.isEscalatedCall?b("RTWebLoggingCallType").ESCALATED:b("RTWebLoggingCallType").MW,conferenceName:b("RTCCallStore").getState().callInfo.conferenceName,page:b("RTWebUserActionLogger").getPage(),surface:b("RTWebLoggingSurface").GROUP_CALL_ADD_MEMBERS_DIALOG,component:c?b("RTWebLoggingComponent").PARTICIPANT_ROW_SELECT:b("RTWebLoggingComponent").PARTICIPANT_ROW_UNSELECT}))}.bind(this),this.$11=function(){__p&&__p();var a=this.props,c=a.onUnmount,d=a.thread;a=a.viewerID;c();c=this.state.newParticipants.toArray().map(function(a){return a.getUniqueID()});var e=this.$3().map(function(a){a=a.fbid;return a||""});if(this.props.isEscalatedCall){b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","participant_picker_click_ring");var f=[].concat(c,e).map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a)});b("MessengerParticipants.bs").getMulti(f,function(a){b("RTCGroupCallEscalationActions").setUsersToRing(b("immutable").Map(a));a=b("RTCP2PCallStore").getState();a=a.protocolHandler;a.escalateToMultiway()});return}d&&(c.length>0&&d.approval_mode===b("MessengerApprovalModeTypes").APPROVALS&&d.admin_ids&&d.admin_ids.indexOf(a)===-1?b("RTCGroupCallAdminModelErrorDialogController").showAdminModelErrorDialog():(b("RTCGroupCallActions").addParticipantsToRing(c),this.$8(d)));b("RTCMWProtocolHandler").addParticipants(b("RTCCallStore").getState().callInfo.conferenceName,b("RTCCallStore").getState().callInfo.serverInfoData,[].concat(c,e))}.bind(this),this.$4=function(){var a=this.state.newParticipants.toArray().map(function(a){return a.getUniqueID()}),c=this.$3().map(function(a){a=a.fbid;return a||""});a=[].concat(a,c).map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a)});b("MessengerParticipants.bs").getMulti(a,function(a){a=this.$12(b("immutable").Map(a).valueSeq().toArray());b("gkx")("AT4uLl1AB6JLlOysf-A2hpwt4KJLHV_bjB3XyRsO-BgTRrIBrw0NJXG9gSXonEK94SJbVDuoLSgqS0Dkh4vrerSG")&&a?b("RTCGroupCallDialogController").showBlockedUserWarningDialog(this.$11,this.props.onUnmount):this.$11()}.bind(this))}.bind(this),this.$5=function(a){this.setState({newParticipants:this.state.newParticipants.push(a)})}.bind(this),this.$7=function(a){var b=a.getUniqueID();a=this.state.newParticipants;var c=a.findIndex(function(a){return a.getUniqueID()===b});c!==-1&&this.setState({newParticipants:a["delete"](c)})}.bind(this),this.$6=function(){this.setState({newParticipants:b("immutable").List()})}.bind(this),b("RTCAppDispatcher").explicitlyRegisterStores([b("RTCCallStore")]),b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","render_participant_picker")}a.prototype.render=function(){__p&&__p();var a=this.props,c=a.participants,d=a.thread;a=a.viewerID;var e=this.state.conferenceState;if(e===b("RTCConferenceState").TERMINATED||e===b("RTCConferenceState").TERMINATING)return null;e=b("React").createElement("div",{className:"_2t45"},b("React").createElement("div",{className:"_225b"},h._("Group Members")),b("React").createElement(b("MessengerRTCGroupCallContactList.react"),{isParticipantSelected:this.state.isParticipantSelected,onClick:this.$2,participantStates:b("immutable").Map(this.state.remoteUsers.map(function(a){return[a.FBID,a.participantState]})),remoteUsers:this.state.remoteUsers.toArray().sort(function(a,b){return a.userName.localeCompare(b.userName)})}));return b("React").createElement(b("MessengerDialog.react"),{onToggle:this.props.onUnmount,type:"default",width:j},b("React").createElement("div",{className:"_5zad"},b("React").createElement(b("MessengerDialogHeader.react"),null,b("React").createElement(b("MessengerDialogCancelButton.react"),{dataTestID:b("VideoCallWebDriverIDs").RTC_PICKER_DIALOG_CANCEL_BUTTON}),b("React").createElement(b("MessengerDialogTitle.react"),null,h._("Add Group Members")),b("React").createElement(b("MessengerDialogButton.react"),{dataTestID:b("VideoCallWebDriverIDs").RTC_PICKER_DIALOG_RING_BUTTON,disabled:this.$3().length+this.state.newParticipants.size===0,label:h._("Ring"),onClick:this.$4,type:"primary"})),this.props.isEscalatedCall?null:b("React").createElement(b("MessengerRTCGroupCallThreadRow.react"),{displayAddMemberWarning:!0,participants:c,thread:d,viewerID:a}),b("React").createElement(b("MessengerGraphQLTokenizer.react"),{autoFocus:!!this.props.isEscalatedCall,className:"_2el3",context:null,defaultEntries:e,enableMessageSearch:!1,entries:this.state.newParticipants,excludeGroups:!0,excludePages:!0,forGroup:!0,forceHideClearButton:!0,hasHoverState:!1,hideViewWithEntries:!1,onAddEntryAttempt:this.$5,onClear:this.$6,onRemoveEntryAttempt:this.$7,originalEntryIDs:b("immutable").Set(this.props.participants.keySeq().toArray().map(function(a){return b("MercuryIDs").getUserIDFromParticipantID(a)||a})),placeholder:h._("Add to group:"),scrollableViewClassName:"_2el2",shouldQueryInternalBot:!1,shouldQueryVCEndpoint:!1,showDefaultEntries:!0,useLayer:!1,viewer:this.props.viewerID,width:j})))};a.prototype.$8=function(a){if(this.state.newParticipants.size)if(b("MessengerAdminGroupUtils").isJoinableThread(a))this.state.newParticipants.forEach(function(c){c=b("MercuryIDs").getThreadIDFromUserID(c.getUniqueID());this.$9().send(this.$10().constructUserGeneratedMessageObject(a.joinable_mode.link,b("MercuryTriodeSourceUtil").getMercuryTriodeSource(),c))}.bind(this));else{var c="thread:"+(a.thread_fbid||a.thread_id.split(".")[1]);this.$9().send(this.$10().constructLogMessageObject(b("MercuryTriodeSourceUtil").getMercuryTriodeSource(),c,b("MercuryLogMessageType").SUBSCRIBE,{added_participants:this.state.newParticipants.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.getUniqueID())}).toArray()}))}};a.prototype.$9=function(){return b("MercuryMessageActions").getForFBID(this.props.viewerID)};a.prototype.$10=function(){return b("MercuryMessageObject").getForFBID(this.props.viewerID)};a.prototype.$12=function(a){return a.some(function(a){return a.is_messenger_blocked||a.is_facebook_blocked})};a.prototype.$3=function(){return this.props.participants.filter(function(a,b){return this.state.isParticipantSelected.get(this.$1(b))}.bind(this)).toArray()};a.prototype.$1=function(a){return b("MercuryIDs").getUserIDFromParticipantID(a)||""};e.exports=b("FluxContainer").create(a)}),null);
__d("XGroupCallSendRequestController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groupcall/sendrequest/",{webrtc_fbtrace:{type:"Int"}})}),null);
__d("MultiwayRequests",["Promise","AsyncRequest","FBRTCCapability","FBRTCMessageType","RTCUtils","XGroupCallSendRequestController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=15e3;a.prototype.sendJoinRequest=function(a,c,d,e,f,g,h,i){__p&&__p();var j=h.callID,k=h.numParticipants;h=h.callTrigger;var l=i.userToEscalate,m=i.isEscalator;i=i.escP2PCallID;c=b("RTCUtils").createRequestHeader(b("FBRTCMessageType").JOIN,c,d,j,i);d={offer:{sdpString:e.toSdp()},deviceCapabilities:[b("FBRTCCapability").SUPPORT_AUDIO_DEPRECATED,b("FBRTCCapability").SUPPORT_VIDEO_DEPRECATED]};j=b("RTCUtils").createClientContextMessage(k,h?h:"");d.appMessages=[j];f&&f.length>0&&!l&&(d.usersToCall=f);l&&m&&(d.userToEscalate=l);g&&(d.mediaStatus=g);i={endpoint:a,jsonPayload:{header:c,body:{joinRequest:d}}};return this.$1(i)};a.prototype.sendHangupRequest=function(a,c,d,e,f,g){c=b("RTCUtils").createRequestHeader(b("FBRTCMessageType").HANGUP,c,d,g);d={reason:e,detailedReasonString:f};g={endpoint:a,jsonPayload:{header:c,body:{hangupRequest:d}}};return this.$1(g)};a.prototype.sendAddParticipantsRequest=function(a,c,d,e,f){c=b("RTCUtils").createRequestHeader(b("FBRTCMessageType").ADD_PARTICIPANTS,c,d,f);d={usersToInvite:e};f={endpoint:a,jsonPayload:{header:c,body:{addParticipantsRequest:d}}};return this.$1(f)};a.prototype.sendSubscriptionRequest=function(a,c,d,e,f){return this.$1({endpoint:a,jsonPayload:{header:b("RTCUtils").createRequestHeader(b("FBRTCMessageType").SUBSCRIPTION,c,d,f),body:{subscriptionRequest:{subscriptions:e}}}})};a.prototype.sendClientMediaUpdateRequest=function(a,c,d,e,f,g,h){return this.$1({endpoint:a,jsonPayload:{header:b("RTCUtils").createRequestHeader(b("FBRTCMessageType").CLIENT_MEDIA_UPDATE,c,d,h),body:{clientMediaUpdateRequest:{fromVersion:e,toVersion:f,mediaUpdates:g}}}})};a.prototype.$1=function(a){return new(b("Promise"))(function(c,d){var e=b("XGroupCallSendRequestController").getURIBuilder().getURI();e=new(b("AsyncRequest"))(e).setMethod("POST").setData({request:JSON.stringify(a)}).setAllowCrossPageTransition(!0).setHandler(function(a){c(a.payload)}).setErrorHandler(function(a){a=a.getErrorDescription();a=Error(a!=null?a.toString():"AsyncRequest error");d(a)}).setTimeoutHandler(g,function(){d("Timeout")});e.send()})};function a(){}e.exports=new a()}),null);
__d("RTCMWProtocolHandler",["invariant","Promise","regeneratorRuntime","ChannelManager","CurrentUser","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCExperiment","FBRTCGroupCallStore","FBRTCHangupReason","FBRTCLogger","FBRTCPeerConnection","FBRTCRtcResponseStatusCode","FBRTCSdpUtils","FBRTCVideoQuality","FunnelLogger","MercuryIDs","MultiwayParticipantFetcher","MultiwayRequests","RTCAppData","RTCCallActions","RTCCallStore","RTCGroupCallActions","RTCGroupCallDialogController","RTCGroupCallEscalationStore","RTCMultiwayMessageHandler","RTCSessionDescription","RTCUserMediaConstraints","RTCUtils","emptyFunction","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("FBRTCConstants").CallEndReason,i=b("FBRTCConstants").GroupVideoViewLayout,j=b("FBRTCConstants").SignalingProtocol,k=b("FBRTCConstants").VideoQuality,l=18e4,m={appId:b("RTCAppData").getMWAppID(),deviceId:b("ChannelManager").getCompleteConfig().sessionID,userId:b("CurrentUser").getID()};function n(a){__p&&__p();this.$5=!1,this.$6=!1,this.$7=!1,this.$8=b("FBRTCLogger").getInstance(),this.$11=function(a){__p&&__p();a=a.target;a=a.iceConnectionState;b("RTCCallActions").emit("onIceConnectionStateChange",a);switch(a){case"connected":a=b("RTCCallStore").getState();a=a.callSummary;a&&(a.onNetworkReady(),a.save(b("FBRTCCallSummaryStore").getInstance()));break;case"disconnected":case"failed":this.$3||(this.$3=setTimeout(function(){b("RTCCallActions").endCall(h.CONNECTION_DROPPED,"ConnectionDropped"),this.$15()}.bind(this),l));break;default:clearTimeout(this.$3),this.$3=null}}.bind(this),this.$1=a?a:b("RTCUtils").generateRandomInt(),this.$2="MW_PEER_ID"}n.prototype.setKeepLocalStreamsOnClose=function(a){this.$6=a;return this};n.prototype.setAllowIncomingCalls=function(a){this.$7=a;return this};n.prototype.startCall=function(a,c,d,e){__p&&__p();var f=e.addStreamCallback;f=f===void 0?b("emptyFunction"):f;var g=e.callTrigger,h=e.formatParameters;h=h===void 0?{}:h;var i=e.preferredCodecs;i=i===void 0?{}:i;var k=e.serverInfoData,l=e.shouldSetDescriptions;l=l===void 0?!0:l;var m=e.isEscalatedCall;m=m===void 0?!1:m;var n=e.connectedOnJoin;n=n===void 0?!1:n;e=e.escP2PCallID;e=e===void 0?"":e;b("RTCCallActions").initialize(j.MULTIWAY,d,k,this.$1.toString(),g);var o=b("FBRTCCallSummary").restoreOrInitialize(b("FBRTCCallSummaryStore").getInstance(),this.$2,this.$1,!1);g&&o.onCallStarted(g);o.setJoinWithSID(k!=null);o.setActiveConnection("mws");o.setCallType("mws");o.onPopupOpened();o.setConferenceName(d);o.setServerInfoData(k);if(m){var p=b("RTCCallStore").getState().callSummary;o.setEscalationP2PCallID(p.callID)}o.save(b("FBRTCCallSummaryStore").getInstance());b("RTCCallActions").setCallSummary(o);p={mandatory:{},optional:[{DtlsSrtpKeyAgreement:!1},{googNumUnsignalledRecvStreams:10},{googHighBitrate:!0},{googVeryHighBitrate:!0},{RtpDataChannels:!0}]};p=new(b("FBRTCPeerConnection"))(j.MULTIWAY,{iceServers:[]},p);var q=p.createDataChannel("data");q&&(q.onmessage=function(a){a=a.data;try{a=JSON.parse(a);a=a.body;this.$9(a)}catch(a){this.$8.logError(this.$2,this.$1,a)}}.bind(this));p.addEventListener("addstream",function(event){this.$10(d,event.stream)}.bind(this));p.addEventListener("removestream",function(event){b("RTCCallActions").removeRemoteStream(event.stream)});p.addEventListener("iceconnectionstatechange",this.$11);this.$12(p,c,d,k,a,f,h,i,l,m,n,e,g?g:o.getCallTrigger());!k?b("RTCCallActions").call(a,p):b("RTCCallActions").join(p);return p};n.prototype.$10=function(a,c){__p&&__p();c.onaddtrack=function(a){var c=a.target;a=a.track;b("RTCCallActions").addRemoteTrack(c,a)};c.onremovetrack=function(a){var c=a.target;a=a.track;b("RTCCallActions").removeRemoteTrack(c,a)};var d=c.id.split(":")[0];d!==b("CurrentUser").getID()&&b("promiseDone")(b("MultiwayParticipantFetcher").fetchParticipant(a,d),function(a){var d=a&&(a.is_messenger_blocked||a.is_facebook_blocked);b("gkx")("AT4uLl1AB6JLlOysf-A2hpwt4KJLHV_bjB3XyRsO-BgTRrIBrw0NJXG9gSXonEK94SJbVDuoLSgqS0Dkh4vrerSG")&&d?b("RTCGroupCallDialogController").showIncomingBlockedUserWarningDialog(function(){return n.endCall(b("RTCCallStore").getState().callInfo.conferenceName,b("RTCCallStore").getState().callInfo.serverInfoData,b("FBRTCHangupReason").HANGUP_CALL)},function(b,a){return this.$13(b,a)}.bind(this),a,c):this.$13(a,c)}.bind(this))};n.prototype.$13=function(a,c){__p&&__p();var d=c.id.split(":")[0],e={};d=b("MercuryIDs").getParticipantIDFromUserID(d);e[d]=a;b("RTCGroupCallActions").onParticipantsAdded(e);b("RTCCallActions").addRemoteStream(c);d=b("RTCCallStore").getState();a=d.callInfo;e=b("FBRTCGroupCallStore").getState();c=e.layout;d=e.pinnedSpeakerFBID;e=b("RTCCallStore").getConnection(j.MULTIWAY);e&&n.subscription(a.conferenceName,a.serverInfoData,e.getRemoteStreams(),c,d)};n.prototype.$9=function(a){if(a.dominantSpeakerNotification){a=a.dominantSpeakerNotification.userId;b("RTCGroupCallActions").setDominantSpeaker(a)}};n.prototype.setDescriptions=function(){this.$5=!0;var a=b("RTCCallStore").getConnection(j.MULTIWAY);this.$4&&a&&a.setRemoteDescription(this.$4)};n.videoEscalation=function(){__p&&__p();return n.initStream(!0).then(function(a){__p&&__p();var c=b("RTCCallStore").getState(),d=c.callInfo,e=d.conferenceName;d=d.serverInfoData;var f=c.localUser;c=b("RTCCallStore").getConnection(j.MULTIWAY);if(!c)return;a.getTracks().forEach(function(a){a.kind==="audio"&&(a.enabled=!f.isAudioMuted())});var g=f.streams.first();c.removeStream(g);return o(c,[a],e,d,[]).then(function(){b("RTCCallActions").removeLocalStream(g),b("RTCCallActions").addLocalStream(a)})})};n.prototype.onStreamReady=function(a,c,d,e,f){var g={};e||b("RTCCallActions").addLocalStream(a);g.isEscalatedCall=e;f.p2pCallID&&(g.escP2PCallID=f.p2pCallID);f.serverInfoData&&(g.serverInfoData=f.serverInfoData);f.callTrigger&&(g.callTrigger=f.callTrigger);this.startCall(c,[a],d,g)};n.initStream=function(a,c,d,e,f){d===void 0&&(d=!0);var g=b("FBRTCExperiment").gen("rtc_www_mw_audio_fallback");g=g.getBool("use_audio_fallback",!1);d={audio:d&&b("RTCUserMediaConstraints").audio(e),video:a?babelHelpers["extends"]({},p(b("RTCUserMediaConstraints").video(c?c:k.HD_VIDEO,f))):!1};e={optionalConstraintsOnly:!0,supportFilteredStreams:!0};a=g?b("RTCUtils").getUserMediaWithAudioFallback:b("RTCUtils").getUserMedia;return a(d,e)};n.startScreenStream=function(a){__p&&__p();var c=b("RTCCallStore").getState(),d=c.callInfo,e=d.conferenceName;d=d.serverInfoData;var f=c.localUser;c=b("RTCCallStore").getConnection(j.MULTIWAY);if(!c)return;for(var g=f.screenStreams,h=Array.isArray(g),i=0,g=h?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(h){if(i>=g.length)break;k=g[i++]}else{i=g.next();if(i.done)break;k=i.value}k=k;k!==a&&b("RTCUtils").transferAudioTracks(a,k)}for(var k=f.streams,i=Array.isArray(k),h=0,k=i?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(i){if(h>=k.length)break;g=k[h++]}else{h=k.next();if(h.done)break;g=h.value}g=g;b("RTCUtils").transferAudioTracks(a,g)}b("promiseDone")(o(c,[a],e,d,[]),function(){__p&&__p();for(var c=f.screenStreams,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;g!==a&&(b("RTCCallActions").removeLocalScreenStream(g),b("RTCUtils").stopMediaStream(g))}b("RTCCallActions").addLocalScreenStream(a)})};n.updateScreenStream=function(a,b){n.startScreenStream(b)};n.stopScreenStream=function(a){__p&&__p();var c=b("RTCCallStore").getState(),d=c.callInfo,e=d.conferenceName,f=d.serverInfoData;d=c.localUser;var g=b("RTCCallStore").getConnection(j.MULTIWAY);if(!g)return;c=d.getStream();c?d=b("Promise").resolve(c):d=n.initStream(!0,undefined,!1).then(function(a){b("RTCCallActions").addLocalStream(a);return a});b("promiseDone")(d,function(c){b("RTCUtils").transferAudioTracks(c,a),b("promiseDone")(o(g,[c],e,f,[]),function(){b("RTCUtils").stopMediaStream(a),b("RTCCallActions").removeLocalScreenStream(a)})})};n.endCall=function(a,c,d,e){e===void 0&&(e=""),b("promiseDone")(n.genEndCall(a,d,{serverInfoData:c,detailedReasonString:e,keepLocalStream:!1}))};n.genEndCall=function(a,c,d){b("RTCMultiwayMessageHandler").close();d.keepLocalStream||b("RTCCallActions").removeAllLocalStreams(!0);var e=d.detailedReasonString||"Hangup by user";b("RTCCallActions").hangup(c,e);return b("MultiwayRequests").sendHangupRequest(m,a,d.serverInfoData,c,e,b("RTCCallStore").getState().callInfo.callID).then(function(){b("RTCCallActions").hangupSuccess()})["catch"](function(a){b("RTCCallActions").hangupError();throw a})};n.otherUserInAnotherCall=function(a,c,d,e){e===void 0&&(e=""),b("promiseDone")(b("MultiwayRequests").sendHangupRequest(m,a,c,d,e||"User receiving this call is in another call",b("RTCCallStore").getState().callInfo.callID))};n.prototype.iceRestart=function(a,c){var d=b("RTCCallStore").getConnection(j.MULTIWAY);d&&o(d,[],a,c,[],{iceRestart:!0})};n.addParticipants=function(a,c,d){b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","send_ring_to_added_participants");return b("MultiwayRequests").sendAddParticipantsRequest(m,a,c,d,b("RTCCallStore").getState().callInfo.callID)};n.subscription=function(a,c,d,e,f){var g=e===i.DOMINANT_SPEAKER?b("FBRTCVideoQuality").LOW:e===i.GRID?b("FBRTCVideoQuality").MEDIUM:b("FBRTCVideoQuality").HIGH;d=d.map(function(a){a=a.id;return{cname:a,options:{videoQuality:e===i.DOMINANT_SPEAKER&&f===a.split(":")[0]?b("FBRTCVideoQuality").HIGH:g}}});e===i.DOMINANT_SPEAKER&&!f&&d.push({cname:""});b("MultiwayRequests").sendSubscriptionRequest(m,a,c,d,b("RTCCallStore").getState().callInfo.callID)};n.clientMediaUpdate=function(a,c,d,e,f){b("MultiwayRequests").sendClientMediaUpdateRequest(m,a,c,d,e,f,b("RTCCallStore").getState().callInfo.callID).then(function(a){var c=a.header.responseStatusCode;a=a.body.clientMediaUpdateResponse.currentVersion;return b("RTCGroupCallActions").onClientMediaUpdateResponse(c,a)})["catch"](function(a){b("FBRTCLogger").getInstance().logError(null,b("RTCCallStore").getState().callInfo.callID,a)})};n.prototype.$12=function(a,c,d,e,f,g,h,i,j,k,l,m,n){this.$14(d,e),b("promiseDone")(o(a,c,d,e,f,{},g,h,i,j,k,m,n),function(a){this.$4=a,this.$5&&this.setDescriptions(),b("RTCCallActions").callSuccess(l)}.bind(this),function(a){b("RTCCallActions").callError(a),this.$15()}.bind(this))};n.prototype.$15=function(){var a=b("RTCCallStore").getConnection(j.MULTIWAY);b("RTCMultiwayMessageHandler").close();a&&a.close();this.$6||b("RTCCallActions").removeAllLocalStreams(!0)};n.prototype.$14=function(a,c){b("RTCMultiwayMessageHandler").initHandler(a,c,this.$7)};function o(a,c,d,e,f,g,h,i,k,l,n,o,p){__p&&__p();var q,r,s,t,u,v,w,x,y,z,A;return b("regeneratorRuntime").async(function(B){__p&&__p();while(1)switch(B.prev=B.next){case 0:g===void 0&&(g={}),h===void 0&&(h=b("emptyFunction")),i===void 0&&(i={}),k===void 0&&(k={}),l===void 0&&(l=!0),n===void 0&&(n=!1),o===void 0&&(o=""),p===void 0&&(p=""),q={},r=[],(s=a.getLocalStreams()||[],t=Array.isArray(s),u=0,s=t?s:s[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 11:if(!t){B.next=17;break}if(!(u>=s.length)){B.next=14;break}return B.abrupt("break",25);case 14:v=s[u++];B.next=21;break;case 17:u=s.next();if(!u.done){B.next=20;break}return B.abrupt("break",25);case 20:v=u.value;case 21:w=v,a.removeStream(w);case 23:B.next=11;break;case 25:c.forEach(function(b){r=r.concat(b.getTracks()),a.addStream(b,h)});r.forEach(function(a){q[a.id]=a.enabled});B.next=29;return b("regeneratorRuntime").awrap(a.createOffer(babelHelpers["extends"]({preserveH264:b("RTCUtils").isBonfireCall(d)},g),{FORMAT_PARAMETERS:i},k));case 29:x=B.sent;if(b("FBRTCSdpUtils").validateOfferSdp(d,x.toSdp())){B.next=32;break}throw b("FBRTCRtcResponseStatusCode").BAD_REQUEST;case 32:B.next=34;return b("regeneratorRuntime").awrap(a.setLocalDescription(x));case 34:b("RTCGroupCallActions").onJoinRequestSent();B.next=37;return b("regeneratorRuntime").awrap(b("MultiwayRequests").sendJoinRequest(m,d,e,x,f.length>0?f:null,r.length>0?q:null,{callID:b("RTCCallStore").getState().callInfo.callID,callTrigger:p,numParticipants:b("RTCCallStore").getState().remoteUsers.size},{userToEscalate:n&&f.length>0?f[0]:null,isEscalator:b("RTCGroupCallEscalationStore").getState().toRing,escP2PCallID:o}));case 37:y=B.sent;b("RTCGroupCallActions").onReceivedJoinResponse();n&&b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","sent_join_request");z=y.header.responseStatusCode;if(!(z!==b("FBRTCRtcResponseStatusCode").OK)){B.next=43;break}return B.abrupt("return",new(b("Promise"))(function(a,b){b(z)}));case 43:b("RTCGroupCallActions").onJoinResponse(y.header.serverInfoData);A=new(b("RTCSessionDescription"))(j.MULTIWAY,{type:"answer",sdp:y.body.joinResponse.answer.sdpString},{FORMAT_PARAMETERS:i});if(!l){B.next=48;break}B.next=48;return b("regeneratorRuntime").awrap(a.setRemoteDescription(A));case 48:b("RTCGroupCallActions").toggleRemoteStream(y.body.joinResponse.mediaStatus);b("RTCGroupCallActions").onProcessedJoinResponse();return B.abrupt("return",A);case 51:case"end":return B.stop()}},null,this)}function p(a){a instanceof Object||g(0);return a}e.exports=n}),null);
__d("CollabCallMessengerBrowserEventEnum",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({CALL_CONNECTED:"call: connected",CALL_ENDED:"call: ended",CALL_PROCESS_STARTED:"call: start process",CALL_START_TRY:"call: try",CONNECTION_INFO:"connection info",CONNECTION_RECOVERY:"connection recovery",HANGUP_CALL_ID_MISSMATCH:"hangup callID missmatch",TURN_CREDENTIALS_RECEIVED:"TURN credentials received",OFFER_ACCEPTED:"offer accepted",OFFER_IGNORED:"offer ignored",RENEGOTIATION:"offer renegotiation",LOCAL_STREAM_READY:"local stream: ready",LOCAL_STREAM_SET:"local stream: set",LOCAL_STREAM_STARTED:"local stream: started",LOCAL_STREAM_TRACKS_CHANGED:"local stream: tracks changed",FLOOR_STATUS_CHANGE:"floor status change",LOCAL_SCREEN_STREAM_SET:"screen stream: set",SCREEN_SHARING_CANCELLED:"screen sharing: cancelled",SCREEN_SHARING_DIALOG_CANCEL:"screen sharing: dialog cancel",SCREEN_SHARING_DIALOG_SUCCESS:"screen sharing: dialog success",SCREEN_SHARING_ERROR:"screen sharing: error",SCREEN_SHARING_EXT_DIALOG:"screen sharing: extension install dialog",SCREEN_SHARING_EXT_LINK:"screen sharing: user clicked on install link",SCREEN_SHARING_NOT_SUPPORTED:"screen sharing: not supported",SCREEN_SHARING_TOGGLED:"screen sharing: toggled",SCREEN_TRACK_ADD:"add screen track",SCREEN_TRACK_REMOVE:"remove screen track",SCREEN_TRACK_REPLACE:"replace screen track",REMOTE_STREAM_ADDED:"remote stream: added",REMOTE_STREAM_MUTE_TOGGLED:"remote steam: mute toggled",REMOTE_STREAM_REMOVED:"remote stream: removed",REMOTE_STREAM_SET:"remote stream: set",REMOTE_STREAM_STARTED:"remote stream: started",REMOTE_STREAM_TRACKS_CHANGED:"remote stream: tracks changed",CALL_CONTROLLER_INIT:"call controller init",FAIL_BROWSER_NOT_SUPPORTED:"browser not supported",REQUEST_USER_MEDIA:"request user media",ICE_CANDIDATE_ERROR:"ICE candidate error",ICE_CONNECTION_STATE_CHANGE:"ICE connection state change",ICE_GATHERING_STATE_CHANGE:"ICE gathering state change",MESSAGE_RECEIVED:"message received",MESSAGE_SENT:"message sent",RTC_ERROR:"RTC error",SDP_UPDATE:"SDP update",USER_SETTINGS_CHANGED:"user settings change",AUDIO_FALLBACK:"audio fallback",GET_USER_MEDIA_ERROR:"get user media: error",INIT_STREAM_ERROR:"init stream error",INIT_USER_MEDIA_CONSTRAINT:"init user media constraint",STAR_RATING:"call rating",SURVEY_DETAILS:"survey_details"})}),null);
__d("XRTCCallNUXController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/rtc/call/nuxstatus/",{})}),null);
__d("RTCP2PCallNUXActions",["FBRTCLogger","FBRTCUtils","RTCAppDispatcher","RTCP2PCallActionTypes","XRTCCallNUXController","dangerouslyBypassDispatchError"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={refreshNUXState:function(){b("FBRTCUtils").sendServerRequest(b("XRTCCallNUXController").getURIBuilder().getURI(),function(a){a=a.payload;b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").P2P_INIT_NUX_STATE,payload:a})},function(){})},markNUXViewed:function(a){try{b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").P2P_MARK_NUX_VIEWED,nuxID:a})}catch(c){b("dangerouslyBypassDispatchError")(function(){return b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").P2P_MARK_NUX_VIEWED,nuxID:a})})}},dismissNUX:function(a){b("RTCAppDispatcher").dispatch({type:b("RTCP2PCallActionTypes").P2P_DISMISS_NUX,nuxID:a})}};e.exports=a}),null);
__d("RTCPeerConnectionQueue",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.$1=[],this.$2=[]}a.prototype.push=function(a,b){switch(a){case"add":this.$1.push(b);break;case"remove":this.$2.push(b);break}};a.prototype.drain=function(){this.$3(this.$2),this.clear("remove"),this.$3(this.$1),this.clear("add")};a.prototype.$3=function(a){__p&&__p();if(a.length<1)return;for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;try{d()}catch(a){}}};a.prototype.clear=function(a){switch(a){case"add":this.$1=[];break;case"remove":this.$2=[];break;default:this.$1=[],this.$2=[]}};e.exports=a}),null);
__d("RTCP2PProtocolHandler",["invariant","Promise","Bootloader","CollabCallMessengerBrowserEventEnum","CurrentUser","ErrorUtils","FBLogger","FBRTCCallControlActions","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConsoleLogger","FBRTCConstants","FBRTCExperiment","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLocalUploadLogLevel","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageListener","FBRTCMessageSender","FBRTCPCConfig","FBRTCPeerConnection","FBRTCRetriableMessage","FBRTCSdpUtils","FBRTCSupport","FBRTCTurnDiscovery","FBRTCUrlManager","FBRTCUserSettings","FBRTCVideoEscalationStore","FunnelLogger","MessengerRTCFunnelLogger","RTCCallActions","RTCCallStore","RTCCallType","RTCConferenceState","RTCConfig","RTCEndCallReason","RTCGroupCallEscalationStore","RTCGroupCallEscalator","RTCP2PCallActions","RTCP2PCallEscalationActions","RTCP2PCallEscalationStore","RTCP2PCallEscalator","RTCP2PCallNUXActions","RTCP2PCallStore","RTCP2PCallWindowHandler","RTCP2PConnectionStatus","RTCPeerConnectionQueue","RTCSessionDescription","RTCStreamDurationTracker","RTCUserMediaConstraints","RTCUtils","UserAgent","debounce","gkx"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("FBRTCConstants").CallEndReason,i=b("FBRTCConstants").SignalingProtocol,j=b("FBRTCConstants").VideoQuality,k=6e4,l=3e4;function m(){__p&&__p();this.$4={streams:{}},this.$5=b("FBRTCLogger").getInstance(),this.$7=!1,this.$8=!0,this.$9=!1,this.$10="passive",this.$11=new(b("FBRTCMessageSender"))(),this.$16=new(b("FBRTCIceCache"))(),this.$17=!1,this.$20=null,this.$21=null,this.$23=new(b("RTCStreamDurationTracker"))("video"),this.$24=new(b("RTCStreamDurationTracker"))("video"),this.$25=new(b("RTCStreamDurationTracker"))("screen"),this.$26=!1,this.$27=new(b("RTCPeerConnectionQueue"))(),this.$57=function(a){this.$32(h.WEBRTC_ERROR,!1,!0,!1,a.message),q(a)}.bind(this),this.$42=function(a){a=a.candidate;a&&this.$58(a)}.bind(this),this.$43=function(a){__p&&__p();a=a.target;a=a.iceConnectionState;p("P2P:PC iceconnectionstatechange %o",a);(this.$21==="disconnected"||this.$21==="failed")&&a==="connected"&&this.$29(b("CollabCallMessengerBrowserEventEnum").CONNECTION_RECOVERY,this.$21);this.$29(b("CollabCallMessengerBrowserEventEnum").ICE_CONNECTION_STATE_CHANGE,a);clearTimeout(this.$20);switch(a){case"checking":this.$9=!0;break;case"connected":case"completed":this.$59();this.$60();break;case"failed":this.$20=setTimeout(function(){if(b("RTCConfig").CollaborationBrowserConfig.ICE_recovery&&b("FBRTCConfig").isVCEndpointCall()){this.$61("ICE failure");return}this.$57(new Error("ICE failed"));b("RTCP2PCallActions").setConnectionStatus(b("RTCP2PConnectionStatus").DISCONNECTED)}.bind(this),b("RTCConfig").CollaborationBrowserConfig.ICE_failed_timeout);break;case"disconnected":this.$20=setTimeout(function(){this.$32(h.CONNECTION_DROPPED,!1,!0,!1)}.bind(this),b("RTCConfig").CollaborationBrowserConfig.ICE_disconnected_timeout);break;case"closed":break}}.bind(this),this.$65=function(){var a=this.$3.getCreatedIceCandidates();for(var b=0;b<a.length;b++)this.$58(a[b])}.bind(this),this.$44=function(a){a=a.target;a=a.iceGatheringState;p("P2P:PC icegatheringstatechange %o",a);this.$29(b("CollabCallMessengerBrowserEventEnum").ICE_GATHERING_STATE_CHANGE,a)}.bind(this),this.$45=function(a){var c=a.errorCode,d=a.errorText,e=a.hostCandidate;a=a.url;p("P2P:PC icecandidateerror %o: %s %o %o",c,d);this.$29(b("CollabCallMessengerBrowserEventEnum").ICE_CANDIDATE_ERROR,{errorCode:c,errorText:d,hostCandidate:e,url:a})}.bind(this),this.$66=function(){var a;this.$22?a=h.UNSUPPORTED_VERSION:a=h.OTHER_NOT_CAPABLE;this.$32(a,!1,!0,!1,"TimedOut")}.bind(this),this.$48=b("debounce")(function(a){__p&&__p();var c=a.target;if(c.iceConnectionState==="closed"){p("P2P:PC negotiationneeded pc is %o",c.iceConnectionState);return}else if(!this.$8){this.$29(b("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"ignore");p("P2P:PC negotiationneeded %o","ignore");return}else if(!b("RTCP2PCallEscalator").isNegotiationAllowed()){this.$29(b("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"not allowed - escalating");p("P2P:PC negotiationneeded %o","not allowed","escalating");return}else if(this.$7){this.$29(b("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"retry");p("P2P:PC SDP lock %o, will retry in a bit","on");setTimeout(function(){return this.$48(a)}.bind(this),100);return}else p("P2P:PC SDP lock %o","off");this.$8=!1;var d=[];p("P2P:PC negotiationneeded @ signalingState %o",c.signalingState);if(c.signalingState==="stable"){if(this.$9){c=b("RTCP2PCallStore").getState();c=c.signalingExperiments;if(!c.support("sdp_update"))this.$62(),d.push("new offer");else{c=m.supportMultipleStreams();d.push("SDP update",c?"plan B":null)}this.$10="passive"}this.$29(b("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"create offer");this.$63().then(function(a){if(a.strongDiff(this.$3.getLocalDescription())){p("P2P SDP difference %o - set offer","strong");this.$29(b("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,d);return a}p("P2P SDP difference %o - noop","weak");return null}.bind(this)).then(function(a){a&&(this.$9&&b("RTCP2PCallActions").setConnectionStatus(b("RTCP2PConnectionStatus").RECONNECTING),this.$64(a)),this.$10="active"}.bind(this))["catch"](this.$57)}}.bind(this),50),this.$49=function(a){__p&&__p();if(this.$26){this.$27.push("add",function(){return this.$49(a)}.bind(this));return}var c=a.stream,d=this.$56(c),e=this.$1;d===b("FBRTCConstants").StreamType.SCREEN_CONTENT?(b("RTCCallActions").addRemoteScreenStream(c,e),!m.supportMultipleStreams()&&c.getAudioTracks().length>0&&this.$24.track(c)):(b("FBRTCUserSettings").updateForRemoteStream(c),b("RTCCallActions").addRemoteStream(c,e),this.$24.track(c),b("RTCP2PCallStore").addListener(b("debounce")(function(){b("RTCP2PCallStore").getState().callType!==b("RTCCallType").AUDIO_ONLY&&this.$59()}.bind(this),50)));this.$29(b("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_ADDED,c);p("P2P:PC remote %o stream %o %o %o",d,"added",c,", tracks: ",c.getTracks())}.bind(this),this.$51=function(a){__p&&__p();if(this.$26){this.$27.push("remove",function(){return this.$51(a)}.bind(this));return}var c=a.stream,d=this.$56(c),e=this.$1;if(d===b("FBRTCConstants").StreamType.SCREEN_CONTENT){b("RTCCallActions").removeRemoteScreenStream(c,e);var f=b("RTCCallStore").getState().remoteUsers.first();if(f){f=f.streams.first();f&&this.$24.track(f)}}else b("RTCCallActions").removeRemoteStream(c,e);this.$29(b("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_REMOVED,c);p("P2P:PC remote %o stream %o %o %o",d,"removed",c,", tracks: ",c.getTracks())}.bind(this),this.$30=function(a){this.$5.logInfo(this.$1,this.$2,"Received Turn Creds"),this.$29(b("CollabCallMessengerBrowserEventEnum").TURN_CREDENTIALS_RECEIVED,a),b("FBRTCPCConfig").setTurnCredentials(a)}.bind(this),this.$31=function(){this.$5.logError(this.$1,this.$2,"Failed to get turn creds"),this.$32(h.CLIENT_ERROR,!1,!b("RTCP2PCallStore").isCaller(),!1,"NoTurnCreds")}.bind(this),this.$38=function(a,b){this.$32(a,!1,!1,!1,b)}.bind(this),this.$37=function(a,c){__p&&__p();var d=c.call_id;if(this.$76()){this.$5.logError(this.$1,this.$2,"Message sent after call ended: "+c.type);return}if(this.$1!==a||this.$2!==d)return;r(function(a){return a.onMessageSent(c)});this.$29(b("CollabCallMessengerBrowserEventEnum").MESSAGE_SENT,c)}.bind(this),this.$40=function(a){__p&&__p();var c;try{c=new(b("FBRTCMessage"))(a)}catch(b){this.$5.logError(this.$1,this.$2,"Unknown data: "+JSON.stringify(a));return}this.$5.logReceivedMessage(c.peerID,c.callID,c.msg);this.$29(b("CollabCallMessengerBrowserEventEnum").MESSAGE_RECEIVED,c.msg);if(this.$76()){this.$5.logInfo(this.$1,this.$2,"Ignoring message (call ended): "+c.msgID);return}if(!b("FBRTCMessageDedup").check(c.peerID,c.callID,c.msgID)){this.$5.logInfo(this.$1,this.$2,"Ignoring message (duplicate): "+c.msgID);return}if(b("RTCCallStore").getState().callInfo.conferenceState===b("RTCConferenceState").AWAITING_USER_START){this.$5.logInfo(this.$1,this.$2,"Ignoring message (awaiting user start): "+c.msgID);return}if(this.$1&&this.$1!==c.peerID){c.isOffer()&&this.$77(c);this.$5.logInfo(this.$1,this.$2,"Ignoring message (different peer): "+c.msgID);return}if(!c.isForCall(this.$2,this.$15)){this.$5.logInfo(this.$1,this.$2,"Ignoring message (different call): "+c.msgID+"(callID: "+c.callID+")");return}p("P2P msg.get type:%o callID:%o %o",c.msgType,c.callID,c);this.$2&&this.$2===c.callID&&r(function(a){return a.onFullMessageReceived(c)});b("RTCP2PCallActions").setRemoteSignalingExperiments(c.getSignalingExperiments());a=b("RTCGroupCallEscalationStore").getState().inProgress;switch(c.msgType){case b("FBRTCConstants").PayloadType.ICERESTART_OFFER:case b("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.$62();this.$78(c);break;case b("FBRTCConstants").PayloadType.OFFER:this.$78(c);break;case b("FBRTCConstants").PayloadType.ANSWER:case b("FBRTCConstants").PayloadType.ICERESTART_ANSWER:case b("FBRTCConstants").PayloadType.PCRESTART_ANSWER:this.$79(c);break;case b("FBRTCConstants").PayloadType.SDP_UPDATE:this.$80(c);break;case b("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$81(c);break;case b("FBRTCConstants").PayloadType.HANGUP:this.$82(c);break;case b("FBRTCConstants").PayloadType.OFFER_ACK:this.$83(c);break;case b("FBRTCConstants").PayloadType.OFFER_NACK:this.$22=!0;break;case b("FBRTCConstants").PayloadType.ANSWER_ACK:this.$84();break;case b("FBRTCConstants").PayloadType.MSG_ACK:this.$85(c);break;case b("FBRTCConstants").PayloadType.SET_VIDEO:b("RTCP2PCallStore").getState().isRemoteVideoSupported&&!b("RTCP2PCallStore").isAudioOnly()&&this.$74(c.msg);break;case b("FBRTCConstants").PayloadType.SWITCH_TO_MULTIWAY:!a?this.handleSwitchToMultiway():p("P2P Received %o while escalation is in progress %o",c.msgType,c);break;case b("FBRTCConstants").PayloadType.VIDEO_REQUEST:case b("FBRTCConstants").PayloadType.ACK:case b("FBRTCConstants").PayloadType.OK:case b("FBRTCConstants").PayloadType.PING:case b("FBRTCConstants").PayloadType.PING_ACK:case b("FBRTCConstants").PayloadType.OTHER_DISMISS:case b("FBRTCConstants").PayloadType.PRANSWER:break;default:break}this.$28.parseMessage(c);b("FBRTCCallControlActions").receivedSignalingMessage(c)}.bind(this),this.$39=function(a){a=a.message+"; "+a.stackFrames[0].identifier;this.$5.logError(this.$1,this.$2,"JSError: "+a)}.bind(this),this.$29(b("CollabCallMessengerBrowserEventEnum").CALL_CONTROLLER_INIT)}m.prototype.init=function(a,c){this.$1=a;this.$2=c;this.$5.logInfo(this.$1,this.$2,"init call");this.$6=new(b("FBRTCLocalMessageQueue"))();a=this.$6.getOffer(this.$1);if(a){c=new(b("FBRTCMessage"))(a);b("RTCP2PCallActions").processMessage(c)}};m.prototype.fetchTURNCredentials=function(){if(b("FBRTCConfig").isVCEndpointCall()){this.$5.logInfo(this.$1,this.$2,"Skipping the TURN discovery");return b("Promise").resolve()}this.$29(b("CollabCallMessengerBrowserEventEnum").CALL_START_TRY,"not ready");return b("FBRTCTurnDiscovery").requestTurnCreds(this.$2.toString(),this.$1).then(this.$30,this.$31)};m.prototype.endCall=function(a,c,d){a===void 0&&(a=h.HANGUP_CALL),c===void 0&&(c=""),d===void 0&&(d=!1),b("RTCCallActions").hangup(a,c),this.$32(a,!1,!0,d,c)};m.prototype.startCall=function(a){__p&&__p();this.$29(b("CollabCallMessengerBrowserEventEnum").CALL_PROCESS_STARTED,{callTrigger:a,userCallType:this.$33()});this.$3=this.$34();this.$35();this.$27=new(b("RTCPeerConnectionQueue"))();var c=this.$6.getOffer(this.$1),d=null;c?(this.$18=new(b("FBRTCMessage"))(c),b("FBRTCMessageDedup").check(this.$1,this.$18.callID,this.$18.msgID),d=!1):(d=!0,b("RTCP2PCallActions").setIsCaller(d));this.$8=d;this.$18 instanceof b("FBRTCMessage")&&b("RTCP2PCallActions").processMessage(this.$18);this.$36(a,d);b("FBRTCUrlManager").init(this.$1);this.$11=new(b("FBRTCMessageSender"))();this.$11.onMessageSent=this.$37;this.$11.onSendFailure=this.$38;this.$28=new(b("RTCP2PCallEscalator"))(this.$1,this.$2,this.$11);b("ErrorUtils").addListener(this.$39,!0);b("FBRTCMessageListener").setMessageHandler(this.$40,this);this.$41();b("RTCP2PCallActions").setConnectionStatus(b("RTCP2PConnectionStatus").CONTACTING);b("RTCCallActions").call([this.$1],this.$3)};m.prototype.$36=function(a,c){c=b("FBRTCCallSummary").restoreOrInitialize(b("FBRTCCallSummaryStore").getInstance(),this.$1,this.$2,c,this.$18&&this.$18.msg,a);c.setCallType(b("RTCP2PCallStore").getState().callType===b("RTCCallType").AUDIO_ONLY?b("FBRTCVideoEscalationStore").CallType.voip:b("FBRTCVideoEscalationStore").CallType.direct_video);this.initV2CallSummary(c);b("RTCCallActions").setCallSummary(c)};m.prototype.startScreenStream=function(a){if(!m.supportMultipleStreams()){var c=b("RTCCallStore").getState();c=c.localUser;c=c.streams.first();b("RTCUtils").transferAudioTracks(a,c)}b("RTCCallActions").addLocalScreenStream(a)};m.prototype.stopScreenStream=function(a){__p&&__p();var c=b("RTCCallStore").getState();c=c.localUser;if(!c.screenStreams.includes(a))return;if(!m.supportMultipleStreams()){c=c.streams.first();b("RTCUtils").transferAudioTracks(c,a)}b("RTCCallActions").removeLocalScreenStream(a);b("RTCUtils").stopMediaStream(a)};m.prototype.updateScreenStream=function(a,c){b("RTCUtils").transferAudioTracks(c,a),b("RTCCallActions").replaceLocalScreenStream(a,c),b("RTCUtils").stopMediaStream(a)};m.prototype.$34=function(){__p&&__p();var a=b("RTCP2PCallStore").getState();a=a.isPeerOnMobile;a=new(b("FBRTCPeerConnection"))(i.P2P,b("FBRTCPCConfig").getConfig(),b("FBRTCPCConfig").getConstraints(a));var c,d,e,f;b("RTCCallStore").addListener(b("debounce")(function(){__p&&__p();var a=b("RTCCallStore").getState();a=a.localUser;if(!a||a===c)return;c=a;var g=a.isVideoMuted();d!==g&&(this.$11&&d!=null&&(!a.hasScreenStream()||m.supportMultipleStreams())&&this.$11.sendMuteStateUpdate(this.$1,this.$2,!g),d=g);g=a.streams;a=a.screenStreams;g!==e||a!==f?(e=g,f=a,this.$35()):this.$23.update()}.bind(this),50));b("FBRTCConfig").isVCEndpointCall()&&a.createDataChannel("noop");a.addEventListener("icecandidate",this.$42);a.addEventListener("iceconnectionstatechange",this.$43);a.addEventListener("icegatheringstatechange",this.$44);a.addEventListener("icecandidateerror",this.$45);a.addEventListener("connectionstatechange",this.$46);a.addEventListener("signalingstatechange",this.$47);a.addEventListener("negotiationneeded",this.$48);a.addEventListener("addstream",this.$49);a.addEventListener("track",this.$50);a.addEventListener("removestream",this.$51);a.addEventListener("datachannel",this.$52);this.$53(a);return a};m.supportMultipleStreams=function(){var a=b("RTCP2PCallStore").getState();a=a.signalingExperiments;return a.support("multiple_streams_plan_b")};m.prototype.$35=function(){__p&&__p();if(this.$3.getSignalingState()==="closed")return;var a=b("RTCCallStore").getState();a=a.localUser;if(!a)return;var c=this.$3.getLocalStreams(),d=a.getStream();a=a.getScreenStream();if(m.supportMultipleStreams()){a?(this.$54(a),this.$25.track(a)):this.$25.update();d?(this.$54(d),this.$23.track(d)):this.$23.update();for(var e=c,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;!(a&&h===a)&&!(d&&h===d)&&this.$55(h)}}else{h=null;a?(this.$54(a),this.$25.track(a),h=a):(this.$25.update(),d&&(this.$54(d),h=d));h&&this.$23.track(h);for(var g=c,f=Array.isArray(g),e=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(e>=g.length)break;a=g[e++]}else{e=g.next();if(e.done)break;a=e.value}d=a;h&&h===d||this.$55(d)}}};m.prototype.updateAddedTracksForFirefoxVideoEscalation=function(a){b("FBRTCPeerConnection").isFirefoxSupportAddTrack()||b("FBLogger")("rtc_www").mustfix("This function must be called within Firefox context"),this.$8=!0,this.$3.addStream(a),m.replaceLocalStream(a)};m.prototype.$54=function(a){var b=this.$3.getLocalStreams();if(b.includes(a))return;p("P2P:PC local %o stream %o %o %o",this.$56(a),"added",a,", tracks: ",a.getTracks());this.$8=!0;this.$3.addStream(a)};m.prototype.$55=function(a){var b=this.$3.getLocalStreams();if(!b.includes(a))return;p("P2P:PC local %o stream %o %o %o",this.$56(a),"removed",a,", tracks: ",a.getTracks());this.$8=!0;this.$3.removeStream(a)};m.prototype.$61=function(a){this.$7=!0,this.$8=!1,this.$10="passive",this.$62(),p("P2P:PC recovering from %o",a),this.$29(b("CollabCallMessengerBrowserEventEnum").CONNECTION_RECOVERY,a),this.$63().then(function(a){b("RTCP2PCallActions").setConnectionStatus(b("RTCP2PConnectionStatus").RECONNECTING),this.$64(a),this.$10="active"}.bind(this))["catch"](this.$57)};m.prototype.$63=function(){var a=!b("RTCP2PCallStore").isAudioOnly()||b("RTCP2PCallEscalator").initVideoInAudioCall();return this.$3.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:a},{ADD_FB_FEATURES:["video"]})};m.prototype.$58=function(a){this.$11.sendIceCandidate(this.$1,this.$2,a)};m.prototype.$46=function(a){a=a.target;p("P2P:PC connectionstatechange %o",a.connectionState)};m.prototype.$47=function(a){a=a.target;p("P2P:PC signalingstatechange %o",a.signalingState)};m.prototype.$62=function(){__p&&__p();this.$8=!1;var a=this.$1,c=b("RTCCallStore").getState().remoteUsers.first(),d=c.streams,e=c.screenStreams;this.$26=!0;this.$27.clear("add");this.$27.push("remove",function(){__p&&__p();for(var c=d,f=Array.isArray(c),g=0,c=f?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=c.length)break;h=c[g++]}else{g=c.next();if(g.done)break;h=g.value}h=h;b("RTCCallActions").removeRemoteStream(h,a)}for(var h=e,g=Array.isArray(h),f=0,h=g?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(f>=h.length)break;c=h[f++]}else{f=h.next();if(f.done)break;c=f.value}c=c;b("RTCCallActions").removeRemoteScreenStream(c,a)}});this.$3.reset().then(function(){this.$26=!1,this.$27.drain()}.bind(this))["catch"](q);b("FBRTCConfig").isVCEndpointCall()&&this.$3.createDataChannel("noop")};m.prototype.$50=function(a){a=b("RTCCallStore").getState().remoteUsers.first();a&&!a.isVideoMuted()&&b("RTCCallActions").toggleMuteRemoteVideo(!1,a.FBID)};m.prototype.$56=function(a){var c=b("FBRTCConstants").StreamType;try{switch(this.$4.streams[a.id].type){case c.SCREEN_CONTENT:return c.SCREEN_CONTENT;case c.AUDIO_VIDEO:return c.AUDIO_VIDEO;case c.AUDIO_ONLY:return c.AUDIO_ONLY;default:throw Error("no known stream type found, detecting")}}catch(b){return a.getVideoTracks().length>0?c.AUDIO_VIDEO:c.AUDIO_ONLY}};m.prototype.$59=function(){this.$23.isStarted()?this.$23.update():this.$23.start();var a=b("RTCP2PCallStore").getState();a=a.callType;a!==b("RTCCallType").AUDIO_ONLY&&(this.$24.isStarted()?this.$24.update():this.$24.start());this.$25.isStarted()?this.$25.update():this.$25.start()};m.prototype.$60=function(){b("RTCP2PCallActions").setConnectionStatus(b("RTCP2PConnectionStatus").CONNECTED),r(function(a){a.onCallConnected(),a.onNetworkReady()})};m.prototype.$52=function(a){a=a.channel;p("P2P:PC datachannel %o",a)};m.prototype.startLocalVideoTracker=function(a){this.$23.track(a)};m.prototype.updateLocalVideoTracker=function(){this.$23.update()};m.initStream=function(a,c,d){__p&&__p();var e=b("RTCP2PCallStore").getState();e=e.isPeerOnMobile;var f=b("FBRTCExperiment").gen("rtc_www_p2p_video_quality");f=f.getBool("use_mw_constraints",!1);e&&!f&&b("RTCP2PCallActions").setVideoQuality(j.LQ_VIDEO);e=!a&&b("RTCP2PCallEscalator").initVideoInAudioCall();d=b("RTCUserMediaConstraints").video(f?j.HD_VIDEO:b("RTCP2PCallStore").getState().videoQuality,d||"");var g=a||e?f?babelHelpers["extends"]({},o(d)):babelHelpers["extends"]({aspectRatio:{ideal:Number((16/9).toFixed(10))}},o(d)):!1;return b("RTCUtils").getUserMediaWithAudioFallback({audio:b("RTCUserMediaConstraints").audio(c||""),video:g},{optionalConstraintsOnly:f,supportFilteredStreams:!0}).then(function(c){__p&&__p();c.getVideoTracks().forEach(function(b){b.enabled=a});if(a)try{var d=c.getVideoTracks();d=d[0];d||n(function(a){return a.log(b("CollabCallMessengerBrowserEventEnum").AUDIO_FALLBACK,{eventDetails:{videoConstraints:g}})})}catch(a){n(function(c){return c.log(b("CollabCallMessengerBrowserEventEnum").INIT_STREAM_ERROR,{eventDetails:{error:a.name,message:a.message,videoConstraints:g}})})}return c})};m.replaceLocalStream=function(a,c){c===void 0&&(c=!1);var d=b("RTCCallStore").getState().localUser.streams.first();b("RTCCallActions").replaceLocalStream(d,a);c&&b("RTCUtils").stopMediaStream(d)};m.prototype.escalateToMultiway=function(){var a=b("RTCP2PCallStore").getState(),c=a.callType,d=a.offerEscalationSupport;a=a.escalationConferenceName;if(d&&a){r(function(a){return a.setEscalationInitiated()});d=c!==b("RTCCallType").AUDIO_ONLY&&(b("RTCCallStore").hasRemoteVideo()||b("RTCCallStore").hasLocalVideo());c=new(b("RTCGroupCallEscalator"))(a,d,this.$1,this.$2);c.startEscalationToMultiway()}};m.prototype.handleSwitchToMultiway=function(){__p&&__p();var a=b("RTCP2PCallStore").getState(),c=a.callType,d=a.offerEscalationSupport;a=a.escalationConferenceName;this.$7=!1;b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","received_switch_to_multiway");if(d&&a){r(function(a){return a.setReceivedEscalationRequest()});d=c!==b("RTCCallType").AUDIO_ONLY&&(b("RTCCallStore").hasRemoteVideo()||b("RTCCallStore").hasLocalVideo());c=new(b("RTCGroupCallEscalator"))(a,d,this.$1,this.$2);c.startEscalationToMultiway()}};m.prototype.$67=function(a,c){var d=b("gkx")("AT5cptvyk3v4q-mPX6FvPR1r8kJdnP0MgzuDdVra8DpZXuiu89qXhkgPD7OKcZn2j9_1ar1-0wqcgyg_FLY_IdusNDUe63z-hD6N3VThwJfBrw"),e=a&&d&&b("FBRTCSupport").isGroupCallWebtrcSupported();this.$14=e;this.$15=c;b("RTCP2PCallActions").setMultiwayEscalationSupport(e,c);r(function(a){a.setConferenceName(c),e&&a.setEscalationAvailable()})};m.prototype.$41=function(){__p&&__p();b("FBRTCUrlManager").onCallStarted();p("P2P start call offer %o",this.$18);if(this.$18){this.$7=!0;this.$8=!1;var a=this.$18.msg,c=a.sdp,d=a.attributes,e=a.offer_escalation_support;a=a.escalation_conference_name;b("RTCP2PCallActions").setRemoteSignalingExperiments(this.$18.getSignalingExperiments());this.$67(!!e,a);this.$68(c,"offer",d);this.$6.removeOffer(this.$1);this.$18=null}this.$29(b("CollabCallMessengerBrowserEventEnum").CALL_START_TRY)};m.prototype.$64=function(a){__p&&__p();p("P2P SDP %o created %o",a.type,a);this.$7=!0;return this.$3.setLocalDescription(a).then(function(a){return a.toDesc()}).then(function(a){__p&&__p();var c=a.sdp;a=a.type;p("P2P SDP %o set %o",a,{sdp:c});switch(a){case"offer":b("RTCP2PCallStore").getState().signalingExperiments.support("sdp_update")&&b("RTCCallStore").getState().callInfo.conferenceState===b("RTCConferenceState").CONNECTED?this.$69(c):this.$70(c);this.$17=!1;break;case"answer":this.$71(c);break;default:break}}.bind(this))["catch"](this.$57)};m.prototype.$72=function(){return{streams:this.$73()}};m.prototype.$73=function(){__p&&__p();var a={},c=b("RTCCallStore").getState();c=c.localUser.screenStreams;for(var d=this.$3.getLocalStreams(),e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;var h=c.includes(g)?b("FBRTCConstants").StreamType.SCREEN_CONTENT:g.getVideoTracks().length?b("FBRTCConstants").StreamType.AUDIO_VIDEO:b("FBRTCConstants").StreamType.AUDIO_ONLY;a[g.id]={type:h}}return a};m.prototype.$69=function(a){var c=b("RTCCallStore").getState();c=c.localUser;this.$11.sendSdpUpdate(this.$1,this.$2,a,!b("RTCP2PCallStore").isAudioOnly()&&!c.isVideoMuted(),this.$72())};m.prototype.$70=function(a){__p&&__p();var c=this.$9?b("FBRTCConstants").PayloadType.PCRESTART_OFFER:b("FBRTCConstants").PayloadType.OFFER;p("P2P offer type %o",c);var d=b("RTCCallStore").getState();d=d.callSummary;d=d?d.getCallTrigger():"";this.$12=new(b("FBRTCRetriableMessage"))(this.$11);this.$12.addListener("sendingRetry",this.$65);this.$12.addListener("timeoutFailure",this.$66);this.$12.sendMessage(c,this.$1,this.$2,a,!b("RTCP2PCallStore").isAudioOnly(),this.$72(),null,d);this.$19=setTimeout(function(){this.$32(h.NO_ANSWER_TIMEOUT,!1,!0,!1,"NoAnswerTimeout")}.bind(this),k)};m.prototype.$74=function(a){__p&&__p();if(!Object.prototype.hasOwnProperty.call(a,"videoon"))return;a=!a.videoon;b("RTCCallActions").toggleMuteRemoteVideo(a,this.$1);for(var a=this.$3.getRemoteStreams(),c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;if(e.getAudioTracks().length>0){this.$29(b("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_MUTE_TOGGLED,e);return}}this.$24.update()};m.prototype.$71=function(a){this.$13=new(b("FBRTCRetriableMessage"))(this.$11);this.$13.addListener("sendingRetry",this.$65);var c={escalationConferenceName:this.$15,negotiatedEscalationSupport:this.$14};this.$13.sendMessage(b("FBRTCConstants").PayloadType.ANSWER,this.$1,this.$2,a,!b("RTCP2PCallStore").isAudioOnly(),this.$72(),c)};m.prototype.$75=function(a){this.$32(h.WEBRTC_ERROR,!1,!0,!1,a.endCallSubreason),this.$5.logError(this.$1,this.$2,"webrtc error: "+JSON.stringify(a.details)),this.$29(b("CollabCallMessengerBrowserEventEnum").RTC_ERROR,a.details)};m.prototype.$77=function(a){__p&&__p();var c=a.peerID,d=a.callID,e=a.msg,f=new(b("FBRTCCallSummary"))({peerID:c,callID:d,isCaller:!1});this.initV2CallSummary(f);f.onFullMessageReceived(a);f.setCallType(b("FBRTCSdpUtils").isVideoSupported(e.sdp)?b("FBRTCVideoEscalationStore").CallType.direct_video:b("FBRTCVideoEscalationStore").CallType.voip);this.$11.sendOfferAck(c,d,e);f.onOfferAckSent(e);a=new(b("RTCEndCallReason"))(h.IN_ANOTHER_CALL);this.$86(c,d,a,!1);f.onCallEnded(a.getReasonID(),!1);f.save(b("FBRTCCallSummaryStore").getInstance())};m.prototype.$78=function(a){__p&&__p();p("P2P handle %o","offer");var b=this.$3.getSignalingState();if(b!=="stable"){p("P2P ignore %o; wrong signaling state: %o","offer",b);return}b=a.msg;if(b.calltype){this.$11.sendOfferNack(this.$1,b.call_id,b);return}this.$11.sendOfferAck(this.$1,b.call_id,b);this.$11.sendOtherDismiss(b.call_id);this.$87(b)?this.$88(a):this.$89(a)};m.prototype.$88=function(a){__p&&__p();var c=a.msg;this.$74(c);this.$90();this.$91();this.$92();if(this.$2!==c.call_id){var d=new(b("RTCEndCallReason"))(h.OTHER_INSTANCE_HANDLED);this.$86(this.$1,this.$2,d,!1);r(function(a){a.onCallEnded(d.getReasonID(),!1)});var e=new(b("FBRTCCallSummary"))({peerID:this.$1,callID:c.call_id,isCaller:!1});b("RTCCallActions").setCallSummary(e);this.initV2CallSummary(e);r(function(d){d.onFullMessageReceived(a),d.onOfferAckSent(c),d.setCallType(b("FBRTCSdpUtils").isVideoSupported(c.sdp)?b("FBRTCVideoEscalationStore").CallType.direct_video:b("FBRTCVideoEscalationStore").CallType.voip)});this.$5.logEvent(this.$1,this.$2,"Handling offer collision")}else this.$5.logEvent(this.$1,this.$2,"Handling offer refresh");this.$17=!1;this.$18=a;b("RTCP2PCallActions").processMessage(a);this.$41();this.$29(b("CollabCallMessengerBrowserEventEnum").OFFER_ACCEPTED,a.msgID)};m.prototype.$89=function(a){p("P2P:PC ignoring offer %o",a),this.$5.logEvent(this.$1,this.$2,"Ignoring offer"),this.$29(b("CollabCallMessengerBrowserEventEnum").OFFER_IGNORED,a.msgID)};m.prototype.$80=function(a){__p&&__p();var c=a.msg;b("RTCP2PCallActions").processMessage(a);this.$74(c);switch(this.$3.getSignalingState()){case"stable":this.$68(this.$93("offer",a),"offer",c.attributes);break;case"have-local-offer":this.$68(this.$93("answer",a),"answer",c.attributes).then(function(){return this.$94()}.bind(this))["catch"](this.$57);break;case"have-remote-offer":setTimeout(function(){return this.$80(a)}.bind(this),1e3);break;case"have-local-pranswer":case"have-remote-pranswer":p("P2P SDP update unexpected signalingState %o",this.$3.getSignalingState());break;case"closed":break}this.$29(b("CollabCallMessengerBrowserEventEnum").SDP_UPDATE,[c.sdp,c.attributes])};m.prototype.$93=function(a,c){c=c.msg;var d=b("RTCP2PCallStore").getState();d=d.isPeerOnMobile;var e=b("RTCP2PCallStore").isCaller();return a==="offer"?!d&&e&&b("UserAgent").isBrowser("Firefox")?b("FBRTCSdpUtils").setDtlsRole(c.sdp,this.$10):c.sdp:b("FBRTCSdpUtils").setDtlsRole(c.sdp,d&&!e?"passive":this.$10)};m.prototype.$94=function(){this.$7=!1};m.prototype.$68=function(a,c,d){__p&&__p();p("P2P SDP %o update %o %o",c,{sdp:a},d);this.$95(d);d=b("RTCP2PCallStore").getState();d=d.isPeerOnMobile;var e=b("FBRTCExperiment").gen("rtc_www_p2p_video_quality");e=e.getBool("use_mw_constraints",!1);(d||e)&&(a=b("FBRTCSdpUtils").setVideoBitrateConstraint(a));return this.$3.setRemoteDescription(new(b("RTCSessionDescription"))(i.P2P,{type:c,sdp:a})).then(function(){p("P2P drain remote ICE"),this.$17=!0,this.$16.drainCandidates(this.$1,this.$2,function(a){return this.$3.onReceivedRemoteIceCandidate(a)}.bind(this))}.bind(this)).then(function(){this.$60();return c!=="offer"?undefined:this.$3.createAnswer({ADD_FB_FEATURES:["video"]}).then(function(a){this.$64(a),this.$29(b("CollabCallMessengerBrowserEventEnum").SDP_UPDATE,{answer:a.toSdp()})}.bind(this))}.bind(this))["catch"](function(a){this.$57(a);throw a}.bind(this))};m.prototype.$95=function(a){__p&&__p();if(a){var c=a.streams;this.$4=babelHelpers["extends"]({},this.$4,a,{streams:babelHelpers["extends"]({},this.$4.streams,c)});Object.keys(c).some(function(a){if(c[a].type===b("FBRTCConstants").StreamType.SCREEN_CONTENT){b("RTCCallActions").removeAllLocalScreenStreams(!0);return!0}return!1})}};m.prototype.$87=function(a){return a.call_id===this.$2?!0:Boolean((this.$19||!this.$18)&&(!this.$2||a.call_id!==this.$2)&&b("RTCP2PCallStore").isCaller()&&(!a.handlescollision||a.call_id<this.$2))};m.prototype.$79=function(a){__p&&__p();p("P2P handle %o","answer");var c=this.$3.getSignalingState();if(c!=="have-local-offer"){p("P2P ignore %o; wrong signaling state: %o","answer",c);return}c=a.msg;this.$67(!!c.negotiated_escalation_support,c.escalation_conference_name);this.$90();this.$91();this.$11.sendAnswerAck(this.$1,this.$2,c);b("RTCP2PCallActions").processMessage(a);b("RTCP2PCallActions").setConnectionStatus(b("RTCP2PConnectionStatus").CONNECTING);this.$68(c.sdp,"answer",c.attributes).then(function(){this.$94(),b("RTCCallActions").callSuccess(!0)}.bind(this))["catch"](this.$57);this.$74(c)};m.prototype.$85=function(a){var b=a.msg;this.$12&&this.$12.isAckMsg(b)?(r(function(b){b.onMsgAckReceived(a,!0)}),this.$83(a)):this.$13&&this.$13.isAckMsg(b)&&(r(function(b){b.onMsgAckReceived(a,!1)}),this.$84())};m.prototype.$83=function(a){b("RTCP2PCallActions").setConnectionStatus(b("RTCP2PConnectionStatus").RINGING),r(function(c){c.setUploadLogLevel(b("FBRTCLocalUploadLogLevel").getUploadLogLevel(b("FBRTCConstants").convertToUploadLogLevel(a.msg.ull)))}),this.$90()};m.prototype.$84=function(){this.$92(),this.$94(),b("RTCCallActions").incomingCallSuccess()};m.prototype.$81=function(a){var b=a.msg;b.call_id===this.$2&&this.$17?this.$3.onReceivedRemoteIceCandidate(b)["catch"](function(a){this.$96(b)}.bind(this)):this.$96(b)};m.prototype.$96=function(a){this.$16.cacheCandidate(this.$1,a.call_id,a)};m.prototype.$82=function(a){a=a.msg;var c=a.call_id,d=a.reason;a=a.subreason;c===this.$2?this.$32(d,!0,!1,!1,a):(this.$5.logError(this.$1,this.$2,"Receiving hangup for a different call: "+c.toString()),this.$29(b("CollabCallMessengerBrowserEventEnum").HANGUP_CALL_ID_MISSMATCH,c.toString()))};m.prototype.$32=function(a,c,d,e,f){__p&&__p();var g=new(b("RTCEndCallReason"))(a).setSubreason(f).setRemoteEnded(c);b("RTCCallActions").setEndCallReason(g);b("RTCP2PCallNUXActions").refreshNUXState();a=b("RTCP2PCallEscalationStore").getState().inProgress;a&&b("RTCP2PCallEscalationActions").cancel();this.$90();this.$91();this.$92();if(this.$76()){this.$5.logError(this.$1,this.$2,"Ending an already-ended call");return}this.$5.logCallAction(this.$1,this.$2,b("FBRTCLogger").CallAction.END_CALL,g.toStrName());this.$29(b("CollabCallMessengerBrowserEventEnum").CALL_ENDED,{reason:g.toStrName(),reasonID:g.getReasonID(),subReason:g.getSubreason(),isRemoteEnded:c,userCallType:this.$33()});d&&this.$86(this.$1,this.$2,g,e);this.$23.stop();this.$24.stop();this.$25.stop();this.$3&&this.$3.close();b("RTCCallActions").hangupSuccess();b("RTCCallActions").removeAllLocalStreams(!0);b("RTCCallActions").removeAllLocalScreenStreams(!0);b("RTCCallActions").removeAllRemoteStreams(this.$1);b("RTCP2PCallActions").setConnectionStatus(b("RTCP2PConnectionStatus").DISCONNECTED);r(function(a){a.setCallType(b("RTCP2PCallEscalationStore").getState().callType),a.setVideoDurations(this.$23.getDuration(),this.$24.getDuration()),a.setScreenDuration(this.$25.getDuration()),a.onCallEnded(g.getReasonID(),c,null,g.getSubreason())}.bind(this));b("MessengerRTCFunnelLogger").endFunnel("call_ended");g.getReasonID()===h.HANGUP_CALL&&g.getSubreason()==="CallReset"&&c&&b("RTCP2PCallWindowHandler").close()};m.prototype.$33=function(){var a=b("RTCCallStore").getState();a=a.localUser;return a.isVideoMuted()&&a.isAudioMuted()?b("RTCCallType").NO_AUDIO_VIDEO:a.isVideoMuted()&&!a.isAudioMuted()?b("RTCCallType").AUDIO_ONLY:b("RTCCallType").AUDIO_VIDEO};m.prototype.shutDownP2PListenersForMultiwayEscalation=function(){this.$90(),this.$91(),this.$92(),this.$23.stop(),this.$24.stop(),this.$3&&this.$3.removeAllListeners(),setTimeout(function(){b("RTCGroupCallEscalationStore").logToP2PCallSummary(function(a){a.setCallType(b("RTCP2PCallEscalationStore").getState().callType),a.setVideoDurations(this.$23.getDuration(),this.$24.getDuration()),a.setScreenDuration(this.$25.getDuration()),a.onCallEnded(h.HANGUP_CALL,!1,!1,"multiway escalation"),b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","log_endcallreason_in_summary")}.bind(this)),b("RTCCallActions").completeTransitionToMultiway()}.bind(this),100),this.destroy(),b("FunnelLogger").appendAction("WWW_MESSENGER_GROUP_ESCALATION_FUNNEL","destroy_p2p_handler")};m.prototype.$86=function(a,b,c,d){if(!this.$11)return;this.$11.sendHangup(a,b,c.getReasonID(),d,c.getSubreason());this.$11.sendOtherDismiss(b)};m.prototype.$90=function(){this.$12&&this.$12.stopRetrying()};m.prototype.$92=function(){this.$13&&this.$13.stopRetrying()};m.prototype.$91=function(){this.$19&&clearTimeout(this.$19),this.$19=null};m.prototype.$76=function(){return b("RTCCallStore").getState().callInfo.conferenceState===b("RTCConferenceState").TERMINATED};m.prototype.$53=function(a){__p&&__p();n(function(c){__p&&__p();c=c.logConnectionStats(function(){var c=a.getSignalingState();return c!=="closed"?a.getStats():b("Promise").reject("peer connection closed")},this.$1,this.$2);var d=c.start,e=c.stop,f=function(c){c=c.target;c=c.iceConnectionState;(c==="completed"||c==="connected")&&(p("P2P collab stats %o","start"),this.$5.logInfo(this.$1,this.$2,"Call Connected"),this.$29(b("CollabCallMessengerBrowserEventEnum").CALL_CONNECTED),d(),a.removeEventListener("iceconnectionstatechange",f),a.addEventListener("iceconnectionstatechange",g))}.bind(this),g=function b(c){c=c.target;c=c.iceConnectionState;c==="closed"&&(p("P2P collab stats %o","stop"),e(),a.removeEventListener("iceconnectionstatechange",b))};a.addEventListener("iceconnectionstatechange",f)}.bind(this))};m.prototype.$29=function(event,a){n(function(b){return b.log(event,{peerID:this.$1,callID:this.$2,eventDetails:a})}.bind(this))};m.prototype.destroy=function(){p("P2P %o","destroy()"),this.$27.clear(),b("FBRTCMessageListener").removeMessageHandler(),(this.$11.onMessageSent=null,this.$11.onSendFailure=null)};m.prototype.generateEscalationRequestToken=function(a){return this.$28.generateRequestToken(a)};m.prototype.generateEscalationResponseToken=function(a,b){return this.$28.generateResponseToken(a,b)};m.getDefaultVideoQuality=function(){if(b("FBRTCConfig").isVCEndpointCall()||b("FBRTCConfig").useHDVideoQuality())return j.HD_VIDEO;var a=b("FBRTCExperiment").gen("rtc_www_p2p_video_quality");a=a.getBool("use_mw_constraints",!1);return b("CurrentUser").isWorkUser()||a?j.SD_VIDEO:j.LQ_VIDEO};m.prototype.initV2CallSummary=function(a){a.setClientVersion("2.0"),a.setActiveConnection("p2p")};m.showRedialButton=function(){var a=b("RTCP2PCallStore").getState();a=a.endCallReason;var c=b("RTCCallStore").getState();c=c.callSummary;return a!=null&&(a.getReasonID()===h.IGNORE_CALL||a.getReasonID()===h.NO_ANSWER_TIMEOUT)||c.getCallDuration()<=l};function n(a){if(!b("FBRTCConfig").isVCEndpointCall())return;b("Bootloader").loadModules(["CollabMessengerLogger"],a,"RTCP2PProtocolHandler")}function o(a){a instanceof Object||g(0);return a}function p(){}function q(){}function r(a){var c=b("RTCCallStore").getState();c=c.callSummary;a(c);c.save(b("FBRTCCallSummaryStore").getInstance())}e.exports=m}),null);
__d("FBRTCGroupCallIncomingController",["invariant","BonfireFeatureGating","BonfireNotificationUtils","FBRTCCallBlockingStore","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCCallUIWrapper","FBRTCCapability","FBRTCConstants","FBRTCDeviceStatus","FBRTCHangupReason","FBRTCLogger","FBRTCMultiwayMessage","FBRTCRingType","FBRTCRtcResponseStatusCode","FBRTCSupport","FBRTCTransactions","FBRTCUnsupportedBrowserMessage","MessengerRTCUnsupportedBrowserDialogController","RTCMWProtocolHandler","RTCUtils","nullthrows","promiseDone","randomInt"],(function(a,b,c,d,e,f,g){__p&&__p();var h,i=b("FBRTCConstants").CallEndReason;c=b("FBRTCTransactions").FBRTCTransactionOwner;d=babelHelpers.inherits(a,c);h=d&&d.prototype;function a(a,c){"use strict";h.constructor.call(this),this.$FBRTCGroupCallIncomingController5=function(a){b("FBRTCCallUIWrapper").openGroupCallURI(a.conferenceName,a.callID,a.hasVideo,a.multiwayCoreTier,a.multiwayWwwTier,a.serverInfoData,"answer button",this.$FBRTCGroupCallIncomingController1)}.bind(this),this.$FBRTCGroupCallIncomingController2=c,this.$FBRTCGroupCallIncomingController3=a,this.$FBRTCGroupCallIncomingController4=null}a.prototype.$FBRTCGroupCallIncomingController6=function(a){"use strict";this.$FBRTCGroupCallIncomingController1=new(b("FBRTCCallSummary"))({peerID:"MW_PEER_ID",callID:a,isCaller:!1}),this.$FBRTCGroupCallIncomingController1.setCallType("mws"),this.$FBRTCGroupCallIncomingController1.setActiveConnection("mws"),this.$FBRTCGroupCallIncomingController1.setRingRequestReceived()};a.prototype.$FBRTCGroupCallIncomingController7=function(a,c){"use strict";__p&&__p();this.$FBRTCGroupCallIncomingController1.onCallEnded(i.UNSUPPORTED_VERSION,!1);this.$FBRTCGroupCallIncomingController1.save(b("FBRTCCallSummaryStore").getInstance());if(this.$FBRTCGroupCallIncomingController2){var d=a.otherParticipants,e=a.caller,f=c+b("randomInt")(0,4294967295).toString();b("FBRTCUnsupportedBrowserMessage").showForIncomingGroupCall(c,d,e,f)}else{c=a.ringType;b("MessengerRTCUnsupportedBrowserDialogController").render({hasVideo:c===b("FBRTCRingType").GROUP_VIDEO_CALL||c===b("FBRTCRingType").PEER_VIDEO_CALL,isGroupCall:!0})}};a.prototype.$FBRTCGroupCallIncomingController8=function(){"use strict";this.$FBRTCGroupCallIncomingController1.onCallEnded(i.IGNORE_CALL,!1,!1,"calling disabled"),this.$FBRTCGroupCallIncomingController1.save(b("FBRTCCallSummaryStore").getInstance())};a.prototype.$FBRTCGroupCallIncomingController9=function(a,c){"use strict";__p&&__p();var d=b("nullthrows")(c.ringRequest()),e=b("nullthrows")(c.serverInfoData()),f=this.getParticipantsFromRingRequest(d,c.conferenceName(),a),g=f.caller;f=f.usersToRing;d=d.ringType===b("FBRTCRingType").GROUP_VIDEO_CALL||d.ringType===b("FBRTCRingType").PEER_VIDEO_CALL;g=new this.$FBRTCGroupCallIncomingController3(c.conferenceName(),a,g,f,d,e);this.$FBRTCGroupCallIncomingController10(g,a,e,d,c);this.$FBRTCGroupCallIncomingController11(g,c,e);this.$FBRTCGroupCallIncomingController12(g,c,e);this.$FBRTCGroupCallIncomingController4=g;return this.$FBRTCGroupCallIncomingController4};a.prototype.$FBRTCGroupCallIncomingController10=function(a,c,d,e,f){"use strict";__p&&__p();a.addListener("answerCall",function(a,g){__p&&__p();var h;this.$FBRTCGroupCallIncomingController1.onPressedAnswer();this.$FBRTCGroupCallIncomingController1.save(b("FBRTCCallSummaryStore").getInstance());j("MW answered ConferenceName: %o , URI: %o",f.conferenceName(),g);g=f.header().extensions;h=(h=g)!=null?h.multiwayWwwTier:h;g=(g=g)!=null?g.multiwayCoreTier:g;h=h?h:"";g=g?g:"";this.$FBRTCGroupCallIncomingController5({conferenceName:a,callID:c,hasVideo:e,multiwayCoreTier:g,multiwayWwwTier:h,serverInfoData:d})}.bind(this))};a.prototype.$FBRTCGroupCallIncomingController11=function(a,c,d){"use strict";a.addListener("ignoreCall",function(){b("RTCMWProtocolHandler").endCall(c.conferenceName(),d,b("FBRTCHangupReason").IGNORE_CALL),this.$FBRTCGroupCallIncomingController1.onCallEnded(i.IGNORE_CALL,!1),this.$FBRTCGroupCallIncomingController1.save(b("FBRTCCallSummaryStore").getInstance()),this.cancelIncomingCallDialog()}.bind(this))};a.prototype.$FBRTCGroupCallIncomingController12=function(a,c,d){"use strict";a.addListener("timeout",function(){b("RTCMWProtocolHandler").endCall(c.conferenceName(),d,b("FBRTCHangupReason").NO_ANSWER_TIMEOUT),this.$FBRTCGroupCallIncomingController1.onCallEnded(i.NO_ANSWER_TIMEOUT,!1),this.$FBRTCGroupCallIncomingController1.save(b("FBRTCCallSummaryStore").getInstance()),this.cancelIncomingCallDialog()}.bind(this))};a.prototype.onBonfireMessageReceived=function(a){"use strict";b("BonfireNotificationUtils").sendRingAck(a);a=b("BonfireNotificationUtils").toFBRTCMessage(a);a&&this.onMessageReceived(a)};a.prototype.onMessageReceived=function(a){"use strict";__p&&__p();a=new(b("FBRTCMultiwayMessage"))(a);var c=this.getTransaction(a);b("promiseDone")(c.start().then(function(a){if(a!=null)if(a.ringRequest()!=null){var d=b("RTCUtils").generateRandomInt();d=this.handleRingRequest(a,d);d&&b("promiseDone")(c.sendResponse(d),function(){this.$FBRTCGroupCallIncomingController1.setRingResponseSent()}.bind(this))}else a.dismissRequest()!=null?(j("MW msg.get type:%o conferenceName:%o %o",a.type(),a.conferenceName(),a.dismissRequest()),c.sendResponse(this.handleDismissRequest(a))):j("MW Incoming controller only handle ring and dismiss, dropping other message",a)}.bind(this),function(a){}))};a.prototype.setCustomAnswerHandler=function(a){"use strict";this.$FBRTCGroupCallIncomingController5=a};a.prototype.cancelIncomingCallDialog=function(){"use strict";this.$FBRTCGroupCallIncomingController4&&(this.$FBRTCGroupCallIncomingController4.cancel(),this.$FBRTCGroupCallIncomingController4=null)};a.prototype.handleDismissRequest=function(a){"use strict";b("MessengerRTCUnsupportedBrowserDialogController").hideDialog();if(this.$FBRTCGroupCallIncomingController4){var c=this.$FBRTCGroupCallIncomingController4.serverInfoData();c==a.serverInfoData()?this.cancelIncomingCallDialog():j("MW Received dismiss with different server info data")}return a.createResponse(b("FBRTCRtcResponseStatusCode").OK,{})};a.prototype.handleRingRequest=function(a,c){"use strict";__p&&__p();var d=b("nullthrows")(a.ringRequest());d!==null||g(0);j("MW msg.get type:%o conferenceName:%o %o",a.type(),a.conferenceName(),a.ringRequest());if(!b("BonfireFeatureGating").canReceiveBonfireRingInterop()&&b("RTCUtils").isBonfireCall(a.conferenceName()))return null;this.$FBRTCGroupCallIncomingController6(c);if(b("FBRTCCallBlockingStore").getBlockingStatus()){this.$FBRTCGroupCallIncomingController8();return null}if(!b("FBRTCSupport").isGroupCallWebtrcSupported()){this.$FBRTCGroupCallIncomingController7(d,c);return null}if(a.serverInfoData()==null)return a.createResponse(b("FBRTCRtcResponseStatusCode").BAD_REQUEST,{callID:c.toString()});d=this.$FBRTCGroupCallIncomingController9(c,a);d.showIncomingDialog();d={deviceCapabilities:[b("FBRTCCapability").SUPPORT_AUDIO_DEPRECATED,b("FBRTCCapability").SUPPORT_VIDEO_DEPRECATED],deviceStatus:b("FBRTCDeviceStatus").OK};return a.createResponse(b("FBRTCRtcResponseStatusCode").OK,{body:{ringResponse:d},callID:c.toString()})};a.prototype.getParticipantsFromRingRequest=function(a,c,d){"use strict";__p&&__p();var e=a.caller,f=a.otherParticipants,g=a.appMessages;b("RTCUtils").isAlohaCall(c)&&g&&g.forEach(function(c){__p&&__p();var g;g=(g=c)!=null?(g=g.body)!=null?(g=g.genericMessage)!=null?g.topic:g:g:g;c=(c=c)!=null?(c=c.body)!=null?(c=c.genericMessage)!=null?c.data:c:c:c;if(g==="aloha_proxying_as_users"&&c){g=a.caller;c=JSON.parse(atob(c));var h=[];c[g].forEach(function(a){h.push(a.id.toString())});h.length>0?(e=h.shift(),f=h):b("FBRTCLogger").getInstance().logError(null,d,{err:"Failed to initialize aloha participants",alohaUsers:c})}});return{caller:e,usersToRing:f}};function j(){}e.exports=a}),null);
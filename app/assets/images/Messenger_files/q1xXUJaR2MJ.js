if (self.CavalryLogger) { CavalryLogger.start_js(["19XS+"]); }

__d("MqttChannel",["MqttConnection","MqttLogger","uuid"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.$1="",this.$2=[],this.$3="Disconnected",this.$4=new Map(),this.$8=b("MqttLogger").getInstance(),this.$7=new(b("MqttConnection"))(),this.$5=b("uuid")(),this.$6=new Set()}a.prototype.run=function(a){__p&&__p();var b=a.endpoint,c=a.userFbid,d=a.appId;a=a.subscribedTopics;if(this.$7.isRunning()){this.$9("run","Connection started calling run again");return}this.$8.setAppId(d);this.$1=b;this.$7.run({onStateChange:function(a){this.$10(a)}.bind(this),onError:function(a){this.$8.debugTrace("connection","Error "+a)}.bind(this),onJSError:function(a){this.$11(a)}.bind(this),onMessageReceived:function(a,b){this.$12(a,b)}.bind(this),deviceId:this.$5,endpoint:b,userFbid:c,appId:d,subscribedTopics:a})};a.prototype.shutdown=function(){this.$7&&this.$7.shutdown()};a.prototype.publish=function(a,b){this.$7.publish(a,b,1)};a.prototype.subscribe=function(a,b){var c=this.$7.subscribe(a);c||this.$6.add(a);c=this.$4.get(a);!c?(c=[b],this.$4.set(a,c)):c.push(b)};a.prototype.subscribeChannelEvents=function(a){this.$2.push(a)};a.prototype.getDeviceId=function(){return this.$5};a.prototype.getConnectionState=function(){return this.$3};a.prototype.testOnlyResetState=function(){this.$1="",this.$2=[],this.$3="Disconnected",this.$4=new Map(),this.$8=b("MqttLogger").getInstance(),this.$7=new(b("MqttConnection"))(),this.$5=b("uuid")(),this.$6=new Set()};a.prototype.$12=function(a,b){__p&&__p();var c=this.$4.get(a);if(!c)this.$8.debugTrace("_onMessageReceived",a+" being dropped, no listeners");else for(var a=c,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e(b)}};a.prototype.$11=function(a){__p&&__p();for(var b=this.$2,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;e.onJSError&&e.onJSError(a)}};a.prototype.$10=function(a){this.$3!=="Connected"&&a==="Connected"&&(this.$6.forEach(function(a){return this.$7.subscribe(a)}.bind(this)),this.$6.clear()),this.$3=a,this.$9("_changeState","Connection state = "+a),this.$13(a)};a.prototype.$13=function(a){__p&&__p();for(var b=this.$2,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;e.onMQTTStateChanged(a)}};a.prototype.$9=function(event,a){this.$8.debugTrace(event,"Mqtt channel: "+a)};c=new a();e.exports=c}),null);
if (self.CavalryLogger) { CavalryLogger.start_js(["Q59Dg"]); }

__d("ChatPerfTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("logger:ChatPerfLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("logger:ChatPerfLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:ChatPerfLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setDuration=function(a){this.$1.duration=a;return this};a.prototype.setEndpoint=function(a){this.$1.endpoint=a;return this};a.prototype.setEvent=function(a){this.$1.event=a;return this};a.prototype.setTabsOpen=function(a){this.$1.tabs_open=a;return this};c={duration:!0,endpoint:!0,event:!0,tabs_open:!0};e.exports=a}),null);
__d("ChatAppActionTypes",["keyMirror"],(function(a,b,c,d,e,f){"use strict";e.exports=b("keyMirror")({INITIAL_DISPLAY_DONE:null,HIDE:null,LOAD:null,TTI:null,UNHIDE:null})}),null);
__d("ChatAppActions",["ChatAppActionTypes","ChatDispatcher"],(function(a,b,c,d,e,f){"use strict";a={tti:function(){b("ChatDispatcher").dispatch({type:b("ChatAppActionTypes").TTI})},hide:function(){b("ChatDispatcher").dispatch({type:b("ChatAppActionTypes").HIDE})},unhide:function(){b("ChatDispatcher").dispatch({type:b("ChatAppActionTypes").UNHIDE})},setInitialDisplayDone:function(){b("ChatDispatcher").dispatch({type:b("ChatAppActionTypes").INITIAL_DISPLAY_DONE})},load:function(){b("ChatDispatcher").dispatch({type:b("ChatAppActionTypes").LOAD})}};e.exports=a}),null);
__d("ChatAppStore",["ChatAppActionTypes","ChatDispatcher","FluxStore"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=babelHelpers.inherits(a,b("FluxStore"));g=c&&c.prototype;function a(){g.constructor.call(this,b("ChatDispatcher")),this.$ChatAppStore2={initialDisplayDone:!1,isHidden:!1,isInitialized:!1,isLoaded:!1},this.$ChatAppStore1=babelHelpers["extends"]({},this.$ChatAppStore2)}a.prototype.__onDispatch=function(a){__p&&__p();a=a.type;this.$ChatAppStore1=babelHelpers["extends"]({},this.$ChatAppStore2);switch(a){case b("ChatAppActionTypes").INITIAL_DISPLAY_DONE:this.$ChatAppStore2.initialDisplayDone=!0;this.__emitChange();break;case b("ChatAppActionTypes").HIDE:this.$ChatAppStore2.isHidden=!0;this.__emitChange();break;case b("ChatAppActionTypes").UNHIDE:this.$ChatAppStore2.isHidden=!1;this.__emitChange();break;case b("ChatAppActionTypes").TTI:this.$ChatAppStore2.isInitialized=this.$ChatAppStore2.isLoaded=!0;this.__emitChange();break;case b("ChatAppActionTypes").LOAD:this.$ChatAppStore2.isLoaded=!0;this.__emitChange();break}};a.prototype.getPreviousState=function(){return this.$ChatAppStore1};a.prototype.getState=function(){return this.$ChatAppStore2};a.__moduleID=e.id;e.exports=new a()}),null);
__d("ChatPerfInstrumentation",["Promise","BaseEventEmitter","ChatPerfEvent","ChatPerfTypedLogger","FantaConst","PresenceState","WorkModeConfig","emptyFunction","performanceAbsoluteNow"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=b("WorkModeConfig").is_work_user;c=a?b("FantaConst").cookieIDs.WORK_COOKIE_ID:b("FantaConst").cookieIDs.PERSONAL_COOKIE_ID;d=b("PresenceState").getInitial();var g=d&&d[c]?d[c].length:0,h;f={_startTime:Number,_sidebarStartTime:Number,init:function(){this._startTime=b("performanceAbsoluteNow")();return new(b("Promise"))(function(a){return a()})},initDivebar:function(){this._sidebarStartTime=b("performanceAbsoluteNow")()},_log:function(event,a){a=b("performanceAbsoluteNow")()-(a||this._startTime);h&&h.emit(event,a);var c=new(b("ChatPerfTypedLogger"))();c.setEvent(event).setDuration(a);c.setTabsOpen(g);c.log()},addPerfTimingsListener:function(event,a){h||(h=new(b("BaseEventEmitter"))());return h.once(event,a)},logInitStores:function(){this.logInitStores=b("emptyFunction"),this._log(b("ChatPerfEvent").CHAT_INIT_STORES)},logInitData:function(){this.logInitData=b("emptyFunction"),this._log(b("ChatPerfEvent").CHAT_INIT_DATA)},logInitUI:function(){this.logInitUI=b("emptyFunction"),this._log(b("ChatPerfEvent").CHAT_INIT_UI)},logInitSound:function(){this.logInitSound=b("emptyFunction"),this._log(b("ChatPerfEvent").CHAT_INIT_SOUND)},logDisplayDone:function(){this.logDisplayDone=b("emptyFunction"),this._log(b("ChatPerfEvent").CHAT_DISPLAY_DONE)},logTTI:function(){this.logTTI=b("emptyFunction"),this._log(b("ChatPerfEvent").TTI)},logCHAT_CONVERSATION_TTI:function(){this.logCHAT_CONVERSATION_TTI=b("emptyFunction"),this._log(b("ChatPerfEvent").CHAT_CONVERSATION_TTI)},logSIDEBAR_FROM_CLIENT_TTI:function(){this.logSIDEBAR_FROM_CLIENT_TTI=b("emptyFunction"),this._log(b("ChatPerfEvent").SIDEBAR_FROM_CLIENT_TTI,this._sidebarStartTime)},logSIDEBAR_DISPLAY_DONE:function(){this.logSIDEBAR_DISPLAY_DONE=b("emptyFunction"),this._log(b("ChatPerfEvent").SIDEBAR_DISPLAY_DONE,this._sidebarStartTime)}};e.exports=f}),null);
__d("getTitleHrefFromThreadID",["MercuryIDs","MessengerParticipants.bs","WebMessengerThreadPermalinks"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c){if(b("MercuryIDs").isLocalThread(a)){c();return}var d=b("MercuryIDs").getUserIDFromThreadID(a);d?b("MessengerParticipants.bs").get(b("MercuryIDs").getParticipantIDFromUserID(d),function(a){a.href?c(a.href):c(b("WebMessengerThreadPermalinks").getThreadURIFromUserID(d))}):b("WebMessengerThreadPermalinks").getThreadURI(a,c)}e.exports={getTitleHrefFromThreadID:a}}),null);
__d("FantaMercuryThreadEventsBootloaded",["Bootloader","CurrentUser","MercuryThreadInformer","MercuryViewer","MessengerState.bs","WorkplaceChatHelper"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MercuryThreadInformer").get();a={onMessagesReceived:function(a){__p&&__p();g.subscribe("messages-received",function(c,d){__p&&__p();if(!b("WorkplaceChatHelper").suppressChatIfActiveOnDesktop()){c=function(c){__p&&__p();var e=d[c],f=function(d){var f=e[d];if(f.author!=b("MercuryViewer").getID()){if(!f.is_unread)return"continue";b("MessengerState.bs").getThreadMeta(b("CurrentUser").getID(),c,function(d){b("Bootloader").loadModules(["ChatTabPolicy"],function(b){b.messageIsAllowed(d,f,function(){a(c,f)})},"FantaMercuryThreadEventsBootloaded")})}};for(var g=0;g<e.length;g++){var h=f(g);if(h==="continue")continue}};for(var e in d)c(e)}})}};e.exports=a}),null);
__d("FantaReducersParticipants",["FantaGetMessageActions","ImmutableObject","MercuryIDs","MessengerParticipants.bs","setImmediate"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FantaGetMessageActions").Types;function a(a,b){switch(b.type){case g.ON_GET_THREAD_RESPONSE:b=b.thread;a=h(a,b);break}return a}function h(a,c){var d=c.thread_id,e=a.mercury.tabContents.get(d);if(!e)return a;e=i(c).concat(j(c));b("MessengerParticipants.bs").getMulti(e,function(a){b("setImmediate")(function(){return b("FantaGetMessageActions").onParticipantResponse(d)})});return k(a,c)}function i(a){return a&&a.participants?a.participants.filter(function(a){return!b("MessengerParticipants.bs").getNow(a)}):[]}function j(a){return a&&a.group_approval_queue?a.group_approval_queue.reduce(function(a,c){var d=c.requester;c=c.inviter;return a.concat([b("MercuryIDs").getParticipantIDFromUserID(d.id),b("MercuryIDs").getParticipantIDFromUserID(c.id)])},[]):[]}function c(a,b){__p&&__p();switch(b.type){case g.ON_GET_PARTICIPANT_RESPONSE:b=b.tabID;b=a.mercury.tabContents.get(b);if(!b)return a;b=b.thread;if(!b)return a;a=k(a,b)}return a}function k(a,c){__p&&__p();var d=c.thread_id,e=a.mercury.tabContents.get(d);if(!e)return a;var f=c.participants?c.participants.map(function(a){return b("MessengerParticipants.bs").getNow(a)}).filter(function(a){return!!a}).reduce(function(a,b){a[b.id]=b;return a},{}):null;c=c.group_approval_queue?c.group_approval_queue.reduce(function(a,c){var d=c.requester;c=c.inviter;d=b("MessengerParticipants.bs").getNow(b("MercuryIDs").getParticipantIDFromUserID(d.id));d&&(a[d.id]=d);d=b("MessengerParticipants.bs").getNow(b("MercuryIDs").getParticipantIDFromUserID(c.id));d&&(a[d.id]=d);return a},{}):null;e=e.merge({membershipParticipants:c,participants:f});a=a.setIn(["mercury","tabContents",d],e);return a}function d(a,c){switch(c.type){case g.THREADS_UPDATED:c.threads.forEach(function(c){a=h(a,new(b("ImmutableObject"))(c))})}return a}e.exports={onGetThreadResponse_Participants:a,threadsUpdated_Participants:d,onParticipantResponse_Participants:c}}),null);
__d("FantaReducersGetMessages",["AsyncRequest","CurrentUser","FantaGetMessageActions","FantaReducersParticipants","FantaTabActions","FantaTypeJoinableThread","ImmutableObject","MercuryIDs","MercuryLogMessageType","MercuryMessageStore","immutable","MercuryThreadActions","MessengerState.bs","TimeSlice","UserActivity","XMNCommercePageNullStateCTAController","getPageIDFromThreadID","setImmediate","getTitleHrefFromThreadID"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MercuryThreadActions").get(),h=b("FantaTabActions").Types,i=b("FantaGetMessageActions").Types,j=b("getTitleHrefFromThreadID").getTitleHrefFromThreadID,k={},l={};function a(a,b){switch(b.type){case h.OPEN_TAB:case i.CLEAR_PARTICIPANTS:a=t(a,b.tabID);break}return a}function c(a,b){switch(b.type){case h.OPEN_TAB_WITH_INTERSTITIAL_DATA:a=u(a,b.interstitialData);break}return a}function d(a,b){switch(b.type){case h.REPLACE_TAB:a=t(a,b.newTabID);break}return a}function f(a,c){__p&&__p();switch(c.type){case i.CLEAR_PREVIEW:var d=c.tabID;c=c.tokens;var e=a.mercury.tabContents.get(d);if(!e)return a;c=c.map(function(a){a=a.info.uid;return b("MercuryIDs").isValid(a)?a:b("MercuryIDs").getParticipantIDFromUserID(a)});e.messageStore&&e.messageStore.destroy();e=e.merge({messages:b("immutable").List(),hasFetchedAll:!1,messageStore:null,threadPreviewID:null,threadPreviewRecipients:b("immutable").List(c)});a=a.setIn(["mercury","tabContents",d],e);b("MessengerState.bs").getThreadMeta(b("CurrentUser").getID(),d,function(a){b("setImmediate")(function(){return b("FantaGetMessageActions").onGetThreadPreviewResponse(d,a)})});break}return a}function m(a,b){switch(b.type){case i.ADD_PARTICIPANTS:a=p(a,b.tabID,b.previewTabID);break}return a}function n(a,c){__p&&__p();switch(c.type){case h.LOAD_FROM_DATA:var d=a.tabGroup;c=c.tabData;var e=c.interstitialData;if(d.updatedTime>=c.updatedTime||c.updatedTime===undefined){for(var d=a.tabGroup.tabs.keys(),c=Array.isArray(d),f=0,d=c?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(c){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;var i=a.mercury.tabContents.get(g).messageStore;if(!i){i=b("MercuryIDs").getThreadFBIDFromThreadID(g);e&&e[i]?(e[i].threadID=g,a=u(a,e[i])):a=t(a,g)}}return a}else for(var i=a.tabGroup.tabs.keys(),g=Array.isArray(i),f=0,i=g?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(f>=i.length)break;c=i[f++]}else{f=i.next();if(f.done)break;c=f.value}d=c;c=b("MercuryIDs").getThreadFBIDFromThreadID(d);e&&e[c]?(e[c].threadID=d,a=u(a,e[c])):a=t(a,d)}break}return a}function o(a,b){switch(b.type){case i.FETCH_MORE_MESSAGES:b=b.threadID;var c=a.mercury.tabContents.get(b).messageStore;c&&!l[b]&&(l[b]=!0,c.fetchMoreMessages());break}return a}function p(a,c,d){b("MessengerState.bs").getThreadMeta(b("CurrentUser").getID(),d,function(a){b("setImmediate")(function(){b("FantaGetMessageActions").onGetThreadPreviewResponse(c,a)})});return a}function q(a,b){switch(b.type){case i.ON_GET_THREAD_PREVIEW_RESPONSE:var c=b.tabID;b=b.thread;return r(a,c,b)}return a}function r(a,c,d){__p&&__p();var e=d.thread_id,f=new(b("MercuryMessageStore"))(e),g=a.mercury.tabContents.get(c);if(l[e]||!g)return a;l[e]=!0;g&&g.messageStore&&g.messageStore.destroy();g=g.merge({thread:d,messageStore:f});a=a.setIn(["mercury","tabContents",c],g);var h=setTimeout(function(){l[e]=!1,b("FantaGetMessageActions").onShowContextBannerTimer(c)},6e3);f.subscribe(function(a){l[e]=!1;var d=a.messages&&a.messages[0];d&&d.log_message_type&&d.log_message_type===b("MercuryLogMessageType").SERVER_ERROR&&g.messages.size===0?f.fetchMoreMessages():(clearTimeout(h),b("setImmediate")(function(){b("FantaGetMessageActions").onMessageStoreResponse(a.messages,c)}))});return a}function s(a,b){switch(b.type){case i.REFRESH_THREAD:return t(a,b.threadID)}return a}function t(a,c){__p&&__p();if(!k[c]){var d=b("getPageIDFromThreadID")(c);if(d){var e=b("XMNCommercePageNullStateCTAController").getURIBuilder();new(b("AsyncRequest"))().setURI(e.getURI()).setMethod("POST").setData({page_id:d}).setHandler(function(a){a&&a.payload&&b("FantaGetMessageActions").onPageNullResponse(c,a.payload)}).send()}k[c]=!0;b("MessengerState.bs").getThreadMeta(b("CurrentUser").getID(),c,function(a){b("setImmediate")(function(){return b("FantaGetMessageActions").onGetThreadResponse(a)})})}return a}function u(a,c){var d=new(b("FantaTypeJoinableThread"))(c);c=c.threadID;var e=c&&a.mercury.tabContents.get(c);e&&(e=e.merge({joinableInterstitialData:d}),a=a.setIn(["mercury","tabContents",c],e));return a}function v(a,c){switch(c.type){case i.ON_PAGE_NULL_RESPONSE:var d=c.threadID;c=c.nullStateCTA;var e=a.mercury.tabContents.get(d);e&&(e=e.merge({nullStateCTA:new(b("ImmutableObject"))(c)}),a=a.setIn(["mercury","tabContents",d],e));break}return a}function w(a,b){switch(b.type){case i.ON_GET_THREAD_RESPONSE:b=b.thread;a=x(a,b);break}return a}function x(a,c){__p&&__p();var d=c.thread_id;k[d]=!1;var e=a.mercury.tabContents.get(d);if(!e)return a;var f=e.messageStore;e=e.merge({highlightNewMessage:c.unread_count>0});a=a.setIn(["mercury","tabContents",d],e);!f?a=r(a,d,c):(e=e.merge({thread:c}),a=a.setIn(["mercury","tabContents",d],e));j(d,function(a){return b("setImmediate")(function(){return b("FantaGetMessageActions").onGetThreadHrefResponse(d,a)})});return a}function y(a,b){switch(b.type){case i.ON_GET_THREAD_HREF_RESPONSE:var c=b.tabID,d=a.mercury.tabContents.get(c);if(!d)return a;d=d.merge({threadHref:b.href});a=a.setIn(["mercury","tabContents",c],d)}return a}function z(a,c){switch(c.type){case i.THREADS_UPDATED:c.threads.forEach(function(c){a=x(a,new(b("ImmutableObject"))(c))})}return a}function A(a,c){__p&&__p();switch(c.type){case i.ON_MESSAGE_STORE_RESPONSE:var d=c.messages;c=c.tabID;var e=a.mercury.tabContents.get(c),f=e&&e.messageStore;if(f){f=f.hasFetchedAll();e=e.merge({hasFetchedAll:f,messages:b("immutable").List(d)});a=a.setIn(["mercury","tabContents",c],e)}break}return a}function B(a,b){switch(b.type){case i.ON_SHOW_CONTEXT_BANNER_TIMER:var c=a.mercury.tabContents.get(b.threadID);if(!c)return a;c=c.merge({showContextBanner:!0});a=a.setIn(["mercury","tabContents",b.threadID],c);break}return a}function C(a,c){__p&&__p();switch(c.type){case h.CLOSE_AND_TAB_NEXT:case h.FOCUS_NEXT_TAB:case h.FOCUS_PREVIOUS_TAB:case h.FOCUS_TAB:case h.SCROLL_BOTTOM_CHANGED:case h.UNMINIMIZE_TAB:case i.ON_GET_THREAD_RESPONSE:case i.ON_MESSAGE_STORE_RESPONSE:case i.REFRESH_THREAD:case i.THREADS_UPDATED:c=a.tabGroup.focusedTabID;if(c){var d=a.tabGroup.tabs.get(c);if(d&&!d.isMinimized&&b("UserActivity").isOnTab()&&b("UserActivity").isActive()){d=a.mercury.tabContents.get(c);var e=d.thread;d&&d.isScrolledToBottom&&e&&e.unread_count>0&&D(c)}}break}return a}function D(a){var c=function(){g.markSeen(a),g.markRead(a)};b("TimeSlice").guard(c,"superfluous request to first open DD",{propagationType:b("TimeSlice").PropagationType.ORPHAN})()}e.exports=babelHelpers["extends"]({addParticipants:m,clearPreview:f,fetchMoreMessages:o,loadFromData:n,onFocusChange:C,onGetThreadHrefResponse:y,onGetThreadPreviewResponse:q,onGetThreadResponse:w,onMessageStoreResponse:A,onPageNullResponse:v,onShowContextBannerTimer:B,openInterstitialTab:c,openTab:a,refreshThread:s,replaceTab:d,threadsUpdated:z},b("FantaReducersParticipants"))}),null);
__d("FantaTabViewportManager",["Arbiter","DockTabsViewportCalculator","DockTabsViewportFantaTabUtils","FantaTabActions","ifRequired","immutable","isWebMessengerURI","setImmediate"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){__p&&__p();var c=b("DockTabsViewportCalculator").getInstance(a);if(!c)return;c.registerFantaTabCallbacks({fantaTabModelStateGetter:function(){var a=b("immutable").Map({});b("ifRequired")("FantaAppStore",function(b){a=b.getState().tabGroup.tabs});return a},onAvailableWidthChanged:function(a){b("setImmediate")(function(){b("FantaTabActions").setAllowedRaisedTabs(b("DockTabsViewportFantaTabUtils").getTabCountToFitWidth(a))})}});b("Arbiter").subscribe("FantaReducersDockCalculator/shouldRecalculate",function(){c.forceRecalculateChatTabs()});c.forceRecalculateFBDockWidth();b("Arbiter").subscribe("page_transition",function(a,c){b("isWebMessengerURI")(c.uri)&&b("setImmediate")(function(){return b("FantaTabActions").minimizeAllTabs()})})}e.exports={init:a}}),null);
__d("MercuryDeliveryState",["MercuryConfig","MercuryIDs","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap","MercuryThreadInformer","UserActivity","debounceAcrossTransitions","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MercuryConfig").delivery_timeout||12e4;a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};function a(a){this.$8=function(){if(this.$5.length===0&&Object.keys(this.$6).length===0)return;var a=this.$5.map(function(a){return a.message_id});a&&this.$2.sendDeliveryReceipts(a,this.$6);this.$6={};this.$5=[]}.bind(this),this.$1=a,this.$2=b("MercuryServerRequests").getForFBID(this.$1),this.$3=b("MercuryThreadInformer").getForFBID(this.$1),this.$4=b("MercuryThreadIDMap").getForFBID(this.$1),this.$5=[],this.$6={},this.$3.subscribe("messages-received",this.$7.bind(this)),b("UserActivity").subscribe(b("debounceAcrossTransitions")(this.$8,300,this))}a.prototype.$7=function(a,c){for(var d in c){a=c[d];a.forEach(function(a){this.$9(a)&&(this.$5.push(a),this.$4.getServerIDFromClientID(d,function(b){this.$6[b]||(this.$6[b]=[]),this.$6[b].push(a.message_id)}.bind(this)))}.bind(this))}(b("UserActivity").isActive(g)||b("gkx")("AT6QldQ637XMvCyugHEhjQqDDf2-wtP50HTiWZ1Ww9U3TKMTy-LCSwNJff4SK8McDFogXyIPPHKCxhkz9mFRLCX-m6fUBuF8qkM5EElKo4EzDw"))&&this.$8()};a.prototype.$9=function(a){var c=a.author?b("MercuryIDs").getUserIDFromParticipantID(a.author):null;if(c===this.$1)return!1;return!a.is_unread?!1:!0};var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncEnvironment",["Arbiter","ChannelInitialData","CurrentUser","MercurySyncDeltaHandler","MessengerMQTTGating"],(function(a,b,c,d,e,f){"use strict";function a(){if(!b("ChannelInitialData").channelConfig&&!b("MessengerMQTTGating").isEnabled())return;b("MercurySyncDeltaHandler").get();b("Arbiter").inform("MercurySyncDeltaHandler/initSeqID",{fbid:b("CurrentUser").getAccountID(),seqID:b("ChannelInitialData").channelConfig?b("ChannelInitialData").channelConfig.sequenceId:0})}e.exports={setUp:a}}),null);
__d("MercuryUnreadState",["invariant","KeyedCallbackManager","LogHistory","MercuryActionType","MercuryConfig","MercuryDispatcher","MercuryGlobalActionType","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap","MercuryThreadInformer","MercuryThreadlistConstants","MessagingTag","MessengerFolders.bs","MessengerState.bs","createObjectFrom"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=(b("MessengerFolders.bs").getSupportedFolders()||[]).filter(function(a){return a!==b("MessagingTag").ACTION_ARCHIVED}),i="unread_thread_hash",j="unseen_thread_list",k=b("MercuryThreadlistConstants").MAX_UNREAD_COUNT,l=b("LogHistory").getInstance("mercury_unread_state");a.getForFBID=function(a){return m.getForFBID(a)};a.get=function(){return m.get()};function a(a){this.$1=a,this.$2=b("MercuryServerRequests").getForFBID(this.$1),this.$3=b("MercuryThreadIDMap").getForFBID(this.$1),this.$4=b("MercuryThreadInformer").getForFBID(this.$1),this.$5=b("MercuryDispatcher").getForFBID(this.$1),this.$6={},this.$7={},this.$8={},this.$9={},this.$10={},h.forEach(function(a){this.$8[a]=0,this.$9[a]=!1,this.$10[a]=new(b("KeyedCallbackManager"))()}.bind(this)),this.$5.subscribe("update-unread",this.$11.bind(this)),this.$5.subscribe("update-thread-ids",function(a,b){this.$12(b)}.bind(this))}a.prototype.getUnreadCount=function(a){if(this.exceedsMaxCount(a)){l.error("unguarded_unread_count_fetch","{}");return 0}return this.$13(a)};a.prototype.exceedsMaxCount=function(a){return this.$9[a]||this.$13(a)>k};a.prototype.markFolderAsRead=function(a){(this.$9[a]||this.$13(a)>0)&&this.$2.markFolderAsRead(a),b("MercuryConfig").MessengerInboxRequests&&a===b("MessagingTag").INBOX&&this.$13(b("MessagingTag").PENDING)>0&&this.$2.markFolderAsRead(b("MessagingTag").PENDING)};a.prototype.getIsThreadUnread=function(a,c){c=c||b("MessagingTag").INBOX;c=this.$14(c);return!!(c&&c[a])};a.prototype.$15=function(a,b){this.$10[a].setResource(i,b),this.$10[a].setResource(j,Object.keys(b))};a.prototype.$16=function(a,b){b=this.$10[a].executeOrEnqueue(i,b);b=this.$10[a].getUnavailableResources(b);b.length&&this.$2.fetchUnreadThreadIDs(a)};a.prototype.$14=function(a){return this.$10[a].getResource(i)};a.prototype.$13=function(a){var b=this.$10[a].getResource(j);if(b)return b.length;else return this.$8[a]};a.prototype.$11=function(a,c){__p&&__p();var d;(c.unread_thread_fbids||[]).forEach(function(a){d=a.folder;if(!this.$17(d))return;var c=a.thread_fbids||[];c=c.concat(a.other_user_fbids||[]);a=this.$18(c);this.$15(d,b("createObjectFrom")(a,!0));a.length>k&&(this.$9[d]=!0);this.$4.updatedUnreadState()}.bind(this));(c.message_counts||[]).forEach(function(a){if(a.unread_count===undefined)return;d=a.folder;a.unread_count>k?(this.$9[d]=!0,this.$15(d,{}),this.$4.updatedUnreadState()):(this.$8[d]=a.unread_count,this.$8[d]===0&&this.$15(d,{}),this.$4.updatedUnreadState())}.bind(this));(c.global_actions||[]).forEach(function(a){a.action_type===b("MercuryGlobalActionType").MARK_ALL_READ&&this.$19(a.folder,a.timestamp)}.bind(this));(c.actions||[]).forEach(function(a){__p&&__p();var c=b("MercuryActionType"),e=a.other_user_fbid?a.other_user_fbid:a.thread_fbid,f=a.thread_id?a.thread_id:e;if(a.action_type==c.DELETE_THREAD)h.forEach(function(a){this.$20(a,f)}.bind(this));else if(a.action_type==c.CHANGE_ARCHIVED_STATUS||a.action_type==c.CHANGE_FOLDER){e=b("MessengerState.bs").getThreadMetaNow(this.$1,a.thread_id);!e&&g(0);d=b("MessengerFolders.bs").getFromMeta(e);this.$17(d)&&e.unread_count>0&&this.$21(d,f);h.forEach(function(a){a!=d&&this.$20(a,f)}.bind(this))}else{d=this.$22(a);if(!this.$17(d))return;a.action_type==c.CHANGE_READ_STATUS?a.mark_as_read?this.$20(d,f,a.timestamp):this.$21(d,f,a.timestamp):(a.action_type==c.USER_GENERATED_MESSAGE||a.action_type==c.LOG_MESSAGE)&&(a.is_unread&&this.$21(d,f,a.timestamp))}}.bind(this))};a.prototype.$21=function(a,b,c){if(this.$9[a])return;this.$16(a,function(d){var e=this.$6[a]||0,f=this.$7[b]||0,g=c||Number.POSITIVE_INFINITY;g>=e&&g>=f&&!d[b]&&(d[b]=c||0,this.$15(a,d),this.$4.updatedUnreadState())}.bind(this))};a.prototype.$20=function(a,b,c){__p&&__p();if(this.$9[a])return;this.$16(a,function(d){if(c){var e=this.$7[b];(!e||e<c)&&(this.$7[b]=c)}e=d[b];if(c&&typeof e==="number"&&c<e)return;b in d&&(delete d[b],this.$15(a,d),this.$4.updatedUnreadState())}.bind(this))};a.prototype.$19=function(a,b){this.$9[a]=!1,this.$15(a,{}),this.$6[a]=Math.max(this.$6[a]||0,b||0),this.$4.updatedUnreadState()};a.prototype.$18=function(a){return a.map(this.$3.convertThreadIDIfAvailable,this.$3)};a.prototype.$12=function(a){h.forEach(function(b){var c=this.$14(b);if(!c)return;for(var d in a){var e=a[d];c[d]&&(c[e]=c[d],delete c[d])}this.$15(b,c)}.bind(this))};a.prototype.$22=function(a){var c=a.thread_id?b("MessengerState.bs").getThreadMetaNow(this.$1,a.thread_id):null;return c?b("MessengerFolders.bs").getFromMeta(c):a.folder?a.folder:""};a.prototype.$17=function(a){return!!a&&h.includes(a)};var m=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("FantaTabsAppBase",["Bootloader","ChatAppActions","ChatAppStore","ChatPerfInstrumentation","CSS","JSLogger"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a.prototype.init=function(a,c,d){__p&&__p();if(this.isInitialized()){b("JSLogger").create("chat_app").error("repeated_init");return}this.$1=a;this.tabsElem=c;var e=b("ChatAppStore").addListener(function(){var a=b("ChatAppStore").getPreviousState(),c=b("ChatAppStore").getState();a.initialDisplayDone===!1&&c.initialDisplayDone===!0&&(b("ChatPerfInstrumentation").logDisplayDone(),e.remove())});b("ChatPerfInstrumentation").init();this.$2(d);this.initializeFantaData(d.interstitial_data);this.initializeFantaUI();this.$3();b("ChatAppActions").tti();b("ChatPerfInstrumentation").logTTI()};a.prototype.isInitialized=function(){return!!b("ChatAppStore").getState().isInitialized};a.prototype.isHidden=function(){var a=b("ChatAppStore").getState();return!!(!a.isInitialized||a.isHidden)};a.prototype.hide=function(){if(this.isHidden())return;b("CSS").hide(this.$1);b("ChatAppActions").hide()};a.prototype.unhide=function(){var a=b("ChatAppStore").getState();a.isInitialized?a.isHidden&&(b("CSS").show(this.$1),d(["Dock"],function(a){a.resizeAllFlyouts()}),b("ChatAppActions").unhide()):a.isLoaded||(d(["UIPagelet"],function(a){a.loadFromEndpoint("ChatTabsPagelet","ChatTabsPagelet"),a.loadFromEndpoint("BuddylistPagelet","BuddylistPagelet")}),b("ChatAppActions").load())};a.prototype.initializeFantaData=function(a){};a.prototype.initializeFantaUI=function(){};a.prototype.$2=function(a){d(["MercuryDeliveryState","MessengerParticipants.bs","MercuryServerPayloadPreprocessor","MessengerState.bs","MercuryUnreadState","MercuryUnseenState","MercurySyncEnvironment","P2PSendMoneyDialogStore"],function(c,d,e,f,g,h,i,j){c.get(),d,h.get(),g.get(),i.setUp(),b("ChatPerfInstrumentation").logInitStores(),a.graphql_payload?b("Bootloader").loadModules(["ChatInitialDataTransformer.bs"],function(b){var c=a.graphql_payload;b=b.transform(c);b.message_blocked_ids=c.message_blocked_ids;b.message_ignored_ids=c.message_ignored_ids;b.payload_source=c.payload_source;e.get().handleUpdate(b)},"FantaTabsAppBase"):e.get().handleUpdate(a.initial_data)})};a.prototype.$3=function(){d(["HotLikeSound","ChatOptions"],function(a,c){a.setCheckSoundEnabledFunc(function(){return c.getSetting("sound")}),b("ChatPerfInstrumentation").logInitSound()})};function a(){}e.exports=a}),null);
__d("FBRTCCallSummaryUploader",["Banzai","FBRTCCallSummary","FBRTCCallSummaryStore"],(function(a,b,c,d,e,f){a={init:function(){var a=b("FBRTCCallSummaryStore").getInstance();b("Banzai").subscribe(b("Banzai").SEND,function(){b("FBRTCCallSummary").logSavedSummaries(a)})}};e.exports=a}),null);
__d("MessengerRTCMessageHandler",["Bootloader","FBRTCCallSummaryUploader","FBRTCExperiment","FBRTCMessageListener","URI","isFacebookURI"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=null,h=null,i=null;function j(){b("isFacebookURI")(new(b("URI"))(window.top.location.href))&&b("FBRTCExperiment").getIncomingCallExperiments().logExposure()}a={init:function(){b("FBRTCCallSummaryUploader").init(),b("FBRTCMessageListener").init(!1),b("FBRTCMessageListener").once("messageReceived",function(a){k()}),b("FBRTCMessageListener").once("multiwayMessageReceived",function(a){l(a)}),b("FBRTCMessageListener").once("bonfireMessageReceived",function(a){m(a)})}};function k(){g||(j(),b("Bootloader").loadModules(["FBRTCIncomingCallController","MessengerRTCIncomingDialogController","MessengerRTCMissedCallDialogController","FBRTCUnsupportedBrowserMessage"],function(a,c,d,e){g=new a(c,e,d),b("FBRTCMessageListener").setMessageHandler(g.onMessageReceived,g)},"MessengerRTCMessageHandler"))}function l(a){h||(j(),b("Bootloader").loadModules(["FBRTCGroupCallIncomingController","MessengerRTCGroupCallIncomingDialogController"],function(c,d){h=new c(d,!1),b("FBRTCMessageListener").setMultiwayMessageHandler(h.onMessageReceived,h),h.onMessageReceived(a)},"MessengerRTCMessageHandler"))}function m(a){i||(j(),b("Bootloader").loadModules(["FBRTCGroupCallIncomingController","MessengerRTCGroupCallIncomingDialogController"],function(c,d){i=new c(d),b("FBRTCMessageListener").setBonfireMessageHandler(i.onBonfireMessageReceived,i),i.onBonfireMessageReceived(a)},"MessengerRTCMessageHandler"))}e.exports=a}),null);
__d("FBRTCMessageHandler",["Bootloader","FBRTCExperiment","FBRTCMessageListener","MessengerRTCMessageHandler"],(function(a,b,c,d,e,f){__p&&__p();var g=null,h=!1,i=null,j=null,k={init:function(){if(b("FBRTCExperiment").getIncomingCallExperiments().getBool("use_messenger_on_fb",!1)){b("MessengerRTCMessageHandler").init();return}h===!1&&(h=!0,b("FBRTCMessageListener").init(!1),b("FBRTCMessageListener").once("messageReceived",function(a){b("FBRTCExperiment").getIncomingCallExperiments().logExposure(),k.initIncomingCallController()}),b("FBRTCMessageListener").once("multiwayMessageReceived",function(a){l(a)}),b("FBRTCMessageListener").once("bonfireMessageReceived",function(a){m(a)}))},initIncomingCallController:function(){g||b("Bootloader").loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(a,c,d,e){g=new a(c,e,new d()),b("FBRTCMessageListener").setMessageHandler(g.onMessageReceived,g)},"FBRTCMessageHandler")}};function l(a){i||b("Bootloader").loadModules(["FBRTCGroupCallIncomingController","FBRTCGroupCallIncomingDialog"],function(c,d){b("FBRTCExperiment").getIncomingCallExperiments().logExposure(),i=new c(d,!0),b("FBRTCMessageListener").setMultiwayMessageHandler(i.onMessageReceived,i),i.onMessageReceived(a)},"FBRTCMessageHandler")}function m(a){j||b("Bootloader").loadModules(["FBRTCGroupCallIncomingController","FBRTCGroupCallIncomingDialog"],function(c,d){b("FBRTCExperiment").getIncomingCallExperiments().logExposure(),j=new c(d),b("FBRTCMessageListener").setBonfireMessageHandler(j.onBonfireMessageReceived,j),j.onBonfireMessageReceived(a)},"FBRTCMessageHandler")}e.exports=k}),null);
__d("FantaTabsReactApp",["ChatPerfInstrumentation","FantaMercuryTabsWithMain.react","FantaTabsAppBase","React","ReactDOM","UserActivity","gkx","setImmediate"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=500,i;g=babelHelpers.inherits(a,b("FantaTabsAppBase"));g&&g.prototype;a.prototype.initializeFantaData=function(a){__p&&__p();d(["FantaAppStore","FantaCookieUtil","FantaGetMessageActions","FantaTabActions","MercuryThreadInformer","PresenceState"],function(c,d,e,f,g,j){__p&&__p();f.loadFromData(d.convertCookieData(j.get(),null,a)),j.registerStateLoader(function(b){f.loadFromData(d.convertCookieData(b,c.getState().tabGroup,a))}),j.registerStateStorer(function(a){if(!b("UserActivity").isOnTab()&&!b("UserActivity").isActive(h)&&!b("gkx")("AT6nWa67JNvPKaNLOZDdyp4fuiyIepv2XIXuKF5LN83i_b2kMZXQUSDdjTj5i5D9b_AvpyeTkt6VFx72KlG1zydvjEHtSqFDRRgvpLmEHrSbcw"))return a;var e=c.getState().tabGroup;if(!i||i&&!i.equals(e)){i=e;return d.createCookieData(e,a)}else return a}),g.get().subscribe("threads-updated",function(a,c){Object.keys(c).forEach(function(a){b("setImmediate")(function(){e.refreshThread(a)})})}),b("ChatPerfInstrumentation").logInitData()})};a.prototype.initializeFantaUI=function(){__p&&__p();d(["FantaAppStore","FantaMercuryThreadEventsBootloaded","FantaMessageActions","FantaTabActions","FantaTabViewportManager","FBRTCMessageHandler","MercuryBrowserAlerts"],function(a,c,d,e,f,g,h){__p&&__p();g.init();h.init();b("ReactDOM").render(this.getViewComponent(),this.tabsElem);c.onMessagesReceived(function(a,c){b("setImmediate")(function(){d.receivedNewMessage(a,c)})});f.init(this.tabsElem);b("ChatPerfInstrumentation").logInitUI();e=a.getState().tabGroup.tabs;e.toArray().length===0&&b("ChatPerfInstrumentation").logDisplayDone()}.bind(this))};a.prototype.getViewComponent=function(){return b("React").createElement(b("FantaMercuryTabsWithMain.react"),{loadDataOnMount:!1})};function a(){g.apply(this,arguments)}e.exports=new a()}),null);
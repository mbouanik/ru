if (self.CavalryLogger) { CavalryLogger.start_js(["AYale"]); }

__d("FBRTCCallabilityActions",["keyMirror"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("keyMirror")({CALLABILITY_FETCHED:null,CALLABILITY_FETCH_ERROR:null});function a(a){this.$1=a}a.prototype.callabilityFetched=function(a,b){this.$1.dispatch({type:g.CALLABILITY_FETCHED,userID:a,callability:b})};a.prototype.callabilityFetchError=function(a){this.$1.dispatch({type:g.CALLABILITY_FETCH_ERROR,userID:a})};a.Types=g;e.exports=a}),null);
__d("XRTCCallabilityController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/rtc/callability/",{user_id:{type:"FBID",required:!0}})}),null);
__d("FBRTCCallabilityDataManager",["AsyncRequest","FBRTCCallabilityActions","TimeSlice","XRTCCallabilityController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this.$1=new(b("FBRTCCallabilityActions"))(a)}a.prototype.fetchCallability=function(a){b("TimeSlice").guard(function(){var c=b("XRTCCallabilityController").getURIBuilder().setFBID("user_id",a).getURI(),d=this.$2.bind(this,a),e=this.$3.bind(this,a);new(b("AsyncRequest"))().setURI(c).setHandler(d).setErrorHandler(e).setAllowCrossPageTransition(!0).send()}.bind(this),"Chat Tab RTC Callability Check",{propagationType:b("TimeSlice").PropagationType.ORPHAN})()};a.prototype.$2=function(a,b){this.$1.callabilityFetched(a,b.payload)};a.prototype.$3=function(a,b){this.$1.callabilityFetchError(a)};e.exports=a}),null);
__d("RTCCallabilityStore",["fbt","Cache","FBRTCCallabilityActions","FBRTCCallabilityDataManager","FluxStore","MercuryThreadInfo"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=.5,j=5;c=babelHelpers.inherits(a,b("FluxStore"));h=c&&c.prototype;function a(a){h.constructor.call(this,a),this.$RTCCallabilityStore2=new(b("FBRTCCallabilityDataManager"))(a),this.$RTCCallabilityStore1=new(b("Cache"))()}a.prototype.__onDispatch=function(a){__p&&__p();var c=a.type;switch(c){case b("FBRTCCallabilityActions").Types.CALLABILITY_FETCHED:c=a.userID;var d=a.callability;this.$RTCCallabilityStore1.set(c,{callable:d.is_callable,isBlocked:d.is_blocked},null,d.is_callable?j:i);this.__emitChange();break;case b("FBRTCCallabilityActions").Types.CALLABILITY_FETCH_ERROR:this.$RTCCallabilityStore1.set(a.userID,{callable:!1,isBlocked:!1},null,i);this.__emitChange();break}};a.prototype.isCallable=function(a,b){b=b?b.message_count>0&&b.folder==="inbox":!1;a=this.fetchUserFromCache(a);return a&&a.callable||b};a.prototype.isBlocked=function(a,c){c=c?b("MercuryThreadInfo").canReply(c):!0;a=this.fetchUserFromCache(a);return a&&a.isBlocked||!c};a.prototype.fetchUserFromCache=function(a){this.$RTCCallabilityStore1.has(a)||(this.$RTCCallabilityStore2.fetchCallability(a),this.$RTCCallabilityStore1.set(a,{callable:!1,isBlocked:!1},null,i));return this.$RTCCallabilityStore1.get(a)};a.prototype.callButtonTooltip=function(a,b,c,d){c===void 0&&(c=!0);return!this.isBlocked(a,d)&&(c||this.isCallable(a))?g._("Start a video chat with {shortname}",[g._param("shortname",b)]):g._("{shortname} is currently unavailable for video calling",[g._param("shortname",b)])};a.prototype.voiceCallButtonTooltip=function(a,b,c,d){c===void 0&&(c=!0);return!this.isBlocked(a,d)&&(c||this.isCallable(a))?g._("Start a voice call with {shortname}",[g._param("shortname",b)]):g._("{shortname} is currently unavailable for voice calling",[g._param("shortname",b)])};a.__moduleID=e.id;e.exports=a}),null);
__d("MNRTCCallabilityStore",["MessengerDispatcher","RTCCallabilityStore"],(function(a,b,c,d,e,f){"use strict";e.exports=new(b("RTCCallabilityStore"))(b("MessengerDispatcher"))}),null);
__d("FBRTCAvailability",["ChannelConstants","PresenceStatus"],(function(a,b,c,d,e,f){"use strict";a={isCallable:function(a){a=b("PresenceStatus").getCapabilities(a);var c=b("ChannelConstants").CAPABILITY_VOIP_INTEROP;return!!(a&c)}};e.exports=a}),null);
__d("FBRTCCallUIWrapper",["regeneratorRuntime","Bootloader","MessengerRTCFunnelLogger","UserAgent"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=null;a={openGroupCallUI:function(a,c,d,e,f,h){return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:g=this._openWindow("Group Call"),b("Bootloader").loadModules(["FBRTCCallUI"],function(b){b.openGroupCallUI(a,c,d,e,f,g,h)},"FBRTCCallUIWrapper");case 2:case"end":return i.stop()}},null,this)},openGroupCallURI:function(a,c,d,e,f,h,i,j){return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:g=this._openWindow("Group Call"),b("Bootloader").loadModules(["FBRTCCallUI"],function(b){b.openGroupCallURI({conferenceName:a,callID:c,hasVideo:d,serverInfoData:h,trigger:i,callSummary:j,callWindow:g,multiwayWwwTier:f,multiwayCoreTier:e})},"FBRTCCallUIWrapper");case 2:case"end":return k.stop()}},null,this)},openAsCaller:function(a,c,d,e){!g&&window.rtcCallChildWindow&&(g=window.rtcCallChildWindow,window.rtcCallChildWindow=null);if(this._shouldFocusCallWindow(a)){g&&g.focus();return}this._shouldCloseCallWindow()&&(g&&g.close());g=this._openWindow("Video Call");b("Bootloader").loadModules(["FBRTCCallUI"],function(b){b.openAsCaller(a,c,d,e,g)},"FBRTCCallUIWrapper")},openAsCallee:function(a,c,d,e){g=this._openWindow("Video Call"),b("Bootloader").loadModules(["FBRTCCallUI"],function(b){b.openAsCallee(a,c,d,e,g)},"FBRTCCallUIWrapper")},_shouldFocusCallWindow:function(a){return!!g&&!g.closed&&g.rtcCallInProgessWith===a},_shouldCloseCallWindow:function(){return!!g&&!g.closed&&!g.rtcCallInProgessWith},_openWindow:function(a){var c=this._windowPosition();c=["menubar=no","location=no","scrollbars=no","status=no","personalbar=no",c.height,c.width,c.top,c.left].join(",");this._isSparkBrowser()&&(c="");a=window.open("",a,c);window.callWindow=a;a?b("MessengerRTCFunnelLogger").appendAction("popup_window"):b("MessengerRTCFunnelLogger").endFunnel("popup_blocked");return a},_windowPosition:function(){var a=960,b=540,c,d,e,f;screen&&screen.width>1280&&(a=1280,b=720);window.innerWidth!==undefined?(d=window.innerWidth,c=window.innerHeight):(d=screen.width,c=screen.height);window.screenLeft!==undefined?(e=window.screenLeft,f=window.screenTop):(e=window.screenX,f=window.screenY);d=Math.floor(d/2-a/2+e);e=Math.floor(c/2-b/2+f);return{height:"height="+b.toString(),width:"width="+a.toString(),top:"top="+e.toString(),left:"left="+d.toString()}},_isSparkBrowser:function(){return b("UserAgent").isBrowser("Chrome < 34")&&b("UserAgent").isBrowser("Chrome > 33")}};e.exports=a}),null);
__d("FBRTCCore",["invariant","Bootloader","FBRTCAvailability","FBRTCCallUIWrapper","FBRTCExperiment","FBRTCSupport","FBRTCUtils","MessengerRTCFunnelLogger"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=!1;a={startOutgoingCall:function(a,c,d,e){__p&&__p();e===void 0&&(e=!1);/\D/.test(a)&&g(0);if(h)return;b("MessengerRTCFunnelLogger").addFunnelTags([d?"audio_only":"video","p2p"]);h=!0;setTimeout(function(){h=!1},1e3);if(e&&!b("FBRTCSupport").isCollabSupported())b("Bootloader").loadModules(["FBRTCUnsupportedBrowserMessage","CollabMessengerLogger"],function(c,d){c.showForUnsupportedCollabCall(),d.logBrowserNotSupported({peerID:a}),b("MessengerRTCFunnelLogger").endFunnel("unsupported_browser")},"FBRTCCore");else if(!b("FBRTCSupport").isWebrtcSupported())b("Bootloader").loadModules(["FBRTCUnsupportedBrowserMessage","RTWebUserActionLogger","RTWebLoggingCallType"],function(a,c,e){a.showForOutgoingCall(),b("MessengerRTCFunnelLogger").endFunnel("unsupported_browser"),c.logError({callType:e.P2P,page:c.getPage(),mediaType:c.getMediaType(d),errorDomain:"unsupported browser"})},"FBRTCCore");else{e=b("FBRTCUtils").generateRandomInt();b("FBRTCCallUIWrapper").openAsCaller(a,e,c,d)}},startGroupCall:function(a){__p&&__p();var c=a.conferenceName,d=a.hasVideo,e=a.serverInfoData,f=a.trigger;a=a.usersToRing;a=a===void 0?[]:a;if(h)return;b("MessengerRTCFunnelLogger").addFunnelTags([d?"video":"audio_only","group"]);h=!0;setTimeout(function(){h=!1},1e3);if(!b("FBRTCSupport").isGroupCallWebtrcSupported()){b("Bootloader").loadModules(["MessengerRTCUnsupportedBrowserDialogController","RTWebUserActionLogger","RTWebLoggingCallType"],function(a,e,f){e.logError({callType:f.MW,conferenceName:c,page:e.getPage(),mediaType:e.getMediaType(!d),errorDomain:"unsupported browser"}),a.render({hasVideo:d,isGroupCall:!0}),b("MessengerRTCFunnelLogger").endFunnel("unsupported_browser")},"FBRTCCore");return}b("FBRTCCallUIWrapper").openGroupCallUI(c,b("FBRTCUtils").generateRandomInt(),a,d,f,e)},isAvailableForWebrtcCalling:function(a){var c=b("FBRTCExperiment").gen("rtc_www_bypass_callability_check");c=c.getBool("check_presence",!0);return!c||b("FBRTCAvailability").isCallable(a)},shouldEnableVideoCalling:function(){return b("FBRTCSupport").isOSSupported()}};e.exports=a}),null);
__d("MessengerCallLogEvent",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({GROUP_CALL_ENDED:"group_call_ended",GROUP_CALL_STARTED:"group_call_started",INVITED_TO_CALL:"invited_to_call",MISSED_CALL:"missed_call",ONE_ON_ONE_CALL_ENDED:"one_on_one_call_ended"})}),null);
__d("MercuryRTCShareAttachment.react",["cx","fbt","ix","CenteredContainer.react","FBRTCCore","FBRTCLogger","FBRTCSupport","Image.react","MercuryIDs","MercuryLogMessageType","MercuryShareAttachmentReactShape","MercuryShareAttachmentRenderLocations","MercuryTimestamp","MercuryViewer","MessengerCallLogEvent","MessengerParticipants.bs","MessengerRTCFunnelLogger","MessengerTextWithEmoticons.react","MNRTCCallabilityStore","React","ShimButton.react","SimpleXUIDialog","VideoCallTypedLogger","XUIButton.react","XUIText.react"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k=b("MercuryShareAttachmentRenderLocations").CHAT,l=b("MercuryShareAttachmentRenderLocations").MESSENGER;c=babelHelpers.inherits(a,b("React").PureComponent);j=c&&c.prototype;function a(){var a,b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=(a=j.constructor).call.apply(a,[this].concat(d)),this.state={peerName:"",isPage:!1,isBlockedPeer:!1},b}a.prototype.componentDidMount=function(){var a=this.props.attachment.log_message_data.caller,c=this.props.attachment.log_message_data.callee,d=a===b("MercuryViewer").getID();d=d?c:a;b("MessengerParticipants.bs").get(d,function(a){this.setState({peerName:a.short_name?a.short_name:a.name,isPage:a.type==="page"||this.props.isPageMessage,isBlockedPeer:a.is_facebook_blocked||a.is_messenger_blocked})}.bind(this))};a.prototype.render=function(){__p&&__p();var a=this.props.attachment,c=a.log_message_data;a=a.log_message_body;var d=c.caller,e=c.callee,event=c.event,f=d===b("MercuryViewer").getID(),g=!c.answered;e=f?e:d;d=b("MercuryIDs").getUserIDFromParticipantID(e);e=this.state;var h=e.peerName,i=e.isPage;e=e.isBlockedPeer;var j=b("MercuryTimestamp").getPreciseTimestamp(this.props.attachment.timestamp),m=c.server_info_data;c=c.thread_id;a=b("React").createElement(b("MessengerTextWithEmoticons.react"),{text:a});j=this.$1(!g,f,j);i=!i&&!e;if(this.props.location===k){e=this.$2(d,h,event,f,m,c);return b("React").createElement("div",{className:"_1k2i"},b("React").createElement("div",{className:g&&!f?"_1k2j":""},b("React").createElement(b("XUIText.react"),{weight:"bold"},a),b("React").createElement(b("XUIText.react"),{weight:"bold"},j)),i?b("React").createElement(b("React").Fragment,null,b("React").createElement("hr",null),b("React").createElement(b("CenteredContainer.react"),{vertical:!0,className:"_3-8x"},e)):null)}else if(this.props.location===l){e=this.$2(d,h,event,f,m,c);return b("React").createElement("div",{className:"_55q _5i_d _52mr"},b("React").createElement("div",{className:(g&&!f?"_1k2j":"")+(i?" _55r":"")},b("React").createElement(b("XUIText.react"),{weight:"bold"},a),b("React").createElement(b("XUIText.react"),{weight:"bold"},j)),i?b("React").createElement(b("CenteredContainer.react"),{vertical:!0,className:"_3-8w"},e):null)}j=this.$3(d,h,event,f,m,c);return b("React").createElement("div",null,b("React").createElement("div",{className:(g&&!f?"_1k2j":"")+" _55s"},a),i?b("React").createElement("div",{className:"_55t"},j):null)};a.prototype.$1=function(a,c,d){var e=null;!a&&!c?e=i("86815"):c?e=i("86816"):e=i("86813");return b("React").createElement("div",{className:"_2phz"},b("React").createElement(b("Image.react"),{src:e}),b("React").createElement("span",{className:(a||c?"_3ole":"")+" _2pir"},d))};a.prototype.$2=function(a,c,event,d,e,f){d=this.$4(event,d,f);if(b("FBRTCSupport").isOSSupported())return b("React").createElement(b("ShimButton.react"),{form:"link",onClick:this.$5.bind(this,a,c,event===b("MessengerCallLogEvent").GROUP_CALL_ENDED?null:e,f)},d);else return b("React").createElement("span",null,d)};a.prototype.$3=function(a,c,event,d,e,f){d=this.$4(event,d,f);return b("React").createElement(b("XUIButton.react"),{onClick:this.$5.bind(this,a,c,e,f),label:d})};a.prototype.$4=function(event,a,c){if(c)if(event===b("MessengerCallLogEvent").GROUP_CALL_ENDED)return h._("Call Again");else return h._("Join");else if(event===b("MessengerCallLogEvent").MISSED_CALL&&!a)return h._("Call Back");else return h._("Call Again")};a.prototype.$5=function(a,c,d,e){__p&&__p();if(!a&&!e)return;var f=this.props.attachment.log_message_type===b("MercuryLogMessageType").PHONE_CALL;b("MessengerRTCFunnelLogger").startFunnel("Attachment");new(b("VideoCallTypedLogger"))().setEvent("web_admin_message_call_back_click").log();if(e){e={conferenceName:"GROUP:"+e,hasVideo:!f,trigger:b("FBRTCLogger").Trigger.ADMIN_MESSAGE,usersToRing:[]};d&&(e.serverInfoData=d);b("FBRTCCore").startGroupCall(e)}else a&&(b("FBRTCCore").isAvailableForWebrtcCalling(a)||b("MNRTCCallabilityStore").isCallable(a))?b("FBRTCCore").startOutgoingCall(a,b("FBRTCLogger").Trigger.ADMIN_MESSAGE,f):b("SimpleXUIDialog").show(h._("{firstname} can't be reached right now.",[h._param("firstname",c)]),h._("Can't Connect Call"))};e.exports=a}),null);
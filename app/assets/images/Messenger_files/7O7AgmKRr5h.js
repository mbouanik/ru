if (self.CavalryLogger) { CavalryLogger.start_js(["eJV0h"]); }

__d("MercuryThreadlistContainer.react",["Bootloader","MercuryAPIArgsSource","MercuryConfig","MercuryFilters.bs","MercuryIDs","MercuryThreadlistConstants","MessagingTag","MessengerMessageRequestsTypedLogger","MessengerState.bs","MessengerURIStore","P2PJewelBannerContainer.react","QE2Logger","React","SubscriptionsHandler","emptyFunction","gkx","immutable","setImmediateAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=b("React").PropTypes;var h="search";d=3;var i=5e3,j=b("MercuryThreadlistConstants").JEWEL_THREAD_COUNT+d;f=babelHelpers.inherits(a,b("React").Component);g=f&&f.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=g.constructor).call.apply(a,[this].concat(e)),this.state={aggregatedThreads:null,showAggregation:!1,isLoading:!0,isSearching:!1,unreadMessageRequestThreads:[],threads:b("immutable").Map(),pinnedThreads:[]},this.threadListReqsInFlight=0,this.$12=function(){var a=function(){this.setState({suspended:!1}),this.handleThreadListUpdate()}.bind(this);b("gkx")("AT5Q5FCBY57gPdOe4Xo96r5zTgZZh87GRY--ncB3hM3Ra_B90Pc8SDhcEc8FXtQOATf6BwBTiNdA_hZCDlaZ5sW0DhwFxWZa8AHAo9f71cU_8w")&&(this.setState({suspended:!0}),setTimeout(a,i))}.bind(this),this.$13=function(){this.props.folder!==b("MessagingTag").MESSAGE_REQUEST_AGGREGATION_UNIT&&!this.state.isSearching&&!this.state.isLoading&&!this.$1.hasLoadedThreadlist(this.props.folder,this.props.filter)&&this.$6(this.props.folder,this.props.filter,this.$7(this.props.folder)+b("MercuryThreadlistConstants").JEWEL_MORE_COUNT+1)}.bind(this),this.$20=function(){if(!this.$1)return;var a=this.$1.getAvailableThreadlistNow(b("MessagingTag").PENDING,b("MercuryFilters.bs").unread);b("MessengerState.bs").getMultiThreadMeta(this.props.viewer,a,function(b){this.setState({unreadMessageRequestThreads:a.map(function(a){return b[a]})})}.bind(this))}.bind(this),this.$15=function(a,c){this.setState({isLoading:c,searchThreads:[]},function(){return this.$11(h,b("MercuryFilters.bs").all,a)}.bind(this))}.bind(this),this.$14=function(a){this.setState({isSearching:!!a})}.bind(this),this.$16=function(a,c){this.setState({showAggregation:!0,aggregatedThreads:c});var d=b("MercuryIDs").getParticipantIDFromUserID(this.props.viewer),e=[];c=c.map(function(a){e.push(b("MercuryIDs").getThreadKeyfromThreadIDUserID(a.thread_id,b("MercuryIDs").tokenize(d).value));return a.thread_id});this.props.onAggregationClick&&this.props.onAggregationClick(a,c);new(b("MessengerMessageRequestsTypedLogger"))().setAction("aggregation_entrypoint_tap").setEntryPoint("inbox_aggregation").setSurface("inbox").setFolderType("pending").setThreadKeyList(e.filter(function(a){return a}).join(", ")).log()}.bind(this),c}a.prototype.UNSAFE_componentWillMount=function(){this.setState({showAggregation:b("MessengerURIStore").getState()&&b("MessengerURIStore").getState().threadIDs!==null})};a.prototype.componentDidMount=function(){__p&&__p();b("Bootloader").loadModules(["MercuryOrderedThreadlist","MercuryThreadInformer"],function(a,c){__p&&__p();this.props.resetAggregatedThreads&&this.setState({showAggregation:!1,aggregatedThreads:null}),this.$1=a.getForFBID(this.props.viewer),this.$2=function(a){__p&&__p();var c=this.$1.getAvailableThreadlistNow(b("MessagingTag").INBOX,a);if(c.length===0)return c;var d=b("MessengerState.bs").getThreadMetaNow(this.props.viewer,c[c.length-1]);if(!d)return c;d=d.timestamp;d=this.$1.getThreadlistUntilTimestamp(d,b("MessagingTag").PENDING,a);d.sort(function(a,c){a=b("MessengerState.bs").getThreadMetaNow(this.props.viewer,a);c=b("MessengerState.bs").getThreadMetaNow(this.props.viewer,c);return(c&&c.timestamp)-(a&&a.timestamp)}.bind(this));a=b("MercuryConfig").MCMA?this.$3(d):d;return c.concat(a).sort(function(a,c){a=typeof a==="string"?b("MessengerState.bs").getThreadMetaNow(this.props.viewer,a):b("MessengerState.bs").getThreadMetaNow(this.props.viewer,a[0]);c=typeof c==="string"?b("MessengerState.bs").getThreadMetaNow(this.props.viewer,c):b("MessengerState.bs").getThreadMetaNow(this.props.viewer,c[0]);return(c&&c.timestamp)-(a&&a.timestamp)}.bind(this))}.bind(this),this.$4=c.getForFBID(this.props.viewer),this.$5=new(b("SubscriptionsHandler"))(),this.$5.addSubscriptions(this.$4.subscribe("threadlist-updated",function(a,b){this.state.suspended||this.handleThreadListUpdate()}.bind(this))),b("QE2Logger").logExposureForUser("www_messenger_connections_inbox"),b("MercuryConfig").MessengerInboxRequests&&this.$6(b("MessagingTag").PENDING,this.props.filter,this.$7(b("MessagingTag").PENDING)+b("MercuryThreadlistConstants").CONNECTION_REQUEST),this.$8(this.props.folder,this.props.filter)}.bind(this),"MercuryThreadlistContainer.react")};a.prototype.UNSAFE_componentWillReceiveProps=function(a){(a.resetAggregatedThreads!==this.props.resetAggregatedThreads||a.folder!==this.props.folder||a.filter!==this.props.filter||a.folder===b("MessagingTag").INBOX&&this.state.showAggregation==!0)&&this.$8(a.folder,a.filter)};a.prototype.componentDidUpdate=function(){this.props.resetAggregatedThreads&&this.state.showAggregation&&this.setState({showAggregation:!1,aggregatedThreads:null})};a.prototype.componentWillUnmount=function(){this.$9(),this.$10(),this.$5&&this.$5.release()};a.prototype.handleThreadListUpdate=function(){this.$11(this.props.folder,this.props.filter),b("QE2Logger").logExposureForUser("www_messenger_connections_inbox"),b("MercuryConfig").MessengerInboxRequests&&(this.props.folder===b("MessagingTag").INBOX&&this.$11(b("MessagingTag").PENDING,this.props.filter),this.props.folder===b("MessagingTag").PENDING&&this.$11(b("MessagingTag").INBOX,this.props.filter))};a.prototype.render=function(){var a=this.props,c=a.ChildClass,d=a.folder,e=a.filter;a=babelHelpers.objectWithoutProperties(a,["ChildClass","folder","filter"]);var f=this.state.isSearching?this.state.threads.get(h)||[]:this.state.threads.get(d)||[];return b("React").createElement(c,babelHelpers["extends"]({},a,{filter:e,folder:d,isLoaded:d===b("MessagingTag").MESSAGE_REQUEST_AGGREGATION_UNIT||!!this.$1&&this.$1.hasLoadedThreadlist(d,e),isLoading:this.state.isLoading,isSearching:this.state.isSearching,newMessageRequestThreads:this.state.unreadMessageRequestThreads,onRenderThreads:this.props.onRenderThreads,onMessageRequestsClick:this.props.onMessageRequestsClick,pendingFolderUnseenCount:this.props.pendingFolderUnseenCount,showAggregation:this.state.showAggregation,threads:this.state.aggregatedThreads||f,pinnedThreads:this.state.pinnedThreads,onLoadMoreRequest:this.$13,onQuery:this.$14,onSearchResults:this.$15,onAggregationClick:this.$16,p2pJewelBannerContainer:this.$17(),maxInitialThreadCount:j,handleChatTabOpen:this.props.source==="jewel"&&b("gkx")("AT5Q5FCBY57gPdOe4Xo96r5zTgZZh87GRY--ncB3hM3Ra_B90Pc8SDhcEc8FXtQOATf6BwBTiNdA_hZCDlaZ5sW0DhwFxWZa8AHAo9f71cU_8w")?this.$12:b("emptyFunction")}))};a.prototype.$3=function(a){__p&&__p();var c=b("MercuryConfig").Unit||3,d=(b("MercuryConfig").Duration||3)*1e3*60*60*24,e=a.map(function(a){a=b("MessengerState.bs").getThreadMetaNow(this.props.viewer,a);return a?a.timestamp:null}.bind(this)).filter(function(a){return a!==null}),f=[];for(var g=0;g<e.length;g++){var h=e[g],i=e[g+c-1];if(i&&h-i<d){i=[a[g]];for(var j=g+1;j<e.length;j++){var k=e[j];if(k&&h-k<d)i.push(a[j]),g++;else break}f.push(i)}else f.push(a[g])}return f};a.prototype.$17=function(){return b("gkx")("AT7KSMdBbHFSBSJn1JWZUBa76yZr8D9pobYWWvzliNi0RZQsDI29awNxAAPfpbtiIQHouKzRc3uiaxxHhFXpGQGFiE6SMOOJwNKziF0lagOtKg")?b("React").createElement(b("P2PJewelBannerContainer.react"),null):null};a.prototype.$8=function(a,c){if(a===b("MessagingTag").MESSAGE_REQUEST_AGGREGATION_UNIT)return;var d=b("MessengerURIStore").getState()&&b("MessengerURIStore").getState().threadIDs||this.props.threadIDs;d||this.setState({showAggregation:!1,aggregatedThreads:null});a===b("MessagingTag").INBOX&&(b("gkx")("AT6h5--3KUdxbat1rL4n2mVcPcg9eZ8bwokXjpPZS-_sSShoFlPyHXdioNqIwODAz2vH7270MK0r4x8XFkaYt6-h")||this.props.source!==b("MercuryAPIArgsSource").JEWEL)&&(b("QE2Logger").logExposureForUser("www_messenger_connections_inbox"),b("MercuryConfig").MessengerInboxRequests||this.$18());!this.$19(a,c)?this.$6(a,c,j):this.state.isLoading?this.setState({isLoading:!1},function(){this.$11(a,c)}.bind(this)):this.$11(a,c)};a.prototype.$18=function(){this.$1.getFilteredThreadlist(b("MercuryThreadlistConstants").RECENT_THREAD_OFFSET,b("MercuryThreadlistConstants").MAX_UNREAD_COUNT,b("MessagingTag").PENDING,b("MercuryFilters.bs").unread,this.$20,!0,this.props.source)};a.prototype.$6=function(a,c,d){if(!this.$1)return;this.$10();this.threadListReqsInFlight++;var e=function(){var e=this.$1.getFilteredThreadlist(b("MercuryThreadlistConstants").RECENT_THREAD_OFFSET,d,a,c||b("MercuryFilters.bs").all,function(a){this.threadListReqsInFlight--,this.threadListReqsInFlight===0&&this.setState({isLoading:!1})}.bind(this),!0,this.props.source);this.$21={subscriberID:e,folder:a,filter:c}}.bind(this);this.state.isLoading?b("setImmediateAcrossTransitions")(e):this.setState({isLoading:!0},e)};a.prototype.$11=function(a,c,d){__p&&__p();if(!this.$1)return;this.$9();var e;a===b("MessagingTag").INBOX&&b("QE2Logger").logExposureForUser("www_messenger_connections_inbox");b("MercuryConfig").MessengerInboxRequests&&a===b("MessagingTag").INBOX?e=this.$2(c):a===b("MessagingTag").MESSAGE_REQUEST_AGGREGATION_UNIT||this.state.showAggregation?(e=b("MessengerURIStore").getState()&&b("MessengerURIStore").getState().threadIDs||this.props.threadIDs,this.$22(e)):e=d||this.$1.getAvailableThreadlistNow(a,c);d=[].concat.apply([],e);this.$23=b("MessengerState.bs").getMultiThreadMeta(this.props.viewer,d,function(b){this.setState({threads:this.state.threads.set(a,this.$24(e,b))})}.bind(this));this.$25()};a.prototype.$25=function(){var a=this.$1.getPinnedThreadlist();b("MessengerState.bs").getMultiThreadMeta(this.props.viewer,a,function(b){this.setState({pinnedThreads:this.$24(a,b)})}.bind(this))};a.prototype.$22=function(a){var c=this.$1.getAvailableThreadlistNow(b("MessagingTag").PENDING,this.props.filter);if(a&&a.length>0){a=a.filter(function(a){return c.indexOf(a)!==-1});b("MessengerState.bs").getMultiThreadMeta(this.props.viewer,a,function(a){Array.isArray(a)||(a=Object.values(a)),this.setState({aggregatedThreads:a})}.bind(this))}else this.setState({aggregatedThreads:null})};a.prototype.$24=function(a,b){return a.map(function(a){if(Array.isArray(a))return a.map(function(a){return b[a]});else return b[a]})};a.prototype.$19=function(a,b){var c=j;return!!(this.$1&&(this.$1.getThreadCount(a,b)>=c||this.$1.hasLoadedThreadlist(a,b)))};a.prototype.$7=function(a){a=this.state.threads.get(a);return a?a.length:0};a.prototype.$9=function(){this.$23&&b("MessengerState.bs").unsubscribeThread(this.props.viewer,this.$23)};a.prototype.$10=function(){this.$1&&this.$21&&this.$1.unsubscribe(this.$21.subscriberID,this.$21.folder,this.$21.filter)};a.propTypes={blockedIds:c.instanceOf(Set),ChildClass:c.func.isRequired,filter:c.string.isRequired,folder:c.string.isRequired,onMessageRequestsClick:c.func,onRenderThreads:c.func,onAggregationClick:c.func,pendingFolderUnseenCount:c.number,showCount:c.bool,showPresence:c.bool,source:c.string,threadCount:c.number,threadIDs:c.array,viewer:c.string.isRequired,onRenderBackArrow:c.func,resetAggregatedThreads:c.bool};a.defaultProps={source:b("MercuryAPIArgsSource").JEWEL};e.exports=a}),null);
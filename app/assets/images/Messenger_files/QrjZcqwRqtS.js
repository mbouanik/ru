if (self.CavalryLogger) { CavalryLogger.start_js(["BOH0u"]); }

__d("ChatTabViewEvents",["Arbiter"],(function(a,b,c,d,e,f){"use strict";e.exports=new(b("Arbiter"))()}),null);
__d("MultiChatController",["ChatOpenTabEventLogger","CurrentUser","FantaTabActions","MercuryIDs","MercuryLocalIDs","MercuryViewer","MessengerState.bs"],(function(a,b,c,d,e,f){__p&&__p();function a(){}Object.assign(a,{createThreadForTokens:function(a){__p&&__p();var c=b("MercuryViewer").getID();if(!a.length)return;a=a.filter(function(a){return a!==c});var d;if(a.length===0)return;else a.length===1?(d=b("MercuryIDs").getThreadIDFromParticipantID(a[0]),b("FantaTabActions").openTab(d,"created_locally_from_tokens"),b("ChatOpenTabEventLogger").logAutoOpen("ChatTabView",d)):(d=b("MercuryLocalIDs").generateThreadID(),a.unshift(c),b("MessengerState.bs").createNewLocalThread(b("CurrentUser").getID(),d,a),b("FantaTabActions").openTab(d,"created_locally_from_tokens"),b("ChatOpenTabEventLogger").logAutoOpen("MultiChatController",d));return d}});e.exports=a}),null);
__d("MessengerEmojiUsageUtils",["MessengerSupportedEmojiUtils","Utf16"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=65039;a={findAllEmojis:function(a){__p&&__p();var c=[];a=b("MessengerSupportedEmojiUtils").parse(a);a.forEach(function(a){var d=[];a.emoji.forEach(function(a){a=b("Utf16").decode(a);a&&d.push(a)});d[d.length-1]===g&&d.pop();c.push(d)});return c}};e.exports=a}),null);
__d("MessengerUploadFilesUtil.bs",["bs_array","bs_curry","FantaTypeFileUploader"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e=(d={},d[b("FantaTypeFileUploader").fileTypes.ANIMATED_IMAGE]="gif_ids",d[b("FantaTypeFileUploader").fileTypes.AUDIO]="audio_ids",d[b("FantaTypeFileUploader").fileTypes.FILE]="file_ids",d[b("FantaTypeFileUploader").fileTypes.GENERIC_ATTACHMENT]="generic_attachment_ids",d[b("FantaTypeFileUploader").fileTypes.IMAGE]="image_ids",d[b("FantaTypeFileUploader").fileTypes.VIDEO]="video_ids",d);function a(a,b){if(a==null)return null;else{a=a.getTypeIDs(b);if(a.length!==0)return a;else return null}}function g(a){__p&&__p();if(a==null)return 0;else{a=a.get("uploadedFiles");var b=[],c=[],d=[];a.forEach(function(a,e,f){__p&&__p();e=a.file;if(e.type.startsWith("image/")){b.push(e);return 0}else if(e.type.startsWith("video/")){c.push(e);return 0}else{d.push(e);return 0}});return[[b,c,d]]}}function h(a,c){if(c.length!==0)return b("bs_curry")._1(a,c);else return 0}function c(a,c){__p&&__p();if(a==null||c==null)return 0;else{a=g(a);if(a){a=a[0];b("bs_array").iter(function(a){return h(c,[a])},a[1]);h(c,a[0]);return h(c,a[2])}else return 0}}f.supportAttachments=e;f.getAttachmentIDs=a;f.getAttachments=g;f.sendAttchment=h;f.sendAttchments=c}),null);
__d("XMessagingSetThreadNameController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/messaging/set_thread_name/",{})}),null);
__d("FantaReducersSendMessages",["fbt","AsyncRequest","Bootloader","ChatTabViewEvents","CurrentUser","EmojiLikeUtils","EmojiState","FantaMessageActions","FantaTypeComposer","FantaTypeFileUploader","FantaTypeSharePreview","FantaTypeTabContents","MercuryIDs","MercuryIgnoredBlockedParticipants.bs","MercuryLogMessageType","MercuryMessageActions","MercuryMessageObject","MessengerParticipants.bs","MercurySheetPolicy","MercurySourceType","MercuryThreadActions","MercuryThreadIDMap","MercuryThreadInfo","MessageRequestUtils","MessengerAdminGroupUtils","MessengerApprovalModeTypes","MessengerDiscoveryEntryPoint","MessengerDiscoveryEntryPointsLoggingHelper","MessengerEmojiUsageUtils","RepliedToMessageStatusForGraphQL","MessengerState.bs","MessengerUploadFilesUtil.bs","MultiChatController","SimpleXUIDialog","SiteData","XMessagingSetThreadNameController","getPageIDFromThreadID","setImmediate"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("MercuryMessageActions").get(),i=b("MercuryMessageObject").get(),j=b("MercuryThreadActions").get(),k=b("MercuryThreadIDMap").get(),l=b("FantaMessageActions").Types,m=/^\s*$/,n="/ajax/chat/multichat/name_conversation/dismiss.php";function a(a,c){__p&&__p();switch(c.type){case l.UPDATE_GROUP_NAME:var d=c.threadID,e=c.newName;c=a.mercury.tabContents.get(d);if(!c)return a;var f=c;f=f.thread;if(!f)return a;f=f.name;(e||f)&&e!==f&&k.getServerIDFromClientID(d,function(a){var c=b("XMessagingSetThreadNameController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(c).setData({thread_id:a,thread_name:e}).send()});k.getServerIDFromClientID(d,function(a){new(b("AsyncRequest"))(n).setData({thread_fbid:a}).send()});c=c.merge({openSheet:null});a=a.setIn(["mercury","tabContents",d],c)}return a}function c(a,c){__p&&__p();switch(c.type){case l.SEND_GROUP_MESSAGE:var d=c.threadID,e=a.mercury.tabContents.get(d),f=e,j=f.thread;f=f.typeahead;if(!f||!j)return a;var k=b("MessengerState.bs").isEmptyLocalThread(b("CurrentUser").getID(),d),m=f.getSelectedParticipantIDs();if(j.is_canonical_user||k){var n=j.participants;b("setImmediate")(function(){return b("MultiChatController").createThreadForTokens(n.concat(m))})}else{f=b("MessengerAdminGroupUtils").shouldInvite(j);f?m.forEach(function(a){a=b("MercuryIDs").getThreadIDFromParticipantID(a);a&&h.send(i.constructUserGeneratedMessageObject(j.joinable_mode.link,b("MercurySourceType").CHAT_WEB,a))}):h.send(i.constructLogMessageObject(b("MercurySourceType").CHAT_WEB,d,b("MercuryLogMessageType").SUBSCRIBE,{added_participants:m}));k=j.admin_ids.indexOf(b("CurrentUser").getID())!==-1;if(j.approval_mode===b("MessengerApprovalModeTypes").APPROVALS&&!k){f=g._("New members need to be approved by an admin. This request was added to the approval queue.");d=g._("Approval pending");b("SimpleXUIDialog").show(f,d)}}k=c.tabID||c.threadID;e=e.merge({typeahead:null});a=a.setIn(["mercury","tabContents",k],e)}return a}function d(a,c){__p&&__p();switch(c.type){case l.SEND_HOT_LIKE:case l.SEND_MESSAGE:case l.SEND_PHOTO:case l.SEND_STICKER:var d=c.message,e=c.threadID,f=d?d.mentions:null;d&&(d=d.message);var g=a.tabGroup.tabs.get(e),h=g&&g.entryPoint||null;Array.isArray(h)&&(h=h[0]);switch(h){case"compose_link":h="chat_sidebar_new_message";break;case"jewel_new_message":h="jewel_new_message";break;case"created_locally_from_tokens":h="one_to_one_plus";break}g=c.emoji;var i=c.onSendSuccess,j=c.photoData,k=c.size,n=c.source,r=c.stickerID;c=c.composer;var s=a.mercury.tabContents.get(e);if(!s)return a;var t=s,u=t.composer,v=t.signatureID,w=t.threadPreviewID;t=t.threadPreviewRecipients;var x=u.fileUploader,y=u.sharePreview,z=u.replyingToMessage;if(c&&u&&c.version!==u.version)return a;c=w||e;u=s.thread;w=!!(!d&&g&&k);var A=!!(!d&&r),B=b("MessengerState.bs").isEmptyLocalThread(b("CurrentUser").getID(),c);w?d=g:(A||j)&&(d="");g=u&&u.is_canonical&&!b("MercuryThreadInfo").canReply(u);var C=!!(y.params&&y.type);if(o(x,y))s=s.merge({openSheet:b("MercurySheetPolicy").sheets.ChatUploadWarningTabSheet}),a=a.setIn(["mercury","tabContents",e],s);else if(g&&u)p(u);else if(!m.test(d)||x.uploadedFiles.size>0||C||A||j){g=b("MessengerEmojiUsageUtils").findAllEmojis(d);g.length>0&&b("EmojiState").updateRecentlyUsed(g);u=A?[]:x.getTypeIDs(b("FantaTypeFileUploader").fileTypes.GENERIC_ATTACHMENT);C=q(c,d,u,y,w,x,k,n,A,r,j,t,f,v,h,z);if(C){if(e!==c){g=a.tabGroup.tabs.get(e);a=a.deleteIn(["tabGroup","tabs",e]);a=a.deleteIn(["mercury","tabContents",e]);a=a.setIn(["tabGroup","tabs",c],g.merge({id:c}));s=new(b("FantaTypeTabContents"))({composer:s.composer,id:c});a=a.setIn(["mercury","tabContents",c],s)}else s=s.merge({isNewMessageTab:!1}),a=a.setIn(["mercury","tabContents",c],s);u=z||!w&&!A&&!j||j&&!((d=j)!=null?(d=d.preview_attachments)!=null?(d=d[0])!=null?d.preview_url:d:d:d);a.mercury.tabContents.get(c)&&u&&(s=s.merge({composer:new(b("FantaTypeComposer"))()}),a=a.setIn(["mercury","tabContents",c],s))}C&&i&&i(C)}o(x,y)||(s=s.merge({openSheet:null}),a=a.setIn(["mercury","tabContents",c],s));if(B&&t&&t.size>1){var D=b("MercuryIDs").tokenize(c).value;b("Bootloader").loadModules(["MessengerWebChatEventsTypedLogger","MessengerWebChatEventType"],function(a,b){new a().setEvent(b.CLICK_NEW_MESSAGE).setOfflineThreadingID(D).setEntryPoint(h).log()},"FantaReducersSendMessages")}return a}return a}function o(a,b){return!!(a.uploadingFiles.size>0)}function p(a){var c=a.thread_id,d=b("MercuryIDs").getParticipantIDFromFromThreadID(c);if(d&&a){var e=b("CurrentUser").getID();b("MessengerParticipants.bs").get(d,function(d){b("Bootloader").loadModules(["MessageBlockedDialog"],function(f){b("MessengerState.bs").compute(e,function(g){g=g.blocked_ids;f.show(c,a.can_reply,b("MercuryIgnoredBlockedParticipants.bs").qualifiesAs(e,g,a),d.short_name)})},"FantaReducersSendMessages")})}}function q(a,c,d,e,f,g,k,l,m,n,o,p,q,t,u,v){__p&&__p();l||(l=b("MercurySourceType").CHAT_WEB);var w=i.constructUserGeneratedMessageObject(c,b("MercurySourceType").CHAT_WEB,a);if(u){w.tags||(w.tags=[]);var x=b("getPageIDFromThreadID")(a);x!==null&&Object.values(b("MessengerDiscoveryEntryPoint")).indexOf(u)!==-1&&w.tags.push(b("MessengerDiscoveryEntryPointsLoggingHelper").getEntryPointsLoggingTagStr([u]));w.tags.push("web:trigger:"+u)}d.length>0&&(w.has_attachment=!0,w.raw_attachments=d);v&&(w.replied_to_message={message:v,status:b("RepliedToMessageStatusForGraphQL").VALID});q&&q.length&&(w.profile_ranges=w.profile_xmd=q);m&&(w.has_attachment=!0,w.sticker_id=n);if(!m&&!f&&e.params&&e.type){x={share_params:e.params.get("data"),share_type:e.type};x&&(w.has_attachment=!0,w.shareable_attachment=x)}w.signatureID=t;w.ui_push_phase=b("SiteData").push_phase;!m&&o?(w.content_attachment=null,h.addAttachmentPlaceholder(w,o.upload_id,o)):!f?((c||w.has_attachment)&&r(w,a,p),m||s(g,a,p,v)):k&&l&&(w.has_attachment=!1,h.send(function(){b("EmojiLikeUtils").setEmojiSize(w,k||"");return b("EmojiLikeUtils").setEmojiSource(w,l||"")}()));j.markRead(a);j.markSeen(a);return w}function r(a,c,d){__p&&__p();var e=b("CurrentUser").getID();if(b("MessengerState.bs").isEmptyLocalThread(e,c)){d&&j.addParticipants(c,d.toArray());a.offline_threading_id=b("MercuryIDs").tokenize(c).value;d=b("MessengerState.bs").getThreadMetaNow(e,c);d&&(a.specific_to_list=Array.from(d.participants))}h.send(a,function(a){var c=b("MessengerState.bs").getThreadMetaNow(e,a);c&&b("MessageRequestUtils").isMessageRequest(c)&&j.movePendingToInbox(a);c&&c.thread_id&&c.other_user_fbid&&b("getPageIDFromThreadID")(c.thread_id)&&b("ChatTabViewEvents").inform("chat-send-to-page",{pageID:c.other_user_fbid})})}function s(a,c,d,e){__p&&__p();if(a.uploadedFiles.size===0)return;var f=b("MessengerUploadFilesUtil.bs").supportAttachments;for(var g in f){var h=b("MessengerUploadFilesUtil.bs").getAttachmentIDs(a,g);if(Array.isArray(h)){var j=i.constructAttachmentMessageObject(b("MercurySourceType").CHAT_WEB,c);j[f[g]]=h;e&&(j.replied_to_message={message:e,status:b("RepliedToMessageStatusForGraphQL").VALID});r(j,c,d)}}}e.exports={sendGroupMessage:c,sendMessage:d,updateGroupName:a}}),null);
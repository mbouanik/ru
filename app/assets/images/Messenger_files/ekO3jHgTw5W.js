if (self.CavalryLogger) { CavalryLogger.start_js(["wj4vG"]); }

__d("BonfireFeatureGating",["gkx"],(function(a,b,c,d,e,f){"use strict";a={canReceiveBonfireRingInterop:function(){return b("gkx")("AT67-yEeEisuZnuRf9ZZfe8uDaUmU0f8iOgZ8XTHAvRp7_a_JJm4LDabRivTtsii-tCqADjQbwZjHRWhjygfaDJN")}};e.exports=a}),null);
__d("FBRTCMessageListener",["invariant","Arbiter","BonfireFeatureGating","ChannelConstants","FBRTCCallControlActions","FBRTCConstants","FBRTCLocalMessageQueue","FBRTCSupport","RTCConfig","guid","mixInEventEmitter"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("FBRTCConstants").ChildWindowMessageType,i=45*1e3,j=[],k=null,l=null,m=null,n=null,o=null,p=!1,q=null,r=null,s;a={init:function(a,c){__p&&__p();if(p)return;p=!0;b("Arbiter").subscribe(b("ChannelConstants").getArbiterType("webrtc"),function(a,b){this._onMessage(b.obj)}.bind(this));b("Arbiter").subscribe(b("ChannelConstants").getArbiterType("webrtc_offer"),function(a,b){this._onMessage(b.obj)}.bind(this));b("Arbiter").subscribe(b("ChannelConstants").getArbiterType("webrtc_offerack"),function(a,b){this._onMessage(b.obj)}.bind(this));b("Arbiter").subscribe(b("ChannelConstants").getArbiterType("rtc_multi_json"),function(a,b){this._onMultiwayMessage(b.obj)}.bind(this));b("BonfireFeatureGating").canReceiveBonfireRingInterop()&&b("Arbiter").subscribe(b("ChannelConstants").getArbiterType("parties_notifications"),function(a,b){this._onBonfireMessage(b.obj)}.bind(this));this._localMessageQueue=new(b("FBRTCLocalMessageQueue"))();if(b("RTCConfig").PassMessagesBetweenWindowsGK){if(b("FBRTCSupport").isWebrtcSupported()&&window.addEventListener){var d=a?this._handleWindowMessageToChild.bind(this):this._handleWindowMessageToParent.bind(this);window.addEventListener("message",d,!1)}a&&this._connectToParentWindow(c)}},setParentWindowNonce:function(a){n=a},generateNewNonce:function(){o=b("guid")();return o},setMultiwayMessageHandler:function(a,b){q&&g(0),q=b?a.bind(b):a},_onMultiwayMessage:function(a){this.emit("multiwayMessageReceived",a),q&&q(a)},setBonfireMessageHandler:function(a,b){r&&g(0),r=b?a.bind(b):a},_onBonfireMessage:function(a){this.emit("bonfireMessageReceived",a),r&&r(a)},setMessageHandler:function(a,b){k&&g(0);k=b?a.bind(b):a;while(j.length)k(j.shift())},removeMessageHandler:function(){k=null},setParentWindowStartCallHandler:function(a){s=a;return function(){return s=null}},_onMessage:function(a){a.from&&(a.from=a.from.toString()),this.emit("messageReceived",a),k?k(a):j.push(a),this._passMessageToChildWindow(a)},_connectToParentWindow:function(a){if(window.opener&&window.opener.postMessage){a={type:h.CHILD_WINDOW_READY,nonce:n,childNonce:this.generateNewNonce(),peerID:a};window.opener.postMessage(a,window.location.origin)}},_verifyWindowMessage:function(event){return event.origin===window.location.origin&&event.data&&o&&event.data.nonce===o},_handleWindowMessageToParent:function(event){if(!this._verifyWindowMessage(event))return;event.data.type===h.CHILD_WINDOW_READY&&(this.setParentWindowNonce(event.data.childNonce),this._setChildWindow(event.source),this._replayQueuedMessagesToChild(event.data.peerID,l))},_handleWindowMessageToChild:function(event){if(!this._verifyWindowMessage(event))return;event.data.type===h.CHILD_WINDOW_MESSAGE&&this._onMessage(event.data.message);event.data.type===h.CHILD_WINDOW_START_CALL&&(s?s():b("FBRTCCallControlActions").parentWindowStartCall())},_replayQueuedMessagesToChild:function(a,b){this._localMessageQueue.drainQueue(a,function(a){a={type:h.CHILD_WINDOW_MESSAGE,nonce:n,message:a};b.postMessage(a,window.location.origin)})},_setChildWindow:function(a){l=a,clearTimeout(m),m=setTimeout(function(){l=null},i),this._startCallInChildWindow(),this.generateNewNonce()},_passMessageToChildWindow:function(a){if(l){a={type:h.CHILD_WINDOW_MESSAGE,nonce:n,message:a};l.postMessage(a,window.location.origin)}},_startCallInChildWindow:function(){if(l){var a={type:h.CHILD_WINDOW_START_CALL,nonce:n};l.postMessage(a,window.location.origin)}}};b("mixInEventEmitter")(a,{messageReceived:!0,multiwayMessageReceived:!0,bonfireMessageReceived:!0});e.exports=a}),null);
__d("XGroupCallController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groupcall/{?call_context}/",{call_context:{type:"String",required:!0},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:!0},server_info_data:{type:"String"},nonce:{type:"String"},multiway_www_tier:{type:"String"},multiway_core_tier:{type:"String"}})}),null);
__d("XGroupCallSigningController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groupcall/init/",{call_context:{type:"String",required:!0},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:!1},server_info_data:{type:"String"},nonce:{type:"String"},multiway_www_tier:{type:"String"},multiway_core_tier:{type:"String"}})}),null);
__d("XVideoCallController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/incall/",{peer_id:{type:"FBID",required:!0},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:!1},audio_only:{type:"Bool",defaultValue:!1},nonce:{type:"String"},meeting_id:{type:"Int"}})}),null);
__d("XWirelessScreenSharingController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/screen_sharing/{?session_id}/",{nonce:{type:"String"},peer_id:{type:"FBID",required:!0},session_id:{type:"Int"}})}),null);
__d("FBRTCUrlManager",["regeneratorRuntime","Promise","CurrentUser","FBRTCConfig","FBRTCLogger","FBRTCUtils","MessengerRTCFunnelLogger","URI","XGroupCallController","XGroupCallSigningController","XVideoCallController","XWirelessScreenSharingController"],(function(a,b,c,d,e,f){__p&&__p();var g=3,h=function(a,c,d,e){b("FBRTCLogger").getInstance().logCallAction(a,c,b("FBRTCLogger").CallAction.OLD_URI);return b("XVideoCallController").getURIBuilder().setFBID("peer_id",a).setInt("call_id",c).setBool("is_caller",d).setBool("audio_only",e).getURI()};function i(a){if(b("CurrentUser").isEmployee()){a=a.setSubdomain(b("CurrentUser").hasWorkUser()||b("CurrentUser").isWorkUser()?"fb":"www");var c="/intern/";return b("URI").getRequestURI().getPath().substr(0,c.length)!==c?a:a.setDomain(a.getDomain().toString().replace(/\.(intern|internmc|cstools)\./,"."))}return a}function j(a){__p&&__p();var c,d,e,f,g,h,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:c=a.callContext,d=a.callID,e=a.usersToRing,f=a.hasVideo,g=a.multiwayCoreTier,h=a.multiwayWwwTier,i=a.nonce,j=a.serverInfoData;k=b("XGroupCallSigningController").getURIBuilder().setString("call_context",c).setInt("call_id",d).setFBIDSet("users_to_ring",e).setBool("has_video",f).setString("server_info_data",j).setString("nonce",i).setString("multiway_www_tier",h).setString("multiway_core_tier",g).getURI();return l.abrupt("return",new(b("Promise"))(function(a,c){b("FBRTCUtils").sendServerRequest(k,function(c){b("MessengerRTCFunnelLogger").appendAction("got_server_call_uri"),a(c.payload.uri)},function(a){c(a)})}));case 3:case"end":return l.stop()}},null,this)}(function a(c,d,e,f,h,i,j){(j===undefined||j===null)&&(j=g);var k=b("XGroupCallSigningController").getURIBuilder().setFBID("call_id",c).setBool("is_caller",e).setBool("audio_only",f).setFBIDSet("users_to_ring",d).getURI();b("FBRTCUtils").sendServerRequest(k,function(a){h(a.payload.uri)},function(g){if(j>0)a(c,d,e,f,h,i,j-1);else{g=b("XGroupCallController").getURIBuilder().setFBID("call_id",c).setBool("is_caller",e).setBool("audio_only",f).setFBIDSet("users_to_ring",d).getURI();h(g)}})});var k=function(a){if(b("FBRTCConfig").disableURLManager())return;window.history.replaceState({},"",a)};a={init:function(a){this._peerID=a},onCallStarted:function(){k(h(this._peerID))},getGroupCallUri:function(a,c,d,e,f,g,h,i){__p&&__p();var k;return b("regeneratorRuntime").async(function(l){__p&&__p();while(1)switch(l.prev=l.next){case 0:k=0;case 1:if(!(k<3)){l.next=14;break}l.prev=2;l.next=5;return b("regeneratorRuntime").awrap(j({callContext:a,callID:c,usersToRing:d,hasVideo:e,multiwayCoreTier:f,multiwayWwwTier:g,nonce:h,serverInfoData:i}));case 5:return l.abrupt("return",l.sent);case 8:l.prev=8,l.t0=l["catch"](2),b("FBRTCLogger").getInstance().logToConsole(l.t0);case 11:k++;l.next=1;break;case 14:b("MessengerRTCFunnelLogger").appendAction("use_local_call_uri");return l.abrupt("return",b("XGroupCallController").getURIBuilder().setString("call_context",a).setInt("call_id",c).setFBIDSet("users_to_ring",d).setBool("has_video",e).setString("server_info_data",i).setString("nonce",h).setString("multiway_www_tier",g).setString("multiway_core_tier",f).getURI());case 16:case"end":return l.stop()}},null,this,[[2,8]])},getNonceUri:function(a,c,d,e,f,g){g===void 0&&(g="");c=b("XVideoCallController").getURIBuilder().setFBID("peer_id",a).setInt("call_id",c).setBool("is_caller",d).setBool("audio_only",e).setString("nonce",f).getURI();return b("FBRTCUtils").isPeerVCEndpoint(a)||b("FBRTCUtils").isCollabTrigger(g)?i(c):c},getWirelessScreenSharingUri:function(a,c,d){c=b("XWirelessScreenSharingController").getURIBuilder().setFBID("peer_id",c).setInt("session_id",d).setString("nonce",a).getURI();return i(c)}};e.exports=a}),null);
__d("FBRTCCallUI",["regeneratorRuntime","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCLogger","FBRTCMessageListener","FBRTCUrlManager","MessengerRTCFunnelLogger","VideoCallTypedLogger","pageID"],(function(a,b,c,d,e,f){__p&&__p();a={openGroupCallUI:function(a,c,d,e,f,g,h){var i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:i=b("FBRTCMessageListener").generateNewNonce();l.next=3;return b("regeneratorRuntime").awrap(b("FBRTCUrlManager").getGroupCallUri(a,c,d,e,"","",i,h));case 3:j=l.sent,b("MessengerRTCFunnelLogger").appendAction("start_load_popup"),b("MessengerRTCFunnelLogger").listenCrossWindowAction(i),g.location=j,g.focus&&g.focus(),k=new(b("FBRTCCallSummary"))({peerID:"MW_PEER_ID",callID:c,isCaller:!0}),k.onCallStarted(f),k.addExtraInfo(b("FBRTCLogger").Key.INITIATED_BY_PAGE_ID,b("pageID")),k.onCallEnded(b("FBRTCConstants").CallEndReason.CLIENT_ERROR,!1,!0,"PopupPending"),k.save(b("FBRTCCallSummaryStore").getInstance());case 13:case"end":return l.stop()}},null,this)},openGroupCallURI:function(a){var c,d,e,f,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:c=a.conferenceName,d=a.callID,e=a.hasVideo,f=a.serverInfoData,g=a.trigger,h=a.callSummary,i=a.callWindow,j=a.multiwayWwwTier,k=a.multiwayCoreTier;m.next=3;return b("regeneratorRuntime").awrap(b("FBRTCUrlManager").getGroupCallUri(c,d,[],e,k,j,b("FBRTCMessageListener").generateNewNonce(),f));case 3:l=m.sent,i.location=l,i.focus&&i.focus(),h.onCallStarted(g),h.addExtraInfo(b("FBRTCLogger").Key.INITIATED_BY_PAGE_ID,b("pageID")),h.onCallEnded(b("FBRTCConstants").CallEndReason.CLIENT_ERROR,!1,!0,"PopupPending"),h.save(b("FBRTCCallSummaryStore").getInstance());case 10:case"end":return m.stop()}},null,this)},openAsCaller:function(a,c,d,e,f){new(b("VideoCallTypedLogger"))().setEvent("open_as_caller").log();var g=b("FBRTCMessageListener").generateNewNonce();b("FBRTCLogger").getInstance().logCallAction(a,c,b("FBRTCLogger").CallAction.START_CALL,null,d);var h=new(b("FBRTCCallSummary"))({peerID:a,callID:c,isCaller:!0});h.onCallStarted(d);b("MessengerRTCFunnelLogger").listenCrossWindowAction(g);this._open(a,c,!0,h,e,f,g,d)},openAsCallee:function(a,c,d,e,f){new(b("VideoCallTypedLogger"))().setEvent("open_as_callee").log(),this._open(a,c,!1,d,e,f,b("FBRTCMessageListener").generateNewNonce())},_open:function(a,c,d,e,f,g,h,i){__p&&__p();i===void 0&&(i="");e.addExtraInfo(b("FBRTCLogger").Key.INITIATED_BY_PAGE_ID,b("pageID"));e.onCallEnded(b("FBRTCConstants").CallEndReason.CLIENT_ERROR,!1,!0,"PopupPending");e.save(b("FBRTCCallSummaryStore").getInstance());if(!g)return;e=b("FBRTCUrlManager").getNonceUri(a,c,d,f,h,i);new(b("VideoCallTypedLogger"))().setEvent("open_popup").log();b("MessengerRTCFunnelLogger").appendAction("use_local_call_uri");b("MessengerRTCFunnelLogger").appendAction("start_load_popup");b("FBRTCLogger").getInstance().logCallAction(a,c,b("FBRTCLogger").CallAction.OPEN_POPUP);g.location=e;g.focus&&g.focus()}};e.exports=a}),null);